<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<? wbs_initLayout ?>

<script language="JavaScript" type="text/JavaScript">
<!--

function MM_findObj(n, d)
{ //v4.01
	var p,i,x;  if(!d) d=document; if((p=n.indexOf("?"))>0&&parent.frames.length) {
	d=parent.frames[n.substring(p+1)].document; n=n.substring(0,p);}
	if(!(x=d[n])&&d.all) x=d.all[n]; for (i=0;!x&&i<d.forms.length;i++) x=d.forms[i][n];
	for(i=0;!x&&d.layers&&i<d.layers.length;i++) x=MM_findObj(n,d.layers[i].document);
	if(!x && d.getElementById) x=d.getElementById(n); return x;
}


function onUpload()
{
	thisForm = document.forms[0];

	var fileFound = false;
	for ( i = 0; i < thisForm.elements.length; i++ )
		if (thisForm.elements[i].name.substr(0, 6) == "files[")
			if ( thisForm.elements[i].value != "" ) {
				fileFound = true;
				break;
			}

	if ( !fileFound ) {
		alert( "<? $qpStrings.ai_screen_nofiles_message ?>" );
		return false;
	}

	if ( document.getElementById ) {
		var addFileCell = document.getElementById( 'addfilecell' );
		if (addFileCell)
			addFileCell.style.display = "none";

		var attachMessageCell = document.getElementById( 'attachmessagecll' );
		if (attachMessageCell)
			attachMessageCell.style.display = "inline";
	}

	processTextButton( 'attachbtn', 'form' );

	return false;
}

var visibleSections = 2;

function expand()
{
	inc = 2;
	if ( document.getElementById ) {
		for ( i = 1; i <= inc; i++ ) {
			sectionName = "section" + (this.visibleSections+i-1);
			var extraSection = document.getElementById( sectionName );
			if (extraSection)
				extraSection.style.display = "block";
		}

		this.visibleSections += inc;

		if ( this.visibleSections >= <? $sectionCount ?> ) {
			var section = document.getElementById( "expandSection" );
			if (section)
				section.style.display = "none";
		}
	}

	return false;
}

function MM_preloadImages() { //v3.0
	var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
	var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
	if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
}

//-->
</script>

	</head>
	<body onLoad="autoFocusFormControl( '<? $invalidField ?>', 'folderData' )">
		<? wbs_pageLayout ?>
			<? wbs_errorBlock ?>

			<? if !$fatalError ?>

			<? if !$fatalError ?>

				<? if !$showMessages ?>
						<div ID="addfilecell">
							<? foreach from=$fileSections key=index item=section ?>
								<table class="FormLayout" <?if $index > 1 ?>style="display:none"<?else?><?/if?> ID="<? "section"|cat:$index ?>">
									<tr class="SeparatedRow">
										<td><? wbs_label text=$qpStrings.ai_screen_addimagefile_title ?></td>
										<td><input type="file" class="FormControl" name="files[<? $index ?>]" style="width: 400px"></td></tr>
								</table>
							<? /foreach ?>

							<a name="bottom"></a>

							<? wbs_note displayNoteMarker=false width="500px" smallFont=false ?>
								<? $qpStrings.ai_screen_moreimages_label|cat:": " ?><a href="#bottom" onClick="expand()"><img src="../cssbased/images/expand.gif" border="0" width="17" height="11"></a>
							<? /wbs_note ?>

							<? wbs_note displayNoteMarker=true width="500px" smallFont=true indented=true?>
								<? $limitStr ?>
							<? /wbs_note ?>

							<? wbs_buttonSet ?>
								<? wbs_buttonSetButton name=addfilebtn link="#" caption=$qpStrings.ai_screen_add_btn onClick="return onUpload()" ?>
								<? wbs_buttonSetButton name=cancelbtn caption=$kernelStrings.app_cancel_btn ?>
							<? /wbs_buttonSet ?>
						</div>
						<div ID="attachmessagecll" style="display:none">

								<?* wbs_formCaption text= $qpStrings.ai_screen_upload_text *?>

								<? wbs_note displayNoteMarker=false width="500px" smallFont=false ?>
									<? $qpStrings.ai_screen_uploadwait_text ?>
								<? /wbs_note ?>

								<? wbs_note displayNoteMarker=false width="500px" smallFont=false ?>
									<img src="../cssbased/images/progress.gif" >
								<? /wbs_note ?>

								<? wbs_buttonSet ?>
									<? wbs_buttonSetButton caption=$kernelStrings.app_cancel_btn name="cancelbtn" ?>
								<? /wbs_buttonSet ?>
						</div>


		<? else ?>
				<table cellpadding=2 cellspacing=0 border=0>
				<? foreach from=$messageStack key=index item=message ?>
					<tr><td><? $message ?></td></tr>
				<? /foreach  ?>
				<tr>
					<td>&nbsp;</td>
				</tr>
				</table>
				<? wbs_buttonSet ?>
					<? wbs_buttonSetButton name="cancelbtn"  caption=$kernelStrings.app_ok_btn   ?>
				<? /wbs_buttonSet ?>
		<? /if ?>

	<? else ?>
			<table cellpadding=2 cellspacing=0 border=0>
				<? foreach from=$messageStack key=index item=message ?>
				<tr><td><? $message ?></td></tr>
				<? /foreach  ?>
				<tr>
					<td>&nbsp;</td>
				</tr>
			</table>

			<? wbs_buttonSet ?>
				<? wbs_buttonSetButton name="cancelbtn"  caption=$kernelStrings.app_ok_btn   ?>
			<? /wbs_buttonSet ?>
	<? /if ?>

		<? else ?>
			<? wbs_buttonSet ?>
				<? wbs_buttonSetButton name="cancelbtn" caption=$kernelStrings.app_cancel_btn ?>
			<? /wbs_buttonSet ?>
		<? /if ?>

		<input type="hidden" name="QPF_ID" value="<?$QPF_ID?>">
		<input type="hidden" name="QPF_ID_PARENT" value="<?$QPF_ID_PARENT?>">
		<input type="hidden" name="currentBookID" value="<?$currentBookID?>">
		<input type="hidden" name="opener" value="<?$opener?>">
		<input type=hidden name=finished value=1>
		<input name="folderData[QPF_UNIQID]" type="hidden" value="<? $folderData.QPF_UNIQID ?>">

		<input name="PAGE_ATTACHED_FILES" type="hidden" value="<? $PAGE_ATTACHED_FILES ?>">
		<input name="PAGE_DELETED_FILES" type="hidden" value="<? $PAGE_DELETED_FILES?>">
		<input name="RECORD_FILES" type="hidden" value="<? $RECORD_FILES ?>">

		<? /wbs_pageLayout ?>
	</body>
</html>