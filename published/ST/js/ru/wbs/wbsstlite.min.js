jQuery.ui||function(a){a.browser.mozilla&&parseFloat(a.browser.version);a.ui={version:"@VERSION",plugin:{add:function(b,c,d){b=a.ui[b].prototype;for(var f in d){b.plugins[f]=b.plugins[f]||[];b.plugins[f].push([c,d[f]])}},call:function(b,c,d){if((c=b.plugins[c])&&b.element[0].parentNode)for(var f=0;f<c.length;f++)b.options[c[f][0]]&&c[f][1].apply(b.element,d)}},contains:function(b,c){return document.compareDocumentPosition?b.compareDocumentPosition(c)&16:b!==c&&b.contains(c)},hasScroll:function(b,
c){if(a(b).css("overflow")=="hidden")return false;var d=c&&c=="left"?"scrollLeft":"scrollTop",f=false;if(b[d]>0)return true;b[d]=1;f=b[d]>0;b[d]=0;return f},isOverAxis:function(b,c,d){return b>c&&b<c+d},isOver:function(b,c,d,f,e,g){return a.ui.isOverAxis(b,d,e)&&a.ui.isOverAxis(c,f,g)},keyCode:{BACKSPACE:8,CAPS_LOCK:20,COMMA:188,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,
NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38}};a.fn.extend({_focus:a.fn.focus,focus:function(b,c){return typeof b==="number"?this.each(function(){var d=this;setTimeout(function(){a(d).focus();c&&c.call(d)},b)}):this._focus.apply(this,arguments)},enableSelection:function(){return this.attr("unselectable","off").css("MozUserSelect","").unbind("selectstart.ui")},disableSelection:function(){return this.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",
function(){return false})},scrollParent:function(){var b;b=a.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.curCSS(this,"position",1))&&/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,
"overflow-x",1))}).eq(0);return/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(b){if(b!==undefined)return this.css("zIndex",b);if(this.length){b=a(this[0]);for(var c;b.length&&b[0]!==document;){c=b.css("position");if(c=="absolute"||c=="relative"||c=="fixed"){c=parseInt(b.css("zIndex"));if(!isNaN(c)&&c!=0)return c}b=b.parent()}}return 0}});a.extend(a.expr[":"],{data:function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){var c=b.nodeName.toLowerCase(),d=a.attr(b,
"tabindex");return(/input|select|textarea|button|object/.test(c)?!b.disabled:"a"==c||"area"==c?b.href||!isNaN(d):!isNaN(d))&&!a(b)["area"==c?"parents":"closest"](":hidden").length},tabbable:function(b){var c=a.attr(b,"tabindex");return(isNaN(c)||c>=0)&&a(b).is(":focusable")}})}(jQuery);(function(a){var b=a.fn.remove;a.fn.remove=function(c,d){d||a("*",this).add(this).each(function(){a(this).triggerHandler("remove")});return b.apply(this,arguments)};a.widget=function(c,d,f){var e=c.split(".")[0],g;c=c.split(".")[1];g=e+"-"+c;if(!f){f=d;d=a.Widget}a.expr[":"][g]=function(h){return!!a.data(h,c)};a[e]=a[e]||{};a[e][c]=function(h,i){arguments.length&&this._createWidget(h,i)};d=new d;d.options=a.extend({},d.options);a[e][c].prototype=a.extend(true,d,{namespace:e,widgetName:c,widgetEventPrefix:a[e][c].prototype.widgetEventPrefix||
c,widgetBaseClass:g},f);a.widget.bridge(c,a[e][c])};a.widget.bridge=function(c,d){a.fn[c]=function(f){var e=typeof f==="string",g=Array.prototype.slice.call(arguments,1),h=this;f=!e&&g.length?a.extend.apply(null,[true,f].concat(g)):f;if(e&&f.substring(0,1)==="_")return h;e?this.each(function(){var i=a.data(this,c),k=i&&a.isFunction(i[f])?i[f].apply(i,g):i;if(k!==i&&k!==undefined){h=k;return false}}):this.each(function(){var i=a.data(this,c);if(i){f&&i.option(f);i._init()}else a.data(this,c,new d(f,
this))});return h}};a.Widget=function(c,d){arguments.length&&this._createWidget(c,d)};a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(c,d){this.element=a(d).data(this.widgetName,this);this.options=a.extend(true,{},this.options,a.metadata&&a.metadata.get(d)[this.widgetName],c);var f=this;this.element.bind("remove."+this.widgetName,function(){f.destroy()});this._create();this._init()},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+
this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled");if(this.markup){this.markup.attr("id",this.options.layoutMarkupId);this.markup.find("*").each(function(){this.id=this.id.replace("-markup","")})}},widget:function(){return this.element},option:function(c,d){var f=c,e=this;if(arguments.length===0)return a.extend({},e.options);if(typeof c==="string"){if(d===
undefined)return this.options[c];f={};f[c]=d}a.each(f,function(g,h){e._setOption(g,h)});return e},_setOption:function(c,d){this.options[c]=d;if(c==="disabled")this.widget()[d?"addClass":"removeClass"](this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").attr("aria-disabled",d);return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_trigger:function(c,d,f){var e=this.options[c];d=a.Event(d);d.type=(c===this.widgetEventPrefix?
c:this.widgetEventPrefix+c).toLowerCase();f=f||{};if(d.originalEvent){c=a.event.props.length;for(var g;c;){g=a.event.props[--c];d[g]=d.originalEvent[g]}}this.element.trigger(d,f);return!(a.isFunction(e)&&e.call(this.element[0],d,f)===false||d.isDefaultPrevented())}}})(jQuery);(function(a){var b,c=function(f){a(":ui-button",f.target.form).each(function(){var e=a(this).data("button");setTimeout(function(){e.refresh()},1)})},d=function(f){var e=f.name,g=f.form,h=a([]);if(e)h=g?a(g).find("[name='"+e+"']"):a("[name='"+e+"']",f.ownerDocument).filter(function(){return!this.form});return h};a.widget("ui.button",{options:{text:true,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset.button").bind("reset.button",c);this._determineButtonType();
this.hasTitle=!!this.buttonElement.attr("title");var f=this,e=this.options,g=this.type==="checkbox"||this.type==="radio",h="ui-state-hover"+(!g?" ui-state-active":"");if(e.label===null)e.label=this.buttonElement.html();if(this.element.is(":disabled"))e.disabled=true;this.buttonElement.addClass("ui-button ui-widget ui-state-default ui-corner-all").attr("role","button").bind("mouseover",function(){a(this).addClass("ui-state-hover")}).bind("mouseout",function(){a(this).removeClass("ui-state-hover")}).bind("mouseenter.button",
function(){if(!e.disabled){a(this).addClass("ui-state-hover");this===b&&a(this).addClass("ui-state-active")}}).bind("mouseleave.button",function(){e.disabled||a(this).removeClass(h)}).bind("focus.button",function(){a(this).addClass("ui-state-focus")}).bind("blur.button",function(){a(this).removeClass("ui-state-focus")});g&&this.element.bind("change.button",function(){f.refresh()});if(this.type==="checkbox")this.buttonElement.bind("click.button",function(){if(e.disabled)return false;a(this).toggleClass("ui-state-active");
f.buttonElement.attr("aria-pressed",f.element[0].checked)});else if(this.type==="radio")this.buttonElement.bind("click.button",function(){if(e.disabled)return false;a(this).addClass("ui-state-active");f.buttonElement.attr("aria-pressed",true);var i=f.element[0];d(i).not(i).map(function(){return a(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed",false)});else{this.buttonElement.bind("mousedown.button",function(){if(e.disabled)return false;a(this).addClass("ui-state-active");
b=this;a(document).one("mouseup",function(){b=null})}).bind("mouseup.button",function(){if(e.disabled)return false;a(this).removeClass("ui-state-active")}).bind("keydown.button",function(i){if(e.disabled)return false;if(i.keyCode==a.ui.keyCode.SPACE||i.keyCode==a.ui.keyCode.ENTER)a(this).addClass("ui-state-active")}).bind("keyup.button",function(){a(this).removeClass("ui-state-active")});this.buttonElement.is("a")&&this.buttonElement.keyup(function(i){i.keyCode===a.ui.keyCode.SPACE&&a(this).click()})}this._setOption("disabled",
e.disabled)},_determineButtonType:function(){this.type=this.element.is(":checkbox")?"checkbox":this.element.is(":radio")?"radio":this.element.is("input")?"input":"button";if(this.type==="checkbox"||this.type==="radio"){this.buttonElement=this.element.parents().last().find("[for="+this.element.attr("id")+"]");this.element.addClass("ui-helper-hidden-accessible");var f=this.element.is(":checked");f&&this.buttonElement.addClass("ui-state-active");this.buttonElement.attr("aria-pressed",f)}else this.buttonElement=
this.element},widget:function(){return this.buttonElement},destroy:function(){this.element.removeClass("ui-helper-hidden-accessible");this.buttonElement.removeClass("ui-button ui-widget ui-state-default ui-corner-all ui-state-hover ui-state-active ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon ui-button-text-only").removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html());this.hasTitle||this.buttonElement.removeAttr("title");
a.Widget.prototype.destroy.call(this)},_setOption:function(f,e){a.Widget.prototype._setOption.apply(this,arguments);if(f==="disabled")e?this.element.attr("disabled",true):this.element.removeAttr("disabled");this._resetButton()},refresh:function(){var f=this.element.is(":disabled");f!==this.options.disabled&&this._setOption("disabled",f);if(this.type==="radio")d(this.element[0]).each(function(){a(this).is(":checked")?a(this).button("widget").addClass("ui-state-active").attr("aria-pressed",true):a(this).button("widget").removeClass("ui-state-active").attr("aria-pressed",
false)});else if(this.type==="checkbox")this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed",true):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed",false)},_resetButton:function(){if(this.type==="input")this.options.label&&this.element.val(this.options.label);else{var f=this.buttonElement,e=a("<span></span>").addClass("ui-button-text").appendTo(f.empty()).html(this.options.label).text(),g=this.options.icons,h=g.primary&&g.secondary;if(g.primary||
g.secondary){f.addClass("ui-button-text-icon"+(h?"s":""));g.primary&&f.prepend("<span class='ui-button-icon-primary ui-icon "+g.primary+"'></span>");g.secondary&&f.append("<span class='ui-button-icon-secondary ui-icon "+g.secondary+"'></span>");if(!this.options.text){f.addClass(h?"ui-button-icons-only":"ui-button-icon-only").removeClass("ui-button-text-icons ui-button-text-icon");this.hasTitle||f.attr("title",e)}}else f.addClass("ui-button-text-only");a("span.ui-button-text span.ui-button-text",f).length&&
a("span:first",f).replaceWith(a("span:first",f).children())}}});a.widget("ui.buttonset",{_create:function(){this.element.addClass("ui-buttonset");this._init()},_init:function(){this.refresh()},_setOption:function(f,e){f==="disabled"&&this.buttons.button("option",f,e);a.Widget.prototype._setOption.apply(this,arguments)},refresh:function(){this.buttons=this.element.find(":button, :submit, :reset, :checkbox, :radio, a, :data(button)").filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return a(this).button("widget")[0]}).end()},
destroy:function(){this.element.removeClass("ui-buttonset");this.buttons.map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy");a.Widget.prototype.destroy.call(this)}})})(jQuery);(function(a){a.ui=a.ui||{};var b=/left|center|right/,c=/top|center|bottom/,d=a.fn.position,f=a.fn.offset;a.fn.position=function(e){if(!e||!e.of)return d.apply(this,arguments);e=a.extend({},e);var g=a(e.of),h=(e.collision||"flip").split(" "),i=e.offset?e.offset.split(" "):[0,0],k,j,m;if(e.of.nodeType===9){k=g.width();j=g.height();m={top:0,left:0}}else if(e.of.scrollTo&&e.of.document){k=g.width();j=g.height();m={top:g.scrollTop(),left:g.scrollLeft()}}else if(e.of.preventDefault){e.at="left top";k=j=
0;m={top:e.of.pageY,left:e.of.pageX}}else{k=g.outerWidth();j=g.outerHeight();m=g.offset()}a.each(["my","at"],function(){var l=(e[this]||"").split(" ");if(l.length===1)l=b.test(l[0])?l.concat(["center"]):c.test(l[0])?["center"].concat(l):["center","center"];l[0]=b.test(l[0])?l[0]:"center";l[1]=c.test(l[1])?l[1]:"center";e[this]=l});if(h.length===1)h[1]=h[0];i[0]=parseInt(i[0],10)||0;if(i.length===1)i[1]=i[0];i[1]=parseInt(i[1],10)||0;if(e.at[0]==="right")m.left+=k;else if(e.at[0]==="center")m.left+=
k/2;if(e.at[1]==="bottom")m.top+=j;else if(e.at[1]==="center")m.top+=j/2;m.left+=i[0];m.top+=i[1];return this.each(function(){var l=a(this),o=l.outerWidth(),n=l.outerHeight(),p=a.extend({},m);if(e.my[0]==="right")p.left-=o;else if(e.my[0]==="center")p.left-=o/2;if(e.my[1]==="bottom")p.top-=n;else if(e.my[1]==="center")p.top-=n/2;a.each(["left","top"],function(q,r){a.ui.position[h[q]]&&a.ui.position[h[q]][r](p,{targetWidth:k,targetHeight:j,elemWidth:o,elemHeight:n,offset:i,my:e.my,at:e.at})});a.fn.bgiframe&&
l.bgiframe();l.offset(a.extend(p,{using:e.using}))})};a.ui.position={fit:{left:function(e,g){var h=a(window);h=e.left+g.elemWidth-h.width()-h.scrollLeft();e.left=h>0?e.left-h:Math.max(0,e.left)},top:function(e,g){var h=a(window);h=e.top+g.elemHeight-h.height()-h.scrollTop();e.top=h>0?e.top-h:Math.max(0,e.top)}},flip:{left:function(e,g){if(g.at[0]!=="center"){var h=a(window);h=e.left+g.elemWidth-h.width()-h.scrollLeft();var i=g.my[0]==="left"?-g.elemWidth:g.my[0]==="right"?g.elemWidth:0,k=-2*g.offset[0];
e.left+=e.left<0?i+g.targetWidth+k:h>0?i-g.targetWidth+k:0}},top:function(e,g){if(g.at[1]!=="center"){var h=a(window);h=e.top+g.elemHeight-h.height()-h.scrollTop();var i=g.my[1]==="top"?-g.elemHeight:g.my[1]==="bottom"?g.elemHeight:0,k=g.at[1]==="top"?g.targetHeight:-g.targetHeight,j=-2*g.offset[1];e.top+=e.top<0?i+g.targetHeight+j:h>0?i+k+j:0}}}};if(!a.offset.setOffset){a.offset.setOffset=function(e,g){if(/static/.test(a.curCSS(e,"position")))e.style.position="relative";var h=a(e),i=h.offset(),k=
parseInt(a.curCSS(e,"top",true),10)||0,j=parseInt(a.curCSS(e,"left",true),10)||0;i={top:g.top-i.top+k,left:g.left-i.left+j};"using"in g?g.using.call(e,i):h.css(i)};a.fn.offset=function(e){var g=this[0];if(!g||!g.ownerDocument)return null;if(e)return this.each(function(){a.offset.setOffset(this,e)});return f.call(this)}}})(jQuery);(function(a){a.widget("ui.dialog",{options:{autoOpen:true,buttons:{},closeOnEscape:true,closeText:"close",dialogClass:"",draggable:true,hide:null,height:"auto",maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:false,position:"center",resizable:true,show:null,stack:true,title:"",width:300,zIndex:1E3},_create:function(){this.originalTitle=this.element.attr("title");var b=this,c=b.options,d=c.title||b.originalTitle||"&#160;",f=a.ui.dialog.getTitleId(b.element),e=(b.uiDialog=a("<div></div>")).appendTo(document.body).hide().addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+
c.dialogClass).css({zIndex:c.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(i){if(c.closeOnEscape&&i.keyCode&&i.keyCode===a.ui.keyCode.ESCAPE){b.close(i);i.preventDefault()}}).attr({role:"dialog","aria-labelledby":f}).mousedown(function(i){b.moveToTop(false,i)});b.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(e);var g=(b.uiDialogTitlebar=a("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-top ui-helper-clearfix").prependTo(e),
h=a('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role","button").hover(function(){h.addClass("ui-state-hover")},function(){h.removeClass("ui-state-hover")}).focus(function(){h.addClass("ui-state-focus")}).blur(function(){h.removeClass("ui-state-focus")}).click(function(i){b.close(i);return false}).appendTo(g);(b.uiDialogTitlebarCloseText=a("<span></span>")).addClass("ui-icon ui-icon-closethick").text(c.closeText).appendTo(h);a("<span></span>").addClass("ui-dialog-title").attr("id",
f).html(d).prependTo(g);if(a.isFunction(c.beforeclose)&&!a.isFunction(c.beforeClose))c.beforeClose=c.beforeclose;g.find("*").add(g).disableSelection();c.draggable&&a.fn.draggable&&b._makeDraggable();c.resizable&&a.fn.resizable&&b._makeResizable();b._createButtons(c.buttons);b._isOpen=false;a.fn.bgiframe&&e.bgiframe()},_init:function(){this.options.autoOpen&&this.open()},destroy:function(){this.overlay&&this.overlay.destroy();this.uiDialog.hide();this.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body");
this.uiDialog.remove();this.originalTitle&&this.element.attr("title",this.originalTitle);return this},widget:function(){return this.uiDialog},close:function(b){var c=this,d;if(false!==c._trigger("beforeClose",b)){c.overlay&&c.overlay.destroy();c.uiDialog.unbind("keypress.ui-dialog");c._isOpen=false;if(c.options.hide)c.uiDialog.hide(c.options.hide,function(){c._trigger("close",b)});else{c.uiDialog.hide();c._trigger("close",b)}a.ui.dialog.overlay.resize();if(c.options.modal){d=0;a(".ui-dialog").each(function(){if(this!==
c.uiDialog[0])d=Math.max(d,a(this).css("z-index"))});a.ui.dialog.maxZ=d}return c}},isOpen:function(){return this._isOpen},moveToTop:function(b,c){var d=this.options;if(d.modal&&!b||!d.stack&&!d.modal)return this._trigger("focus",c);if(d.zIndex>a.ui.dialog.maxZ)a.ui.dialog.maxZ=d.zIndex;if(this.overlay){a.ui.dialog.maxZ+=1;this.overlay.$el.css("z-index",a.ui.dialog.overlay.maxZ=a.ui.dialog.maxZ)}d={scrollTop:this.element.attr("scrollTop"),scrollLeft:this.element.attr("scrollLeft")};a.ui.dialog.maxZ+=
1;this.uiDialog.css("z-index",a.ui.dialog.maxZ);this.element.attr(d);this._trigger("focus",c);return this},open:function(){if(!this._isOpen){var b=this.options,c=this.uiDialog;this.overlay=b.modal?new a.ui.dialog.overlay(this):null;c.next().length&&c.appendTo("body");this._size();this._position(b.position);c.show(b.show);this.moveToTop(true);b.modal&&c.bind("keypress.ui-dialog",function(d){if(d.keyCode===a.ui.keyCode.TAB){var f=a(":tabbable",this),e=f.filter(":first");f=f.filter(":last");if(d.target===
f[0]&&!d.shiftKey){e.focus(1);return false}else if(d.target===e[0]&&d.shiftKey){f.focus(1);return false}}});a([]).add(c.find(".ui-dialog-content :tabbable:first")).add(c.find(".ui-dialog-buttonpane :tabbable:first")).add(c).filter(":first").focus();this._trigger("open");this._isOpen=true;return this}},_createButtons:function(b){var c=this,d=false,f=a("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix");c.uiDialog.find(".ui-dialog-buttonpane").remove();typeof b==="object"&&
b!==null&&a.each(b,function(){return!(d=true)});if(d){a.each(b,function(e,g){var h=a('<button type="button"></button>').text(e).click(function(){g.apply(c.element[0],arguments)}).appendTo(f);a.fn.button&&h.button()});f.appendTo(c.uiDialog)}},_makeDraggable:function(){function b(g){return{position:g.position,offset:g.offset}}var c=this,d=c.options,f=a(document),e;c.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(g,
h){e=d.height==="auto"?"auto":a(this).height();a(this).height(a(this).height()).addClass("ui-dialog-dragging");c._trigger("dragStart",g,b(h))},drag:function(g,h){c._trigger("drag",g,b(h))},stop:function(g,h){d.position=[h.position.left-f.scrollLeft(),h.position.top-f.scrollTop()];a(this).removeClass("ui-dialog-dragging").height(e);c._trigger("dragStop",g,b(h));a.ui.dialog.overlay.resize()}})},_makeResizable:function(b){function c(g){return{originalPosition:g.originalPosition,originalSize:g.originalSize,
position:g.position,size:g.size}}b=b===undefined?this.options.resizable:b;var d=this,f=d.options,e=d.uiDialog.css("position");b=typeof b==="string"?b:"n,e,s,w,se,sw,ne,nw";d.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:d.element,maxWidth:f.maxWidth,maxHeight:f.maxHeight,minWidth:f.minWidth,minHeight:d._minHeight(),handles:b,start:function(g,h){a(this).addClass("ui-dialog-resizing");d._trigger("resizeStart",g,c(h))},resize:function(g,h){d._trigger("resize",g,c(h))},
stop:function(g,h){a(this).removeClass("ui-dialog-resizing");f.height=a(this).height();f.width=a(this).width();d._trigger("resizeStop",g,c(h));a.ui.dialog.overlay.resize()}}).css("position",e).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var b=this.options;return b.height==="auto"?b.minHeight:Math.min(b.minHeight,b.height)},_position:function(b){var c=[],d=[0,0];b=b||a.ui.dialog.prototype.options.position;if(typeof b==="string"||typeof b==="object"&&
"0"in b){c=b.split?b.split(" "):[b[0],b[1]];if(c.length===1)c[1]=c[0];a.each(["left","top"],function(f,e){if(+c[f]===c[f]){d[f]=c[f];c[f]=e}})}else if(typeof b==="object"){if("left"in b){c[0]="left";d[0]=b.left}else if("right"in b){c[0]="right";d[0]=-b.right}if("top"in b){c[1]="top";d[1]=b.top}else if("bottom"in b){c[1]="bottom";d[1]=-b.bottom}}(b=this.uiDialog.is(":visible"))||this.uiDialog.show();this.uiDialog.css({top:0,left:0}).position({my:c.join(" "),at:c.join(" "),offset:d.join(" "),of:window,
collision:"fit",using:function(f){var e=a(this).css(f).offset().top;e<0&&a(this).css("top",f.top-e)}});b||this.uiDialog.hide()},_setOption:function(b,c){var d=this.uiDialog,f=d.is(":data(resizable)"),e=false;switch(b){case "beforeclose":b="beforeClose";break;case "buttons":this._createButtons(c);break;case "closeText":this.uiDialogTitlebarCloseText.text(""+c);break;case "dialogClass":d.removeClass(this.options.dialogClass).addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+c);break;case "disabled":c?
d.addClass("ui-dialog-disabled"):d.removeClass("ui-dialog-disabled");break;case "draggable":c?this._makeDraggable():d.draggable("destroy");break;case "height":e=true;break;case "maxHeight":f&&d.resizable("option","maxHeight",c);e=true;break;case "maxWidth":f&&d.resizable("option","maxWidth",c);e=true;break;case "minHeight":f&&d.resizable("option","minHeight",c);e=true;break;case "minWidth":f&&d.resizable("option","minWidth",c);e=true;break;case "position":this._position(c);break;case "resizable":f&&
!c&&d.resizable("destroy");f&&typeof c==="string"&&d.resizable("option","handles",c);!f&&c!==false&&this._makeResizable(c);break;case "title":a(".ui-dialog-title",this.uiDialogTitlebar).html(""+(c||"&#160;"));break;case "width":e=true}a.Widget.prototype._setOption.apply(this,arguments);e&&this._size()},_size:function(){var b=this.options,c;this.element.css("width","auto").hide();c=this.uiDialog.css({height:"auto",width:b.width}).height();this.element.css(b.height==="auto"?{minHeight:Math.max(b.minHeight-
c,0),height:"auto"}:{minHeight:0,height:Math.max(b.height-c,0)}).show();this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}});a.extend(a.ui.dialog,{version:"@VERSION",uuid:0,maxZ:0,getTitleId:function(b){b=b.attr("id");if(!b){this.uuid+=1;b=this.uuid}return"ui-dialog-title-"+b},overlay:function(b){this.$el=a.ui.dialog.overlay.create(b)}});a.extend(a.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:a.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),
function(b){return b+".dialog-overlay"}).join(" "),create:function(b){if(this.instances.length===0){setTimeout(function(){a.ui.dialog.overlay.instances.length&&a(document).bind(a.ui.dialog.overlay.events,function(d){return a(d.target).zIndex()>=a.ui.dialog.overlay.maxZ})},1);a(document).bind("keydown.dialog-overlay",function(d){if(b.options.closeOnEscape&&d.keyCode&&d.keyCode===a.ui.keyCode.ESCAPE){b.close(d);d.preventDefault()}});a(window).bind("resize.dialog-overlay",a.ui.dialog.overlay.resize)}var c=
(this.oldInstances.pop()||a("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});a.fn.bgiframe&&c.bgiframe();this.instances.push(c);return c},destroy:function(b){this.oldInstances.push(this.instances.splice(a.inArray(b,this.instances),1)[0]);this.instances.length===0&&a([document,window]).unbind(".dialog-overlay");b.remove();var c=0;a.each(this.instances,function(){c=Math.max(c,this.css("z-index"))});this.maxZ=c},height:function(){var b,
c;if(a.browser.msie&&a.browser.version<7){b=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);c=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);return b<c?a(window).height()+"px":b+"px"}else return a(document).height()+"px"},width:function(){var b,c;if(a.browser.msie&&a.browser.version<7){b=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);c=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);return b<
c?a(window).width()+"px":b+"px"}else return a(document).width()+"px"},resize:function(){var b=a([]);a.each(a.ui.dialog.overlay.instances,function(){b=b.add(this)});b.css({width:0,height:0}).css({width:a.ui.dialog.overlay.width(),height:a.ui.dialog.overlay.height()})}});a.extend(a.ui.dialog.overlay.prototype,{destroy:function(){a.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);jQuery.fn.autocomplete=function(a,b){return this.each(function(){function c(n){window.clearInterval(g);if(n!=e&&b.minChars!=null&&n.length>=b.minChars){var p={};e=p[b.parameters.name]=n;$.wbs.ajaxRequest({url:a,data:p,callback:l});j=false}}var d=$(this),f=$('<ul class="autocomplete"></ul>');$(d).wrap("<div class='autocomplete-wrapper' style='position:relative'/>");$(d).after(f);f.css({position:"absolute","max-height":"400px","overflow-y":"auto"});var e="",g,h=0,i=0,k="",j=true;b=jQuery.extend({minChars:3,
limit:15,timeout:300,parameters:{name:"text"},selection:"<b>$1</b>",hiddenField:false,insert:function(n,p){n.val(p)},value:function(n){return n.val()}},b);var m,l=function(n){m=n;i=-1;var p="";$(".autoload-loading").remove();if(n){(h=n.length)||f.hide();for(var q in n)if(typeof n[q]=="string"){var r=$("<div></div>").html(n[q]).html(),s=b.value(d);if(s.replace(/\s/g,"").length>0)r=r.replace(RegExp("("+s.replace(/^\s\s*/,"").replace(/\s\s*$/,"").replace(/\s/g,"|")+")","gi"),b.selection);p+='<li value="'+
q+'">'+r+"</li>";f.html(p);f.show().css({top:d.outerHeight(),left:0,width:d.outerWidth()-2});f.children().hover(function(){$(this).addClass("selected").siblings().removeClass("selected")},function(){$(this).removeClass("selected")}).click(function(){b.insert(d,$(this).text());b.hiddenField&&$("#"+b.hiddenField).val($(this).attr("value"));o()});f.children(":first").addClass("selected");i=0;$.browser.msie&&$("select:visible").hide().addClass("autoHide")}}};$(document).click(function(n){if(f.is(":visible"))$(n.target).isChildrenOf(f)||
$(n.target).isChildrenOf(d.parent())||o()});var o=function(){f.find("*").remove();f.hide();h=0;i=-1};d.keydown(function(n){if(n.which==13){if(f.is(":hidden"))c(b.value(d));else{b.insert(d,f.children().eq(i).text());b.hiddenField&&$("#"+b.hiddenField).val(f.children().eq(i).attr("value"));o()}n.preventDefault();return false}else n.which==9&&o();new_value=b.value(d);if(new_value.indexOf(k)==-1)j=true;k=new_value});d.keyup(function(n){if(n.which!=16){window.clearTimeout(g);if(n.which==27||n.which==9)o();
else if(n.which==13)return false;else if(n.which==40||n.which==38){switch(n.which){case 40:i=i>=h-1?0:i+1;break;case 38:i=i<=0?h-1:i-1}f.children().removeClass("selected").eq(i).addClass("selected").text()}else{b.value(d).length==0&&o();j||(j=b.value(d).length>b.minChars);if(j||n.which==46||n.which==8||f.children().length==0||f.children().length>=b.limit)g=window.setTimeout(function(){c(b.value(d))},b.timeout);if(m==undefined)return false;for(var p in m)if(typeof m[p]=="string"){n=b.value(d).toLowerCase().split(" ");
for(var q=false,r=0;r<n.length;r++)q=q||m[p].toLowerCase().indexOf(n[r])==-1;if(q){delete m[p];p--}}f.children().length<b.limit&&l(m)}b.value(d).length||o()}})})};$.fn.extend({isChildrenOf:function(a){var b=this,c=a.find("*"),d=false;if($(b).not(a).length)c.each(function(){$(b).not(this).length||(d=true)});else d=true;return d}});
$.widget("ui.wbsPopup",{options:{width:false,height:false,constraint:false,padding:0,resizeable:false,shadow:true,padding:10,content:$("<div/>"),my:"left top",at:"left bottom",parentCorners:"ui-corner-top",fitParent:false,parentShadow:true,toggledByParent:true,myCorners:"ui-corner-bottom",appendToBody:false,parent:false,selectedParent:false,offset:{x:0,y:0},absolute:false,emptyContent:false,closed:true,open:function(){return false},close:function(){return false},load:function(){return false}},_create:function(){var a=
this,b=this.options;this.element.addClass("ui-widget").addClass(b.myCorners).addClass("ui-popup");b.emptyContent||this.element.addClass("ui-widget-content");if(!b.parent)b.parent=this.element.parent();b.padding>0&&this.element.css({padding:b.padding});b.appendToBody?$("body").append(this.element):b.parent.after(this.element);b.my=b.my.split(" ");b.at=b.at.split(" ");a.setPosition();b.shadow_prefix=["",""];if(b.at[1]=="top")b.shadow_prefix[0]="-r";if(b.my[1]=="bottom")b.shadow_prefix[1]="-t";if(b.fitParent)a.element.outerWidth()<
b.parent.outerWidth()?a.element.width(b.parent.outerWidth()):b.parent.width(a.element.outerWidth());b.shadow&&this.element.addClass("ui-wbs-shadow"+b.shadow_prefix[0]);this.element.hide();b.parentWidth=b.parent.outerWidth();b.parent.mousedown(function(){a.open(this)});this.isOpen=false;$(document).click(function(c){if(a.element.is(":visible")&&!a.isOpen)if(b.toggledByParent)$(c.target).isChildrenOf(b.parent)||$(c.target).isChildrenOf(a.element)||a.close();else $(c.target).isChildrenOf(a.element)||
a.close();if(a.isOpen)a.isOpen=false});b.load()},setPosition:function(a){var b=this.options,c=0,d=0,f=0,e=0,g=b.parent.position();if(b.appendToBody&&a)g=$(a).offset();if(b.absolute&&g!=null){c=g.left;d=b.at[1]=="top"?g.top:g.top+b.parent.outerHeight()}f=b.my[0]=="right"?c-(this.element.outerWidth()-b.parent.outerWidth()):c;e=b.my[1]=="top"?d:d-this.element.outerHeight();b.absolute?this.element.css("position","absolute"):this.element.css("position","relative");if(b.my[0]!="right")this.element.css({left:f+
b.offset.x,top:e+b.offset.y});else{a=0;if(b.appendToBody)a=$("body").width()-(g.left+b.parent.width());this.element.css({right:a,top:e+b.offset.y})}b.width&&this.element.width(b.width)},open:function(a){this.isOpen=true;var b=this.options;b.selectedParent=$(a);this.setPosition(a);if(b.closed){this.element.show();if(b.parentCorners){b.parent.removeClass("ui-corner-all");b.parent.addClass(b.parentCorners)}b.parentShadow&&b.parent.addClass("ui-wbs-shadow"+b.shadow_prefix[1]);b.closed=false;b.open(a)}else this.close()},
close:function(){var a=this.options;this.element.hide();a.parentCorners&&a.parent.addClass("ui-corner-all");a.parentShadow&&a.parent.removeClass("ui-wbs-shadow"+a.shadow_prefix[1]);a.closed=true;a.close()}});$.widget("ui.wbsMenu",{options:{selectName:"",source:"json",width:false,offset:{x:0,y:0},stateful:false,direction:"down",onSelect:function(){return false}},_createItem:function(a,b){b||(b="");var c=$("<div class='ui-menu-item ui-widget-content' rel='"+b+"'></div>");$(a).length?c.append($(a).html($(a).text().replace(/\s/g,"&nbsp;"))):c.append(a.replace(/\s/g,"&nbsp;"));return c},_setWidth:function(){var a=this,b=a.options,c=$(".ui-menu-item",a.content);if(b.width)a.content.css("width",b.width);else a.header.width()>=
a.content.width()?a.content.width(a.header.width()):a.content.css("width","auto");c.each(function(){$(this).outerWidth(true)>a.content.width()&&a.content.width($(this).outerWidth(true))})},_create:function(){var a=this,b=this.options;this.menu=$("<div style='position:relative;float:left;'/>");this.header=$("<div />");this.content=$("<div/>");this.clone=this.element.clone();this.menu.addClass("ui-widget");if(b.direction=="down")var c="ui-corner-left",d="ui-corner-tl",f="ui-corner-left-deleted",e="ui-corner-right",
g="ui-corner-tr",h="ui-corner-right-deleted",i="ui-corner-all",k="ui-corner-top",j="ui-corner-all-deleted";else{c="ui-corner-left";d="ui-corner-bl";f="ui-corner-left-deleted";e="ui-corner-right";g="ui-corner-br";h="ui-corner-right-deleted";i="ui-corner-all";k="ui-corner-bottom";j="ui-corner-all-deleted"}if(b.source=="json"){for(var m in b.items){var l=$(a._createItem(b.items[m].name,b.items[m].value));a.content.append(l);l.mousedown(b.items[m].callback);l.mousedown(b.onSelect)}this.header.append(this.clone.addClass("ui-menu-header ui-corner-all"));
this.menu.append(this.header);this.menu.append(this.content);this.element.replaceWith(this.menu);$(".ui-menu-item",this.content).mousedown(function(){if(b.stateful){$(".ui-menu-item",this.content).removeClass("ui-state-active");$(this).addClass("ui-state-active")}a.content.wbsPopup("close")})}$(".ui-menu-item",this.content).hover(function(){$(this).addClass("ui-state-default")},function(){$(this).removeClass("ui-state-default")});this.header.css("z-index","5000");this.header.click(function(o){o.preventDefault()});
if(b.direction=="up"){m="left bottom";l="left top"}else{m="left top";l="left bottom"}this.content.wbsPopup({padding:0,parent:this.header,parentCorners:"ui-corner-top",emptyContent:true,absolute:true,offset:b.offset,my:m,at:l,open:function(){if(this.parent.children().length>1){this.parent.children(":first").hasClass(c)&&this.parent.children(":first").removeClass(c).addClass(d).addClass(f);this.parent.children(":last").hasClass(e)&&this.parent.children(":last").removeClass(e).addClass(g).addClass(h)}else this.parent.children().removeClass(i).addClass(k).addClass(j);
a._setWidth()},close:function(){if(this.parent.children().length>1){this.parent.children(":first").hasClass(f)&&this.parent.children(":first").addClass(c).removeClass(f);this.parent.children(":last").hasClass(h)&&this.parent.children(":last").addClass(e).removeClass(h)}else this.parent.children().addClass(i).removeClass(j)}});a._setWidth()}});var dragged=false;
$.widget("ui.wbsColorpicker",{options:{colors:[["FFFFFF"],["CCCCCC"],["C0C0C0"],["999999"],["666666"],["333333"],["000000"],["FFCCCC"],["FF6666"],["FF0000"],["CC0000"],["990000"],["660000"],["330000"],["FFCC99"],["FF9966"],["FF9900"],["FF6600"],["CC6600"],["993300"],["663300"],["FFFF99"],["FFFF66"],["FFCC66"],["FFCC33"],["CC9933"],["996633"],["663333"],["FFFFCC"],["FFFF33"],["FFFF00"],["FFCC00"],["999900"],["666600"],["333300"],["99FF99"],["66FF99"],["33FF33"],["33CC00"],["009900"],["006600"],["003300"],
["99FFFF"],["33FFFF"],["66CCCC"],["00CCCC"],["339999"],["336666"],["003333"],["CCFFFF"],["66FFFF"],["33CCFF"],["3366FF"],["3333FF"],["000099"],["000066"],["CCCCFF"],["9999FF"],["6666CC"],["6633FF"],["6600CC"],["333399"],["330099"],["FFCCFF"],["FF99FF"],["CC66CC"],["CC33CC"],["993399"],["663366"],["330033"]],elementsInRow:7,callback:function(){return false}},_create:function(){var a=this.options;this.wrapper=$("<div/>");for(id in a.colors){var b=a.colors[id];b=$("<div/>").addClass("ui-colorpicker-item ui-widget-content ui-corner-all").css("background",
"#"+b).attr("rel",b);b.hover(function(){$(this).addClass("ui-wbs-shadow-light")},function(){$(this).removeClass("ui-wbs-shadow-light")});b.mousedown(a.callback);this.wrapper.append(b)}this.wrapper.append("<div style='clear:both'></div>");this.wrapper.width(a.elementsInRow*18);this.element.append(this.wrapper)}});$.widget("ui.wbsEditor",{options:{showToolbar:true,buttons:[[["bold","Полужирный"],["italic","Курсив"],["underline","Подчеркивание"],["strikethrough","Зачеркнутый"]],[["forecolor","Цвет шрифта"],["backcolor","Цвет фона"]],[["left","По левому краю"],["center","По центру"],["right","По правому краю"]],[["ol","Нумерованный список"],["ul","Маркированный список"]],[["link","Добавить ссылку"],["unlink","Удалить ссылку"],["hr","Горизонтальная линия"]],[["removeFormat","Удалить форматирование"]]],
useSimpleButtons:false,simpleBtns:[[["bold","Полужирный"],["italic","Курсив"],["underline","Подчеркивание"]],[["forecolor","Цвет шрифта"],["backcolor","Цвет фона"]],[["left"],["center"],["right"]],[["ol"],["ul"]],[["indent"],["outdent"]],[["link"],["unlink"]]],fill:true,attachFiles:false,editable:true,withFrame:false,menuOffset:false,height:300,name:""},addButton:function(a,b,c,d){var f=this,e=this.options,g=$("<button/>"),h={x:0,y:0};if(e.menuOffset)h={x:0,y:25};switch(b){case "fontname":var i=
["Arial, Helvetica, sans-serif","Arial Black, Gadget, sans-serif","Courier New, Courier, monospace","Garamond, serif","Georgia, serif","Impact, Charcoal, sans-serif","Lucida Sans Unicode, Lucida Grande, sans-serif","MS Sans Serif, Geneva, sans-serif","Times New Roman, serif","Verdana, Geneva, sans-serif"],k=[];if($.browser.opera)i=["Arial","Courier,monospace","Garamond","Impact","Tahoma,sans-serif","Times,serif","Verdana"];for(key in i)k.push({name:"<span style='font-family:"+i[key]+"; font-weight:normal'>"+
i[key]+"</span>",callback:function(){var j=$("span",this).css("font-family");f.doc.execCommand("fontname",false,j);f.textarea.val(f.editablefield.html())}});g.data("onLoad",function(j){j.wbsMenu({items:k,width:270,offset:h})});break;case "fontsize":i=["xx-small","x-small","small","medium","large","x-large","xx-large"];k=[];for(key in i)k.push({name:"<span style='font-size:"+i[key]+"; font-weight:normal'>"+i[key]+"</span>",callback:function(){var j=$("span",this).text();f.doc.execCommand("fontsize",
false,parseInt($.wbs.in_array(j,i))+1,10);f.textarea.val(f.editablefield.html())}});g.data("onLoad",function(j){j.wbsMenu({items:k,width:170,offset:h})});break;case "backcolor":case "forecolor":g.data("onLoad",function(j){j.wrap('<div style="position: relative;float:left;"></div>');var m=$("<div/>");m.wbsColorpicker({callback:function(){if(b=="backcolor"&&!$.browser.msie)b="hilitecolor";f.doc.execCommand(b,false,"#"+$(this).attr("rel"));m.wbsPopup("close");f.textarea.val(f.editablefield.html());return false}});
m.wbsPopup({padding:3,parent:j,absolute:true})});break;case "link":g.data("onLoad",function(j){j.wrap('<div style="position: relative;float:left;"></div>');var m=$("<div/>"),l=$("<input value='http://' class='disable-selection-on-focus' style='width:150px' />"),o=$("<button>OK</button>").click(function(){f.doc.execCommand("createlink",false,l.val());m.wbsPopup("close");f.textarea.val(f.editablefield.html());return false});m.append("Введите адрес ссылки:").append(l).append(o);m.wbsPopup({padding:3,
width:200,parent:j,absolute:true})});g.data("clickEvent",function(){return false});b="link";break;case "showHTML":g.data("clickEvent",function(j){var m=false;m=f.options.withFrame?f.frame.css("display"):f.editablefield.css("display");if(m!="none"){$("button",f.toolbar).button("disable");$(j).button("enable");f.showTextarea()}else{$("button",f.toolbar).button("enable");f.showEditableField()}return false});break;case "hr":b="inserthorizontalrule";break;case "left":b="justifyleft";break;case "center":b=
"justifycenter";break;case "right":b="justifyright";break;case "ol":g.data("clickEvent",function(){if($.browser.webkit){var j="<span>&nbsp;</span>";f.editablefield.prepend(j)}f.doc.execCommand("insertorderedlist",false,"");$.browser.webkit&&f.editablefield.html(f.editablefield.html().replace(j,""))});break;case "ul":g.data("clickEvent",function(){if($.browser.webkit){var j="<span>&nbsp;</span>";f.editablefield.prepend(j)}f.doc.execCommand("insertunorderedlist",false,"");$.browser.webkit&&f.editablefield.html(f.editablefield.html().replace(j,
""))});break;case "img":g.data("onLoad",function(j){j.wrap('<div style="position: relative;float:left;"></div>');var m=$("<div/>"),l=$("<input type='file' name='files[]' />").clone();l.change(function(){var o=l.clone(),n=$("<button>X</button>").button().click(function(){p.remove();m.wbsPopup("open")}),p=$("<div/>").append(o).append(n);m.prepend(p);l.val("")});m.append(l);m.wbsPopup({padding:3,width:200,parent:j,absolute:true,offset:h})});g.data("clickEvent",function(){return false});b="insertimage";
break;case "hello":c="<b>Hello, world!</b>";g.data("clickEvent",function(j){$.browser.msie?document.selection.createRange().pasteHTML("<b>Hello world!</b>"):f.doc.execCommand("InsertHTML",false,$(j).data("param"))})}g.append(a);g.data("command",b);g.data("param",c);g.button({icons:{primary:"ui-icon-editor-"+b},text:false});g.mousedown(function(){var j=$(this);$.browser.msie&&f.editablefield.focus();if(typeof j.data("clickEvent")=="function")j.data("clickEvent")(j);else{var m=j.data("command");j=j.data("param");
f.doc.execCommand(m,false,j);f.textarea.val(f.editablefield.html())}});g.click(function(){return false});if(d){this.cleardiv.remove();this.toolbar.append(g);this.toolbar.append(cleardiv);return g}return g},_create:function(){var a=this,b=this.options,c=this.element.html();if(b.useSimpleButtons)b.buttons=b.simpleBtns;a.frame=$('<iframe border="0"></iframe>');a.doc=false;if(!b.withFrame)a.doc=document;this.element.empty();this.element.addClass("wbs-resizable ui-editor ui-widget ui-widget-content ui-helper-clearfix ui-corner-all");
this.toolbar=$("<div/>").addClass("ui-editor-toolbar ui-widget-header ui-corner-top");this.editablefield=$("<div/>").addClass("ui-editor-editablefield");if(b.editable){this.editablefield.attr("contenteditable",true);b.withFrame||$.browser.mozilla&&this.editablefield.append("<span></span><p><br/></p>")}this.textarea=$("<textarea></textarea>").addClass("ui-editor-textarea").css({position:"relative",top:"-1px"}).hide();this.element.attr("name")&&this.textarea.attr("name",this.element.attr("name"));b.name&&
this.textarea.attr("name",b.name);b.withFrame||a.editablefield.blur(function(){a.setTextareaContent()});for(var d in b.buttons){var f=$("<div/>"),e;for(e in b.buttons[d]){var g=b.buttons[d][e],h=g[0];g=this.addButton(g[1]?g[1]:h,h,g[2]?g[2]:"");f.append(g);g.focus(function(i){i.preventDefault();a.frame.focus()})}f.buttonset();this.toolbar.append(f)}this.cleardiv=$('<div style="clear: both"/>');this.toolbar.append(this.cleardiv);this.element.parent().append(this.textarea);if(b.showToolbar){this.element.append(this.toolbar);
$("button",this.toolbar).each(function(){var i=$(this);typeof i.data("onLoad")=="function"&&i.data("onLoad")(i)})}if(b.withFrame){this.element.append(a.frame);a.frame.width("100%");setTimeout(function(){a.doc=a.frame[0].contentWindow.document;a.doc.designMode="On";var i=$("body",a.doc);i.css({margin:0,padding:"10px",overflow:"auto",background:"white"});var k=a.editablefield.html();i.attr("class",a.editablefield.attr("class"));a.editablefield=i;k!=""?a.setContent(k):a.setContent(c);$("body").click(function(){a.textarea.is(":visible")||
a.setTextareaContent()});$("a",i).live("click",function(){a.showLinkEditDiv($(this))});a.frame.focus();a.frame.height(b.height)},$.browser.mozilla?1E3:200)}else{this.element.append(this.editablefield);a.setContent(c);$(".ui-editor-editablefield a",this.element).live("click",function(){a.showLinkEditDiv($(this))})}if(b.attachFiles){d=$("<div class='ui-editor-attachments'/>");$attach_link=$('<a href="javascript:void(0)" id="attach_link" class="attach_link">Приложить файл</a>');$attach_div=$("<div id='attach_div' class='attach_div'/>");
$input=$("<input type='file' name='files[]' />");d.append($attach_link);this.element.append(d);$attach_link.after($attach_div.append($input));$input.css({height:"1.4em",opacity:0,position:"relative",left:"-105px"});$attach_div.css({opacity:0,position:"relative",top:"-1.3em",width:100,height:"1.4em",overflow:"hidden"});$attach_div.hover(function(){$attach_link.css("text-decoration","underline")},function(){$attach_link.css("text-decoration","none")});$input.change(function(){var i=a.element.find("#attach_div"),
k=i.find("input"),j=$("<button>Удалить файл</button>").button({text:false,icons:{primary:"ui-icon-circle-close"}}).click(function(){m.remove()}),m=$("<div class='attached-file'/>").append(k).append("<span>"+k.val()+"</span>").append(j);k.hide();a.element.find("#attach_link").before(m);i.append(k.clone(true).val("").show())})}this.element.append(this.textarea);this.resize()},focus:function(){this.frame.focus()},showLinkEditDiv:function(a){var b=this,c=$("<div/>"),d=$("<input value='"+a.attr("href")+
"' class='disable-selection-on-focus' style='width:250px' />"),f=$("<button>OK</button>").button().click(function(){a.attr("href",d.val());c.wbsPopup("close");b.textarea.val(b.editablefield.html());return false});c.append("Редактировать адрес ссылки").append(d).append(f);c.wbsPopup({padding:3,width:300,parent:b.toolbar,offset:{x:a.offset().left,y:a.offset().top+a.height()},parentShadow:false,parentCorners:false,toggledByParent:false,absolute:true,close:function(){c.remove()}});c.wbsPopup("open")},mozillaHacks:function(a){if(!this.options.withFrame){var b=
a.search("<span></span><p>");if($.browser.mozilla&&b!=0)a=a.length>0?"<span></span><p>"+a+"</p>":"<span></span><p><br/></p>"}return a},loadContent:function(a){var b=this;a.uid=(new Date).getTime();b.setContent('<div class="request-loading"><img src="img/ajax-loader32.gif"/><span>Загрузка&hellip;</span></div>');if(a.ajax){$.wbs.currentUrl=a.url;if(!$.wbs.get("load-uid")){$.wbs.set("load-uid",a.uid);$.get(a.url,function(c){if($.wbs.get("load-uid")==a.uid){b.element.show();$(".grid-tbody tr").length&&
b.setContent(c);b.resize();$.wbs.set("load-uid",0);typeof a.callback=="function"&&a.callback()}})}}},setContent:function(a){var b=this;if($.browser.msie)typeof b.frame[0].contentWindow!="unknown"?setTimeout(function(){$(b.frame[0].contentWindow.document.body).html(a)},100):b.editablefield.html(a);else b.editablefield.html(a);b.textarea.val(a)},getContent:function(){this.setTextareaContent();return this.textarea.val()},setEditableFieldContent:function(){if(this.options.withFrame)this.frame[0].contentWindow.document.body.innerHTML=
this.textarea.val();else this.editablefield.html(this.textarea.val())},setTextareaContent:function(){if(this.options.withFrame)this.frame[0].contentWindow!=null&&this.textarea.val(this.frame[0].contentWindow.document.body.innerHTML);else this.textarea.val(this.editablefield.html())},showTextarea:function(){var a=this.options;this.setTextareaContent();a.withFrame?this.frame.hide():this.editablefield.hide();this.textarea.show();a.withFrame?this.textarea.height(this.frame.height()):this.textarea.height(this.editablefield.height());
this.textarea.css("width","99%")},showEditableField:function(){this.textarea.hide();this.options.withFrame?this.frame.show():this.editablefield.show();this.setEditableFieldContent()},toggleToolbar:function(){if($(".ui-editor-toolbar",this.element).length==0){this.options.showToolbar=true;this.element.prepend(this.toolbar)}else{this.options.showToolbar=false;this.toolbar.detach()}},resize:function(){var a=this.options;if(a.fill){var b=0;if(a.showToolbar)b=this.toolbar.height();if(this.element.attr("id")==
"textarea"){b=40;$(".ticket-toolbar-top").css("top",this.element.offset().top+b);$("#leftPanel").is(":visible")?$(".ticket-toolbar-top .backlink").css("margin-left",$("#leftPanel").width()):$(".ticket-toolbar-top .backlink").css("margin-left",0)}this.editablefield.height(this.element.parent().height()-b);this.textarea.height(this.editablefield.height())}else{this.editablefield.height(a.height);this.textarea.height(a.height)}},destroy:function(){this.textarea.remove();this.editablefield.remove();this.element.removeClass("ui-editor ui-widget-content ui-corner-all").removeData("editor");
return this},empty:function(){this.textarea.empty();this.editablefield.empty()}});$.wbs=$.extend(true,$.wbs,$.ui);
$.wbs=$.extend(true,$.wbs,{version:"1.0",ajaxComplete:function(a,b){if(a){if(a.status=="ERR"&&typeof a.error=="string")if(typeof console!="undefined"){console.log("Ajax request:",b);console.log("Ajax error:",a.error)}if(a.status=="OK"&&a.data!==undefined)return a.data}else if(typeof console!="undefined"){console.log("Ajax request:",b);console.log("Ajax error:",a.error)}return false},ajaxRequest:function(a){var b=$.extend({},{async:true,ifModified:false,dataType:"json",requestMethod:"get",url:"/",
data:[]},a);$.ajax({async:b.async,url:b.url,dataType:b.dataType,type:b.requestMethod,ifModified:b.ifModified,data:b.data,error:function(c,d){typeof console!="undefined"&&console.log("Ajax error: ",d)},success:function(c){data=$.wbs.ajaxComplete(c,this);typeof b.callback=="function"&&data!==null&&b.callback(data)}});return true},getById:function(a,b){return b&&b.attr("id")!=a?$("#"+a,b):$("#"+a)},getData:function(a){return $.extend(true,$("#"+a),$.data(document.getElementById(a)))},setData:function(a,
b,c){return $.data(document.getElementById(a),b,c)},get:function(a){return $.data(document.body,a)},set:function(a,b){return $.data(document.body,a,b)},getLayout:function(a){return this.getData(a).layout},getClosestLayout:function(a){return this.getData($("#"+a).closest(".ui-layout").attr("id")).layout},getFirstChild:function(a){for(var b in a)return{id:b,value:a[b]};return{id:false,value:false}},in_array:function(a,b){for(var c in b)if(b[c]==a)return c;return false},cnt:0,getObjByKey:function(a,
b,c){if(c){for(var d in b)if(d!="data")if(!(this.getObjByKeyResult&&this.getObjByKeyResult.id==a))if(typeof b[d]=="object")if(b[d].id!=a)this.getObjByKey(a,b[d],true);else{this.getObjByKeyResult=b[d];break}return this.getObjByKeyResult}else{if(b.hasOwnProperty(a))return b[a];return false}},collectSiblings:function(a){var b=$("<div/>"),c;for(c in a)b.append(a[c]);return b.children()},override:function(a,b){return $.extend(true,$.extend(true,{},a),b)},trim:function(a,b){a=a.replace(/^\s\s*/,"").replace(/\s\s*$/,
"");if(b===true)return encodeURIComponent(a);else if(b===false)return decodeURIComponent(a);return a},is_numeric:function(a){return(typeof a==="number"||typeof a==="string")&&a!==""&&!isNaN(a)},camelCase:function(a){var b="";for(key in a)if(key==0)b=a[key].substr(0,1).toLowerCase()+a[key].substr(1);else b+=a[key].substr(0,1).toUpperCase()+a[key].substr(1);return b},sizeType:function(){return{width:0,height:0}},classType:function(){return{name:0,value:0}},encHTML:function(a){return a.replace(/&/g,
"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},decHTML:function(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")},loadHash:function(a){a=a;a=a.replace(/\/\//g,"/");a=a.replace(/^.*#/,"");if(location.hash.length<2){location=location.protocol+"//"+location.host+location.pathname+"#"+a;return false}if(parent&&!$.browser.msie)parent.window.location.hash=a;else location.hash=a;return true},toggleHashParam:function(a){location.hash.search(a)==-1?this.addToHash(a):this.removeFromHash(a)},
addToHash:function(a){var b=location.hash;if(b.search(a)==-1)b+="/"+a+"/";this.loadHash(b)},removeFromHash:function(a){var b=location.hash;if(b.search(a)>-1)b=b.replace(a,"");this.loadHash(b)},implode:function(a,b){var c="",d="",f="";if(arguments.length===1){b=a;a=""}if(typeof b==="object")if(b instanceof Array)return b.join(a);else{for(c in b){d+=f+b[c];f=a}return d}else return b}});
$.fn.extend({insertAtCaret:function(a){this.each(function(){if(document.selection){this.focus();sel=document.selection.createRange();sel.text=a;this.focus()}else if(this.selectionStart||this.selectionStart=="0"){var b=this.selectionStart,c=this.selectionEnd,d=this.scrollTop;this.value=this.value.substring(0,b)+a+this.value.substring(c,this.value.length);this.focus();this.selectionStart=b+a.length;this.selectionEnd=b+a.length;this.scrollTop=d}else{this.value+=a;this.focus()}})},appendToDeepest:function(a){var b=
$(a).find(":last");b.length>0?b.append(this):$(a).append(this)},hasVisibleScrollbar:function(){var a=$.wbs.sizeType();this.children().each(function(){var b=$(this);b.rightPoint=b.outerWidth(true);if(a.width<b.rightPoint)a.width=b.rightPoint;b.bottomPoint=b.outerHeight(true);if(a.height<b.bottomPoint)a.height=b.bottomPoint})},selectAndFocus:function(){$(this).select();$(this).focus()},addError:function(a,b){var c=$(this),d="",f="";f=c.hasClass("ui-editor-editablefield")?$('label[for="'+c.parent().attr("id")+
'"]').text():$('label[for="'+c.attr("id")+'"]').text();f=f.replace(":","");c.keyup(function(){d=c.is(":input")?c.val().trim():c.text().trim();switch(a){case "required":var e="err_"+c.attr("id");if(d==""){if(!$("#"+e).length){$(".errors-msgbox",c.closest("form")).append('<p id="'+e+'">Поле "'+f+'" должно быть заполнено</p>');c.addClass("error ui-state-error")}}else{$("#err_"+c.attr("id")).remove();c.removeClass("error ui-state-error")}break;case "any":var g=true,h="";for(key in b){h=b[key];h=h.is(":input")?
h.val().trim():h.text().trim();if(h!="")g=false}e=h="";var i=[];h=$("<p>Одно из этих полей должно быть заполнено: </p>");i.push('"'+f+'"');for(key in b){e=b[key].hasClass("ui-editor-editablefield")?$('label[for="'+b[key].parent().attr("id")+'"]').text():$('label[for="'+b[key].attr("id")+'"]').text();e=e.replace(":","");i.push('"'+e+'"')}e="err_"+$.wbs.implode("",i.sort()).replace(/"/gi,"");if(d==""&&g){if(!$("#"+e).length){h.append($.wbs.implode(", ",i.sort()));h.attr("id",e);$(".errors-msgbox",
c.closest("form")).append(h);c.addClass("ui-state-error");for(key in b)b[key].addClass("ui-state-error")}}else{$("#"+e).remove();c.removeClass("ui-state-error");for(key in b)b[key].removeClass("ui-state-error")}}});c.blur(function(){$(this).keyup()})}});var focusedElement=null;$(":input").live("focus",function(){focusedElement=this});$(":input").live("blur",function(){focusedElement=null});jQuery.focused=function(){if(focusedElement)return $(focusedElement).is(":visible");return focusedElement};
jQuery.cookie=function(a,b,c){if(typeof b!="undefined"){c=c||{};if(b===null){b="";c.expires=1}var d="";if(c.expires&&(typeof c.expires=="number"||c.expires.toUTCString)){if(typeof c.expires=="number"){d=new Date;d.setTime(d.getTime()+c.expires*24*60*60*1E3)}else d=c.expires;d="; expires="+d.toUTCString()}var f=c.path?"; path="+c.path:"",e=c.domain?"; domain="+c.domain:"";c=c.secure?"; secure":"";document.cookie=[a,"=",encodeURIComponent(b),d,f,e,c].join("")}else{b=null;if(document.cookie&&document.cookie!=
""){c=document.cookie.split(";");for(d=0;d<c.length;d++){f=jQuery.trim(c[d]);if(f.substring(0,a.length+1)==a+"="){b=decodeURIComponent(f.substring(a.length+1));break}}}return b}};(function(a){a.wbs.controller={request:function(b){if(b){b=b.replace(/^.*#/,"");a(".ui-tree .ui-state-highlight").removeClass("ui-state-highlight");a(".empty-bin-link").remove();a(".refresh-link").show();b=b.split("/");if(b[0]){this.currentHash="#";for(var c in b)b[c]=="id"||b[c-1]=="id"||(this.currentHash+=b[c]+"/");var d="#/"+b[0]+"/";if(b.length>1)d+=b[1]+"/";if(a.wbs.in_array("assigned",b)||a.wbs.in_array("state",b))d+=b[2]+"/";d.indexOf("search")==-1&&a.cookie("last-action-hash",d);a(".ui-tree a").each(function(){if(a(this).attr("href").indexOf(d)>
-1){a(this).addClass("ui-state-highlight");var h=a(this).text();a("#title h1").html(h);document.title=h+" \u2014 Поддержка"}});var f="",e=b.length;for(hashId in b){var g=b[hashId];if(hashId<2)if(hashId==0)f=g;else f+=g.substr(0,1).toUpperCase()+g.substr(1);else{e=hashId;break}}for(c in gridData.data.headers.data){g=gridData.data.headers.data[c];if(g.options.cssClass.search("ui-grid-th-assigned_c_id")!=-1||g.options.cssClass.search("ui-grid-th-state_id")!=-1||g.options.cssClass.search("ui-grid-th-new_window")!=
-1)if(a.wbs.in_array(f,["requestsVerification","requestsTrash"])){if(g.options.cssClass.indexOf("ui-hidden")<0)g.options.cssClass+=" ui-hidden"}else g.options.cssClass=g.options.cssClass.replace("ui-hidden","")}b=b.slice(e);if(this[f+"Action"]){c=parseInt(a.wbs.in_array("id",b),10);c=b[c+1];a.wbs.set("current-request-id",c);f!=this.currentAction&&delete gridData.requestData.search;this.currentAction=f;this.currentActionAttr=b;this[f+"Action"](b)}else console&&console.log("Invalid action name:",f+
"Action")}else this.defaultAction()}else this.defaultAction()},onLoad:function(){if(a("#container").length){a.wbs.widgets.toggleLoading("body");a("#container").width(a(window).width());a("#container").height(a(window).height());var b=null,c=function(){a("#container").width(a(window).width());a("#container").height(a(window).height());a("#container").layout("resizeAll")},d=a.browser.mozilla;a(window).resize(function(){if(d){b&&clearTimeout(b);b=setTimeout(c,50)}else c()})}var f=false;a("input[type=text]").live("click",
function(){!f&&!a(this).hasClass("disable-selection-on-focus")&&this.select();f=true});a("input[type=text]").live("blur",function(){f=false});a("input[type=button], button").live("click",function(){return false});a(".tabs-nav li a").live("click",function(){a(this).parent().parent().children().removeClass("tabs-selected");a(this).parent().addClass("tabs-selected")});a("body").ajaxComplete(function(h,i){if(i.responseText.search("SESSION_TIMEOUT")>0){var k=i.responseText;k=/redirectUrl: '(\S+)'/.exec(k);
if(k[1])(window&&window.parent?window.parent.document:document).location.href=k[1]}});setInterval(function(){if(a("#grid").is(":visible")||location.hash.indexOf("full")>0)a.wbs.widgets.showChangesInRequests(a.wbs.get("timestamp"))},6E4);var e=function(h){a.wbs.widgets.showAlertMsg(a("#topPanel"),h)},g=function(){a.get("?m=requests&act=check",function(h){h=a.parseJSON(h);if(h.status=="ERR")if(typeof h.error=="object")for(key in h.error)e(h.error[key]);else typeof h.error=="string"&&e(h.error)})};g();
(new Date).getTime();setInterval(g,6E4);a(document).keypress(function(h){if(a.focused()!==true)switch(h.which){case 56:if(a("#bottomPanel").is(":visible")){h=a("#table .ui-grid-column-id[rel='"+parseInt(a("#table .ui-grid-column-id.ui-state-highlight").text())+"']").parent().prev();a("#grid").wbsGrid("selectBlock",parseInt(a("td:first",h).text(),10),true)}else a(".ui-grid-wrapper").scrollTo("-=20px");break;case 50:if(a("#bottomPanel").is(":visible")){h=a("td:first",a("#table .ui-grid-column-id[rel='"+
parseInt(a("#table .ui-grid-column-id.ui-state-highlight").text())+"']").parent().next()).text();a("#grid").wbsGrid("selectBlock",parseInt(h,10),true)}else a(".ui-grid-wrapper").scrollTo("+=20px")}});a.wbs.set("current-hash","#/requests/all/")},init:function(b){var c=this;if(a("#container").length){var d={hiddenPanels:[],hiddenElements:[]};a.extend(true,d,b);b={layoutMarkupId:"mainLayout",onResize:function(){a("#grid").wbsGrid("resize");a("#textarea").wbsEditor("resize");a("#contentPanel").layout("resizeAll")}};
a.extend(true,b,d);a("#container").layout(b)}if(typeof a.History!="undefined"){a.History.bind(function(f){c.request(f)});d=parent?parent.window.location.hash:location.hash;d.length<2?c.defaultAction():a.wbs.loadHash(d)}a("a[href='#']").live("click",function(){return false});a("a[href^='#']").live("click",function(){a.wbs.loadHash(this.href);return false})},requestsSearchAction:function(b){a.cookie("single-panel-view")=="true"&&a.cookie("single-panel-view","false");delete gridData.requestData.filter;
b[0]=a.wbs.trim(b[0]);gridData.requestData.search=b[0];a.wbs.pages.mainPage("search="+b[0]);a("#searchRequestInput").val(b[0]);a("#title h1").html('Результаты поиска для "'+b[0]+'"');document.title="Результаты поиска \u2014 Поддержка"},requestsAdvsearchAction:function(b){a.cookie("single-panel-view")=="true"&&a.cookie("single-panel-view","false");var c="",d="",f=false,e;for(e in b){b[e]=a.wbs.trim(b[e],false);if(e>0&&b[e-1]=="name"){c+="|name|"+b[e];d+="и имя клиента <b>"+b[e]+
"</b> ";a("#adv-search-name").val(b[e])}if(e>0&&b[e-1]=="email"){c+="|email|"+b[e];d+="и email клиента <b>"+b[e]+"</b> ";a("#adv-search-email").val(b[e])}if(e>0&&b[e-1]=="clientid"){c+="|clientid|"+b[e];d+="и номер клиента <b>"+b[e]+"</b> ";a("#adv-search-id").val(b[e])}if(e>0&&b[e-1]=="subject"){c+="|subject|"+b[e];f=true;d+="и слова <b>"+b[e]+"</b> ";a.wbs.in_array("words",b)||(d+="в тема");a("#adv-search-in-subject").attr("checked","checked");a("#adv-search-in-request").removeAttr("checked");
a(".adv-search-words-mode").removeAttr("disabled");a("#adv-search-words").val(b[e])}if(e>0&&b[e-1]=="words"){c+="|words|"+b[e];f||(d+="и слова <b>"+b[e]+"</b> ");a("#adv-search-words").val(b[e]);a(".adv-search-words-mode").removeAttr("disabled")}if(e>0&&b[e-1]=="wmode"){c+="|wmode|"+b[e];var g="";if(f)g="тема и ";switch(b[e]){case "1":d+="в "+g+"тексте запроса";a("#adv-search-in-request").attr("checked","checked");break;case "2":d+="в "+g+"ответах и обсуждениях";
a("#adv-search-in-log").attr("checked","checked");break;case "3":d+=f?"в тема, тексте запроса, ответах и обсуждениях":"в тексте запроса, ответах и обсуждениях";a("#adv-search-in-log").attr("checked","checked");a("#adv-search-in-request").attr("checked","checked")}d+=" "}if(e>0&&b[e-1]=="user"){c+="|user|"+b[e];g="";var h=a.wbs.get("users"),i;for(i in h)if(h[i].id==b[e])g=h[i].name;d+="и пользователь <b>"+g+"</b> ";a("#adv-search-users").val(b[e])}if(e>0&&b[e-1]=="umode"){c+=
"|umode|"+b[e];switch(b[e]){case "1":d+="ответил на запрос";a("#adv-users-reply").attr("checked","checked");break;case "2":d+="выполнял другие действия";a("#adv-users-comments").attr("checked","checked");break;case "3":d+="ответил на запрос или выполнял другие действия";a("#adv-users-comments").attr("checked","checked");a("#adv-users-reply").attr("checked","checked")}d+=" "}}delete gridData.requestData.filter;c=c.substr(1,c.length);d=d.replace("и","");gridData.requestData.search=
c;a.wbs.pages.mainPage(c);a("#title h1").html("Результаты поиска");$search_params=a('<div id="search-params"><span>'+d+"</span></div>");a("label, span",$search_params).click(function(){a("#adv-search").wbsPopup("open")});a("#search-params").length||a("#title").append($search_params);a("#adv-search-btn-search").button("enable");document.title="Результаты поиска \u2014 Поддержка"},requestsAllAction:function(){a.wbs.pages.mainPage("filter=open")},requestsStateAction:function(b){a.wbs.pages.mainPage("filter=state-"+
b[0])},showEmptyBinDialog:function(b){a(".refresh-link").hide();var c=a('<a class="empty-bin-link" href="javascript:void(0)">'+(b=="-1"?"Очистить корзину":"Очистить эту папку")+"</a>").css("float","right"),d=a("<p>Все запросы будут удалены без возможности восстановления.<br/><br/>Удалить запросы?</p>");c.click(function(){a(".grid-tbody tr").length?d.dialog({modal:true,title:"Подтверждение",buttons:{"Да":function(){a.wbs.ajaxRequest({url:"?m=requests&act=emptybin",requestMethod:"post",
data:{state:b},callback:function(){gridData.updatePage();a("#textarea > div").empty();d.dialog("close")}})},"Нет":function(){a(this).dialog("close")}},zIndex:1E4}):a("<p>Папка пуста</p>").dialog({modal:true,title:"Подтверждение",buttons:{OK:function(){a(this).dialog("close")}},zIndex:1E4})});c.css({top:a("#mainPage").offset().top+10});a("body").append(c)},requestsTrashAction:function(){a.wbs.pages.mainPage("filter=trash");this.showEmptyBinDialog(-1)},requestsVerificationAction:function(){a.wbs.pages.mainPage("filter=verification");
this.showEmptyBinDialog(0)},requestsArchiveAction:function(){a.wbs.pages.mainPage("filter=archive");a(".refresh-link").hide()},requestsNotassignedAction:function(){a.wbs.pages.mainPage("filter=notassigned")},requestsMyAction:function(){a.wbs.pages.mainPage("filter=my")},requestsAssignedAction:function(b){var c="filter=assigned-"+b[0];if(a.wbs.in_array("all",b))c+="-all";a.wbs.pages.mainPage(c)},requestsUnreadAction:function(){a.wbs.pages.mainPage("filter=unread")},requestsAddAction:function(){a.wbs.pages.loadPage("?m=requests&act=add")},
sourcesAction:function(){a.wbs.pages.loadPage("?m=sources")},settingsAction:function(){a.wbs.pages.loadPage("?m=settings")},sourcesEditAction:function(b){a.wbs.pages.loadPage("?m=sources&act=edit&id="+b[0])},sourcesDeleteAction:function(b){a.wbs.pages.loadPage("?m=sources&delete="+b[0])},sourcesAddAction:function(b){b.length?a.wbs.pages.loadPage("?m=sources&act=add&inner=1"):a.wbs.pages.loadPage("?m=sources&act=add")},usersAction:function(){a.wbs.pages.loadPage("?m=users")},formsAction:function(){a.wbs.pages.loadPage("?m=forms")},
formsAddAction:function(){a.post("?m=forms&act=save",{add:1,name:"Запрос в службу поддержки"},function(b){b.status=="OK"&&a.wbs.loadHash("/forms/info/"+b.data.id)},"json");return false},formsInfoAction:function(b){a("#forms-controls").show();var c=function(){a(".form-preview").show();a(".form-edit").hide()};a("#form-tabs").length?c():a.wbs.pages.loadPage("?m=forms&act=info&id="+b[0],c)},formsEditAction:function(b){var c=function(){a("#forms-controls").hide();var d=b[1]||"fields";a("#form-tabs li").removeClass("tabs-selected");
a("#form-tabs li.tab-"+d).addClass("tabs-selected");a(".tabs-body:visible").hide();a("#form-"+d).show();a(".form-preview").hide();a(".form-edit").show()};a("#form-tabs").length?c():a.wbs.pages.loadPage("?m=forms&act=info&id="+b[0],c)},formsDeleteAction:function(b){a.wbs.pages.loadPage("?m=forms&delete="+b[0])},classesAction:function(){a.wbs.pages.loadPage("?m=classes","classesContainer")},defaultAction:function(){var b=a.cookie("last-action-hash");b||(b="#/requests/all/");this.currentHash=b;$currentLeftLink=
a('.ui-tree a[href^="'+b+'"]:first');$currentLeftLink.addClass("ui-state-highlight");a.wbs.loadHash(b);if(parent)parent.window.location.hash=b;else location.hash=b}}})(jQuery);$.wbs.request={parseEmails:function(){$(".action-to").find("b").each(function(){var a=$(this),b=a.html(),c=b.split(",");b=[];for(key in c){var d=c[key].split("; ");for(key2 in d)d[key2]="<span title='"+d[key2]+"'>"+d[key2]+"</span>";b.push($.wbs.implode(", ",d))}a.html($.wbs.implode(", ",b))});$(".action-to").find("b span").each(function(){var a=$(this),b=a.html().split(" ");if(b.length>1){a.html("");for(key in b)b[key].indexOf("@")<2&&a.html(a.html()+" "+b[key]+"")}})},contactPanel:function(){var a=
this;$("#client_requests_link").click(function(){$.wbs.loadHash("#requests/advsearch/clientid/"+a.data.client_c_id+"/id/"+a.data.id)});$("#client_name").click(function(){$(".contact-panel").toggle()})},requestSidebar:function(){$(".ticket-sidebar").wbsPopup({padding:3,parentShadow:false,parent:$(".show-right-column"),absolute:true,appendToBody:true,my:"right top",at:"right bottom",open:function(){$(".show-right-column").html("скрыть подробности")},close:function(){$(".show-right-column").html("показать подробно")}});
$(".ticket-sidebar").click(function(){$(this).wbsPopup("close")});$("td:first",$("tr",$(".right-panel-block table"))).css({"text-align":"right","padding-right":"5px"})},topBtnEvents:function(){$("#detail").click(function(){$("#detail").text("Загрузка...");$.wbs.widgets.toggleTabPanel();return 0});$(".backlink").click(function(){$("#close:first").click()});if($("#gridPanel").is(":visible")){$(".maximize").html("Развернуть");$(".maximize").button({text:false,icons:{primary:"ui-icon-extlink"}});$(".backlink").hide()}else{$(".maximize").html("Свернуть");
$(".maximize").button({text:false,icons:{primary:"ui-icon-arrowreturnthick-1-s"}});$(".backlink").show()}maximize_click=function(){$(".backlink").toggle();if($("#gridPanel").is(":visible")){$(".maximize").button("option","label","Свернуть");$(".maximize span").addClass("ui-icon-arrowreturnthick-1-s").removeClass("ui-icon-extlink")}else{$(".maximize").button("option","label","Развернуть");$(".maximize span").addClass("ui-icon-extlink").removeClass("ui-icon-arrowreturnthick-1-s")}$.wbs.widgets.toggleTopPanel()&&
$.cookie("single-panel-view","false");$.wbs.getClosestLayout("textarea").resizeAll()};$("#new_window","#toolbarbuttons").button({text:false,icons:{primary:"ui-icon-newwin"}}).click(function(){window.open($.wbs.currentUrl)});$("#close","#toolbarbuttons").button({text:false,icons:{primary:"ui-icon-closethick"}}).click(function(){$.wbs.widgets.toggleBottomPanel()})},otherActionsBtn:function(){var a=this,b=$(".act-items:first"),c=b.clone(true);$("#assignMsg").hide();$("button").button();$.browser.msie||
(toolbarClone=$(".ticket-toolbar").clone(true));b.wbsPopup({parent:$("#other-actions"),myCorners:"ui-corner-bottom ui-corner-tl",fitParent:false,padding:0,appendToBody:true,absolute:true,my:"right top",at:"right bottom"});$(".ticket-toolbar").addClass("ticket-toolbar-top");if($.browser.msie){toolbarClone=$("<div/>");$("#container").length||$(".backlink").remove()}else{$("#other-actions",toolbarClone).attr("id","other-actions-clone");toolbarClone.addClass("ticket-toolbar-bottom");toolbarClone.removeClass("ticket-toolbar-top");
$("#toolbarbuttons",toolbarClone).hide();if($("#container").length)$("#ticket").after(toolbarClone);else{$("body").append(toolbarClone);$(".backlink").remove()}if($(".ticket-log-container").length>0){var d=$("<select></select>").append('<option value="ASC">старые записи наверху</option>').append('<option value="DESC">новые записи наверху</option>');b=$('<div class="log-order-div"/>').append("<span>Сортировка истории запроса:</span>").append(d);toolbarClone.append(b);$("option[value="+a.data.order+
"]",d).attr("selected","selected");d.change(function(){$.post("?m=requests&act=save",{id:a.data.id,order:d.val()},function(){if($(".ui-editor-editablefield").length)$("#textarea .ui-editor-editablefield").load("?m=requests&act=info&id="+a.data.id,function(){$(".ui-editor-editablefield").scrollTo($(".log-order-div"))});else{$(document).scrollTop($(document)[0].scrollHeight);location.reload()}})})}$("#other-actions-clone .menu-label").next().html("\u25b2");c.wbsPopup({parent:$("#other-actions-clone",
toolbarClone),parentCorners:"ui-corner-bottom",myCorners:"ui-corner-top ui-corner-bl",fitParent:false,padding:0,appendToBody:true,absolute:true,my:"right bottom",at:"right top"});toolbarClone.find(".act-items:last").remove()}},setDocTitle:function(){var a=this.data.from_name+" \u2014 "+this.data.subject;a=a.replace(/\&quot\;/gi,'"');document.title=a},toggleQuotes:function(){var a=$('<div class="show-quote" href="javascript:void(0)">- Показать цитируемый текст -</div>').click(function(){if($(this).hasClass("open")){$(this).next().hide();
$(this).html("- Показать цитируемый текст -").removeClass("open")}else{$(this).next().show();$(this).html("- Скрыть цитируемый текст -").addClass("open")}});$("#ticket div.text blockquote").each(function(){$(this).hide();a.clone(true).insertBefore(this)})},removeSignatures:function(){var a=$(".wa-st-signature blockquote:first");a.parent().parent().append(a.prev()).append(a);$(".wa-st-signature").each(function(){$(this).prev().length&&$(this).hide()})},info:function(){this.parseEmails();this.contactPanel();
this.requestSidebar();this.topBtnEvents();this.otherActionsBtn();this.setDocTitle();this.removeSignatures();this.toggleQuotes();$(".request-content a, .ticket-log-container a").attr("target","_blank");if($("#container").length){if($.browser.msie&&parseInt($.browser.version)<8){$("#ticket").css("position","relative");$("#ticket").css("top","+40px");$("#textarea").css("padding-top",0);$("#textarea > div").css("padding-bottom",40);$(".ticket-toolbar").css("width",$(".ticket-toolbar").width()-16);$(window).resize(function(){$(".ticket-toolbar").css("width",
$(window).width()-16)})}}else{document.getElementById("toolbarbuttons").style.display="none";$("#ticket-wrapper").append(toolbarClone);$("#ticket-wrapper").css("margin-top","40px");$("#ticket").css("margin-top","10px");$(".ticket-toolbar-top").css({position:"fixed",top:"40px"})}$id=this.data.id;$.wbs.set("loaded-request-id",$id);$.wbs.set("last_req_log_id",this.data.last_req_log_id);$defaultContent=$("#ticket").clone(true);$("a[href='#']").click(function(){return false})},header:function(){var a=
this,b=false,c=$("#ticket-wrapper #contact-search-form").clone();$("body > .ticket-sidebar, body > .act-items").remove();$(".request-action").click(function(){if($("#contact-search-form.ui-popup").length){$("body > #contact-search-form").remove();$("#ticket-wrapper").append(c)}$(".act-items").wbsPopup("close");var d=$(this).attr("rel").replace(/action/,""),f=$.wbs.get("request-actions")[d],e=f.type;if(e=="CLASSIFY"){if(!b){b=true;$.wbs.widgets.classChanger($id)}return false}$("div.menu div.items").hide();
autocompleteClass="contacts";var g="",h={};if(f.hasOwnProperty("properties"))if(f.properties.length>0){if((h=$.parseJSON(f.properties))&&h.hasOwnProperty("autocomplete"))autocompleteClass=h.autocomplete;if(h&&h.hasOwnProperty("to")&&h.to=="users")g=users}g||(g='<input type="text" class="autocomplete-'+autocompleteClass+' required" name="to" autocomplete="off" /><button class="contact-search-btn">Выбор контакта</button>');var i="";switch(e){case "REPLY":g='<div class="reply-to-msg">'+a.data.client_from+
'<input name="to" autocomplete="off" value="'+a.data.client_from+'" type="hidden"/></div>';case "FORWARD":i='<table width="100%" cellpadding="0" cellspacing="0" border="0" class="form-with-editor"><tr><td width="1%" class="inp-label">Кому: </td><td>'+g+'</td></tr><tr class="copy" style="display: none"><td width="1%" class="inp-label" style="margin-right:10px">Копия: </td><td><input type="text" id="copy-input" class="copy-input autocomplete-'+autocompleteClass+'" name="cc" autocomplete="off" /><button class="contact-search-btn">Выбор контакта</button></td></tr><tr class="bcc" style="display: none"><td width="1%" class="inp-label">&nbsp;Скрытая копия: </td><td><input type="text" id="bcc-input" class="bcc-input autocomplete-'+
autocompleteClass+'" name="bcc" autocomplete="off" /><button class="contact-search-btn">Выбор контакта</button></td></tr><tr><td></td><td><a href="javascript:void(0)" onclick="$.wbs.request.showChild(this, \'copy\'); $(\'#copy-input\')[0].focus();">Копия</a><a href="javascript:void(0)" style="margin-left:10px" onclick="$.wbs.request.showChild(this, \'bcc\'); $(\'#bcc-input\')[0].focus(); ">Скрытая копия</a></td></tr><tr><td></td><td><div class="wbs-editor"></div></td></tr><tr><td></td><td><div class="error" style="display:none"></div><div class="button-pane"><button class="save">Отправить</button><button class="cancel">Отмена</button></div></td></tr></table>';
break;case "FORWARD-ASSIGN":i='<table width="100%" cellpadding="0" cellspacing="0" border="0" class="form-with-editor"><tr><td width="1%" class="inp-label"><span class="assign">Кого</span>: </td><td>'+users+'</td></tr><tr class="copy" style="display: none"><td width="1%" class="inp-label" style="margin-right:10px">Копия: </td><td><input type="text" id="copy-input" class="copy-input autocomplete-'+autocompleteClass+'" name="cc" autocomplete="off" /><button class="contact-search-btn">Выбор контакта</button></td></tr><tr><td></td><td><a href="javascript:void(0)" onclick="$.wbs.request.showChild(this, \'copy\'); $(\'#copy-input\')[0].focus();">Копия</a></td></tr><tr><td></td><td>';
if(f.hasOwnProperty("properties"))if(f.properties.length>0)if((h=$.parseJSON(f.properties))&&h.hasOwnProperty("comment"))i+='<div style="margin-bottom: 10px">'+h.comment+"</div>";i+='<textarea class="comment-text" name="text" rows="5" style="width: 98%"></textarea></td></tr><tr><td></td><td><div class="error" style="display:none"></div><div class="button-pane"><button class="save">Отправить</button><button class="cancel">Отмена</button></div></td></tr></table>';break;case "ASSIGN":$to=$(users).css("width",
"100%");$editor=$("<textarea rows='5' style='width:420px;padding:10px;' name='text'></textarea>");$to.change(function(){$("option[value=0]",$to).remove();$to.val()==0?$(".ui-dialog .ui-button:first").button("disable"):$(".ui-dialog .ui-button:first").button("enable")});$label=$('<label for="sendAssignMsg">Отправить email-уведомление</label>');i=$("<div style='padding-left:10px'/>").append($to).append($("<div/>").append($editor));break;case "COMMENT":i="";if(h.copy)i='<table width="100%" cellpadding="0" cellspacing="0" border="0" class="form-with-editor"><tr class="copy"><td width="1%" class="inp-label" style="margin-right:10px">Копия: </td><td><input type="text" id="copy-input" class="copy-input autocomplete-'+
autocompleteClass+'" name="cc" autocomplete="off" /><button class="contact-search-btn">Выбор контакта</button></td></tr></table>';i+=h.editor&&h.editor=="html"?'<div class="wbs-editor comment-text"></div>':'<textarea class="comment-text" name="text" rows="5" style="width: 98%"></textarea>';i+='<div class="button-pane"><button class="save">Отправить</button><button class="cancel">Отмена</button></div>'}if(i){$(".ticket-toolbar-bottom").hide();f='<div class="action-header header" style="border-bottom-color:'+
($.wbs.get("data").states[$.wbs.get("data").actions[d].state_id]?$.wbs.get("data").states[$.wbs.get("data").actions[d].state_id].properties.css.replace("color:",""):"")+'">'+(a.data.current_user.photo!=""?'<div class="userpick"><img height="32" src="'+a.data.current_user.photo+'&size=96"></div>':"")+'<p class="action-info"><span title="" class="author">'+a.data.current_user.fullname+'</span> <span class="action">'+$.wbs.get("data").actions[d].log_name+'</span></p></div><div class="action-form text"><form class="ajax-form" method="post" enctype="multipart/form-data" action="?m=requests&act=save"><input type="hidden" name="id" value="'+
a.data.id+'" /><input type="hidden" name="action_id" value="'+d+'" /></form></div>';f=$(f);var k=f.find("form");k.append(i);if(e=="COMMENT"&&!(h.editor&&h.editor=="html")){h=$("<div class='ui-editor-attachments'/>");$attach_link=$('<a href="javascript:void(0)" id="attach_link" class="attach_link">Приложить файл</a>');$attach_div=$("<div id='attach_div' class='attach_div'/>");$input=$("<input type='file' name='files[]' />");h.append($attach_link);k.find(".comment-text").after(h);$attach_link.after($attach_div.append($input));
$input.css({height:"1.4em"});$attach_div.css({opacity:0,position:"relative",top:"-1.3em",width:200,height:"1.4em",overflow:"hidden"});$attach_div.hover(function(){$attach_link.css("text-decoration","underline")},function(){$attach_link.css("text-decoration","none")});$input.change(function(){var l=k.find("#attach_div"),o=l.find("input"),n=$("<button>Удалить файл</button>").button({text:false,icons:{primary:"ui-icon-circle-close"}}).click(function(){p.remove()}),p=$("<div class='attached-file'/>").append(o).append("<span>"+
o.val()+"</span>").append(n);o.hide();k.find("#attach_link").before(p);l.append(o.clone(true).val("").show())})}k.find(".cancel").click(function(){$("#toolbarbuttons .buttons").show();$("#action-container").empty().hide();k.find("div.wbs-editor").wbsEditor("resize")});k.find("div.wbs-editor").wbsEditor({fill:true,withFrame:true,attachFiles:true,menuOffset:true,name:"text"});if(e=="REPLY"||e=="FORWARD")k.find("div.wbs-editor").wbsEditor("setContent",$("#template-"+d).val());k.find("input.autocomplete-contact").autocomplete("?m=contacts&act=list&email=1");
k.find("input.autocomplete-users").autocomplete("?m=users&act=list&email=1");k.find(".contact-search-btn").button({text:false,icons:{primary:"ui-icon-person"}});k.find("input[name=to]").blur(function(){k.find(".wbs-editor").wbsEditor("focus")});(function(){var l="iframe-"+Math.round(Math.random()*1E6+1),o=jQuery('<iframe id="'+l+'" name="'+l+'"></iframe>').css("display","none").appendTo("body");k.attr("target",o.attr("name"));setTimeout(function(){o.load(function(){var n=o.contents().find("body").html();
if(n){$(".assignDialog").remove();if($("#textarea > .ui-editor-editablefield").length>0){n=$.parseJSON(n);if(n.status=="OK"){if(n.data.success){$("#toolbarbuttons .buttons").show();$(".assignDialog").dialog("close");$(".ui-editor-editablefield").load("?m=requests&act=info&id="+a.data.id,function(){$.wbs.widgets.toggleLoading($("#textarea"));$(".assignDialog").dialog("close");$("#textarea").wbsEditor("resize");if($(".ui-editor-editablefield").length)a.data.order=="ASC"?$(".ui-editor-editablefield").scrollTo($(".ticket-log-container:last")):
$(".ui-editor-editablefield").scrollTo($(".ticket-log-container:first"))})}}else $("<div>"+n.error+"</div>").dialog({modal:true,title:"Ошибка",buttons:{OK:function(){$(this).dialog("close");$.wbs.widgets.toggleLoading($("#textarea"));$("#grid").wbsGrid("selectBlock",$.wbs.get("current-request-id"))}},zIndex:1E4})}else{$.wbs.widgets.toggleLoading($("body"));location.reload()}typeof gridData!="undefined"&&gridData.updateBlock(a.data.id)}})},100)})();k.submit(function(){$(".ticket-toolbar-bottom").show();
var l=false;$(this).find(".required").each(function(){if(!$(this).val()||$(this).val()=="0"){l=true;$(this).addClass("error").focus(function(){$(this).removeClass("error")})}});if(l){$(this).find("div.error").html("Пожалуйста, заполните обязательные поля").show();return false}else $(this).find("div.error").empty().hide();$("#textarea > .ui-editor-editablefield").length>0?$.wbs.widgets.toggleLoading($("#textarea")):$.wbs.widgets.toggleLoading($("body"))});if(e!="ASSIGN"){$("#action-container").addClass("ticket-log-container").empty().append(f);
if(a.data.order=="ASC"){$("#ticket").append($("#action-container"));$("#textarea").length?setTimeout(function(){$("#textarea .ui-editor-editablefield").scrollTo($("#action-container"))},100):$(document).scrollTop($("body").height())}else{$("#info-container").after($("#action-container"));$("#textarea").length?setTimeout(function(){$("#textarea .ui-editor-editablefield").scrollTo($("#action-container"))},100):$(document).scrollTop(0)}$("#action-container").show();$("textarea",k).focus()}else{var j=
$(".assignDialog").clone();j.empty();j.append(f);j.dialog({title:"Изменить назначение",width:500,modal:true,buttons:{"Назначить":function(){$(".ajax-form .ui-editor").wbsEditor("setTextareaContent");k.submit();j.remove()},"Отмена":function(){j.remove()}},zIndex:1E4});$("textarea",f).focus();a.data.assigned_c_id==0&&$(".ui-dialog .ui-button:first").button("disable");j.css("padding",0);$(".action-header",j).hide();j.css("min-height",$(".action-form",j).height())}$(".save").click(function(){$(".wbs-editor").wbsEditor("setTextareaContent");
k.submit()});$(".cancel").click(function(){$(".ticket-toolbar-bottom").length&&$(".ticket-toolbar-bottom").show();$("#textarea").wbsEditor("resize")});$(".knowledge").click(function(){if($("#container").length>0)if($("#knowledge").is(":visible")){$("#knowledge, #splitter3").hide();$("#textarea").css("width","100%")}else{$("#knowledge, #splitter3").show();$("#textarea").css("width","50%");$.wbs.getClosestLayout("knowledge").resizeAll();$.wbs.widgets.loadKnowledge($("#knowledge"))}else{$("#textarea").length||
$("body").append("<div id='knowledge' style='float: left; display:none;position:relative'/>");if($("#knowledge").is(":visible")){$("#knowledge").hide();$("#textarea").css("width","100%")}else{$("#knowledge").show();$("#ticket-wrapper, #knowledge").css({width:"50%","float":"left"});$.wbs.widgets.loadKnowledge($("#knowledge"))}}});$(".save, .cancel, .knowledge").button()}else $.post("?m=requests&act=save",{id:a.data.id,action_id:d},function(l){if(l.status=="OK")switch(l.data.type){case "REMOVE":case "DELETE":$(".ui-editor-editablefield").length>
0?$(".ui-editor-editablefield:first").html('<p class="request-deleted-msg" style="text-align:center">Запрос был удален.</p>'):$("#ticket").html("Запрос был удален.");typeof gridData!=="undefined"&&gridData.deleteBlock(a.data.id);break;default:$(".ui-editor-editablefield").length>0?$(".ui-editor-editablefield").load("?m=requests&act=info&id="+a.data.id):location.reload()}else $("<div>"+l.error+"</div>").dialog({modal:true,buttons:{OK:function(){$(this).dialog("close")}},zIndex:1E5});
typeof gridData!=="undefined"&&gridData.updateBlock(a.data.id)},"json");var m=$("#contact-search-form-content:first");$("#tabs-search-browse a").click(function(){var l=$("<div/>");$.cookie("last-contact-search-tab","#tabs-search-browse");m.empty().append(l);l.wbsSearchlist({filter:"input"});l.find("input:first").focus()});$("#tabs-search-contacts a").click(function(){var l=$("<div/>");$.cookie("last-contact-search-tab","#tabs-search-contacts");m.empty().append(l);l.wbsSearchlist({filter:"select",
filterSource:"?m=contacts&act=folderlist",source:"?m=contacts&act=list&byfolder=1"})});$("#tabs-search-users a").click(function(){var l=$("<div/>");m.empty().append(l);$.cookie("last-contact-search-tab","#tabs-search-users");l.wbsSearchlist({source:"?m=users&act=list&noid=1&email=1",loadOnCreate:true,hideInput:true,disableScroll:true})});$(".tabs-nav li a").click(function(){$(this).parent().parent().children().removeClass("tabs-selected");$(this).parent().addClass("tabs-selected")});$("#contact-search-form").wbsPopup({parent:$(".contact-search-btn"),
padding:5,absolute:true,appendToBody:true,width:400,load:function(){var l=$.cookie("last-contact-search-tab");l||(l="#tabs-search-contacts");$(l+" a").click()}});typeof $to!="undefined"&&$to.wrap('<div class="input-wrapper"></div>');return false})},showChild:function(a,b){$(a).parents("table").find("."+b).show();$(a).hide()},bigElementsResize:function(){$(".ticket-log-container, .request-content").find("img, table, td").each(function(){var a=$(this);if($(".request-content").length&&a.css("width")!=
"100%"&&a.width()>0.7*$(".request-content").width()){a.css({width:"100%",height:"auto"});a.attr("src")&&a.wrap("<a href='"+a.attr("src")+"' target='_blank'></a>")}});$('.ticket-log-container, .request-content table[align="left"]').removeAttr("align")},data:false,create:function(){this.header();this.info();this.bigElementsResize()}};$.wbs.widgets={load:function(a,b,c){b=this[a](b,c);if(c&&c.innerWidget){$newEl=$("<div/>");if(this[c.innerWidget.name]){$newEl=this.load(c.innerWidget.name,$newEl,c.innerWidget.params);a=$(".ui-widget-body",b);a.length?a.append($newEl):b.append($newEl)}}return b},toggleLoading:function(a,b){a=$(a);if(b=="hide"){a.find(".request-loading").remove();return true}if(!a.find(".request-loading").length||b=="show"){var c=$('<div class="request-loading"><img src="img/ajax-loader32.gif"/><span>Загрузка&hellip;</span></div>');
a.append(c);c.css({opacity:"0.75","z-index":"10000",position:"absolute",left:0,top:0,margin:0,"padding-top":"2.8em",background:"#F0F3F5",width:a.width(),height:a.height(),"text-align":"center"})}else a.find(".request-loading").remove()},showAlertMsg:function(a,b){b="<p>"+b+"</p>";var c=$('<div class="alertmsg">'+b+"</div>");$closeBtn=$('<div style="float:right; cursor:pointer; position: absolute; top:20px; right:20px;" class="close-log-message-btn ui-icon ui-icon-closethick"></div>');$closeBtn.click(function(){c.remove();
if($("#requests-count").length){var e=$("#requests-count").position().top;if(e==0)e=65;$("#checkEmail .refresh-link, .empty-bin-link").css("top",e+2)}$("#container").layout("resizeAll")});if(a.find(".alertmsg p").length<=8)if(a.find(".alertmsg").length){var d=false;a.find(".alertmsg p").each(function(){if($(b).text()==$(this).text())d=true});if(!d){c.width(a.width()-50);a.find(".alertmsg:first").append(b)}}else{c.width(a.width()-50);a.prepend(c.append($closeBtn))}if($("#requests-count").length){var f=
$("#requests-count").position().top;if(f==0)f=65;$("#checkEmail .refresh-link, .empty-bin-link").css("top",f+2)}$("#container").layout("resizeAll")},leftMenu:function(a){var b=$('<div id="toggle-main-menu"/>'),c=$("<button style='float:right;' id='toggle-main-menu-btn'></button>").button();$(".ui-button-text",c).remove();c.append("<span class='ui-icon ui-icon-closethick'></span>");a.prepend(b.prepend(c));c.click(this.toggleLeftPanel)},portlet:function(a,b){a.wbsPortlet(b);return a},requests:function(a){var b=
$("<div/>"),c=$("<ul class='ui-tree ui-widget-content'></ul>").append($("<li class='ui-tree-child'><a href='#/requests/all/'>Все открытые</a></li>").append($("<ul/>").append("<li><a href='#/requests/assigned/"+$.wbs.get("current-user-id")+"/' id='myRequestsTitle' "+(parseInt($.wbs.get("unread_count"))>0?" style='font-weight:bold' ":"")+">Мои запросы "+(parseInt($.wbs.get("unread_count"))>0?"<span>("+$.wbs.get("unread_count")+")</span>":"")+"</a></li>").append("<li><a href='#/requests/notassigned/'>Исполнитель не назначен</a></li>"))).append("<li class='delimeter'><span></span></li>"),
d=$.wbs.get("data").states,f=$("<ul class='ui-tree-child'/>"),e;for(e in d)d[e].id>0&&d[e].group==-101&&f.append("<li><a href='#/requests/state/"+d[e].id+"/'>"+d[e].name+"</a></li>");c.append($("<li class='ui-tree-child'><a href='javascript:void(0)' class='ui-tree-child-non-active'>по статусам:</a></li>").append(f)).append("<li class='delimeter'><span></span></li>").append($("<li class='ui-tree-child'><a href='#/requests/archive/'>Архив (закрытые запросы)</a></li>").append($("<ul id='trash-list'/>").append("<li><a href='#/requests/verification/' id='verificationTitle'>Ожидают подтверждения</a></li>").append("<li><a href='#/requests/trash/' id='trashTitle'>Корзина</a></li>")));
b.append(c);a.wbsPortlet({title:"Запросы",buttons:["collapse"],content:b});$("#settingsPanel").length||$("#trash-list").remove()},settings:function(a){var b=$("<div/>"),c=$("<ul class='ui-tree ui-widget-content'></ul>").append("<li><a href='#/sources/'>Email ящики</a></li>").append("<li><a href='#/forms/'>Формы</a></li>");b.append(c);a.wbsPortlet({title:"Настройки",buttons:["collapse"],content:b})},toggleLeftPanel:function(){if($("#leftPanel").is(":visible")){$("#leftPanel").hide();
$("#splitter1").hide();$("#toggle-main-menu-btn span").toggleClass("ui-icon-closethick");$("#toggle-main-menu-btn span").toggleClass("ui-icon-pin-s");$("#menuBtnDiv").show();$("#searchRequest").css("padding-left","80px");$.cookie("left-panel","hidden")}else{$("#leftPanel").show();$("#splitter1").show();$("#main-menu-wrapper").wbsPopup("close");$("#toggle-main-menu-btn span").toggleClass("ui-icon-closethick");$("#toggle-main-menu-btn span").toggleClass("ui-icon-pin-s");$("#menuBtnDiv").hide();$("#searchRequest").css("padding-left",
"30px");$.cookie("left-panel","visible")}$("#container").layout("resizeAll")},menuBtn:function(a){var b=$('<div id="main-menu-div"/>').css({position:"absolute","margin-top":"6px"});a.append(b);var c=$("<button class='main-menu-btn'/>").button();$(".ui-button-text",c).remove();c.append("<span class='ui-button-text'>Папки\u25bc</span>");$menu=$("<div id='main-menu'/>");$items=$("#leftMenu").children().clone(true);b.append(c);$(".ui-portlet-header span",$items).remove();var d=$("<div id='main-menu-wrapper'/>");
d.append($menu);$menu.append($items);var f=false;d.wbsPopup({parent:c,absolute:true,padding:0,fitParent:false,open:function(){$menu.css({overflow:"visible"});var e=d.height();if(e>$(window).height()-100){e=$(window).height()-100;$menu.css({height:e,overflow:"hidden"});e=$("<div id='main-menu-up-arr' class='ui-corner-tr'><a href='#'>\u25b2</a></div>");var g=$("<div id='main-menu-down-arr' class='ui-corner-bottom'><a href='#'>\u25bc</a></div>");$menu.before(e);$menu.after(g);g.hover(function(){f=setInterval(function(){$menu.scrollTop($menu.scrollTop()+
10)},35)},function(){clearInterval(f)});e.hover(function(){f=setInterval(function(){$menu.scrollTop($menu.scrollTop()-10)},50)},function(){clearInterval(f)})}},close:function(){clearInterval(f);$("#main-menu-up-arr, #main-menu-down-arr").remove()}});d.prepend($("#toggle-main-menu",$menu));$("a",$items).click(function(){d.wbsPopup("close")});a.hide()},searchRequest:function(a){var b="Поиск по номеру запроса или имени клиента";b=b.replace("1","'");var c=$('<input style="width:300px; padding:4px;margin-right:5px;"value="'+
b+'" type="text" id="searchRequestInput" />'),d=$("<button>Искать</button>");d.button({icons:{primary:"ui-icon-search"}});c.click(function(){$(this).val()==b&&$(this).val("")}).blur(function(){$(this).val().split(" ").join("")==""&&$(this).val(b)}).keypress(function(j){j.which==13&&d.click()});d.click(function(){gridData.requestData.offset=0;if(c.val()!=b&&c.val().split(" ").join("")!=""){var j="#/requests/search/"+$.wbs.trim(c.val())+"/";$.wbs.loadHash(j)}else{delete gridData.requestData.search;
c.val(b)}});var f=$('<a href="javascript:void(0)" id="adv-search-link">Расширенный поиск</a>'),e=$('<div id="adv-search" />');e.append("<h2>Расширенный поиск</h2>");var g=$("<select id='adv-search-users'></select>");for(key in $.wbs.get("users"))g.append("<option value="+$.wbs.get("users")[key].id+">"+$.wbs.get("users")[key].name+"</option>");Array.prototype.sort.call($("option",g),function(j,m){return $(j).text().toLowerCase()>$(m).text().toLowerCase()?1:-1}).appendTo(g);g.prepend('<option value="-1" selected="selected">&lt;любой&gt;</option>');
g.change(function(){if($(this).val()=="-1"){$(".adv-search-users-mode").attr("disabled","disabled");$(".adv-search-users-mode").removeAttr("checked")}else $(".adv-search-users-mode").removeAttr("disabled")});e.append($("<div class='adv-search-div'/>").append($("<div class='adv-search-fields-div'/>").append("<p class='with-field'><label for='adv-search-name'>Имя клиента:</label><input id='adv-search-name' /></p>").append("<p class='with-field'><label for='adv-search-email'>Email клиента:</label><input id='adv-search-email' /></p>").append("<p class='with-field'><label for='adv-search-id'>Номер клиента:</label><input id='adv-search-id' /></p>")).append($("<div class='adv-search-words-div'/>").append("<p class='with-field'><label for='adv-search-words'>Слова:</label><input id='adv-search-words' /></p>").append("<p class='with-check'><input type='checkbox' value='0' checked='checked' class='adv-search-words-mode' disabled='disabled' id='adv-search-in-subject' /><label for='adv-search-in-subject'>в теме</label></p>").append("<p class='with-check'><input type='checkbox' value='1' checked='checked' class='adv-search-words-mode w' disabled='disabled' id='adv-search-in-request' /><label for='adv-search-in-request'>в тексте запроса</label></p>").append("<p class='with-check'><input type='checkbox' value='2' class='adv-search-words-mode w' disabled='disabled' id='adv-search-in-log' /><label for='adv-search-in-log'>в ответах и обсуждениях</label></p>")).append($("<div class='adv-search-users-div'/>").append($("<p class='with-field' />").append("<label for='adv-search-users' id='user-list-label'>Пользователь:</label>").append(g)).append("<p class='with-check'><input type='checkbox' value='0' class='adv-search-users-mode' disabled='disabled' id='adv-users-reply' /><label for='adv-users-reply'>ответил на запрос</label></p>").append("<p class='with-check'><input type='checkbox' value='1' class='adv-search-users-mode' disabled='disabled' id='adv-users-comments' /><label for='adv-users-comments'>выполнял другие действия</label></p>")));
var h=function(){var j=false,m=false,l=$.wbs.trim($("#adv-search-words").val(),true);if(l!=""){$(".adv-search-words-mode").removeAttr("disabled");if($(".adv-search-words-mode.w:checked").length>0){j="/words/"+$.wbs.trim($("#adv-search-words").val(),true);if($("#adv-search-in-log").is(":checked")&&$("#adv-search-in-request").is(":checked"))j+="/wmode/3/";else{if($("#adv-search-in-log").is(":checked"))j+="/wmode/2/";if($("#adv-search-in-request").is(":checked"))j+="/wmode/1/"}}}else $(".adv-search-words-mode").attr("disabled",
"disabled");if($(".adv-search-users-mode:checked").length>0&&$("#adv-search-users").val()!="-1"){m="/user/"+$("#adv-search-users").val();m+=$("#adv-users-reply").is(":checked")&&$("#adv-users-comments").is(":checked")?"/umode/3/":$("#adv-users-comments").is(":checked")?"/umode/2/":"/umode/1/"}j=($.wbs.trim($("#adv-search-name").val())?"/name/"+$.wbs.trim($("#adv-search-name").val()):"")+($.wbs.trim($("#adv-search-email").val())?"/email/"+$.wbs.trim($("#adv-search-email").val()):"")+($.wbs.trim($("#adv-search-id").val())?
"/clientid/"+$.wbs.trim($("#adv-search-id").val()):"")+(l!=""&&$("#adv-search-in-subject").is(":checked")?"/subject/"+$.wbs.trim($("#adv-search-words").val(),true):"")+(j?j:"")+(m?m:"");return $.wbs.trim(j)},i=$("<button id='adv-search-btn-search'>Искать</button>").button().click(function(){var j=h();if(j!=""){$.wbs.loadHash("/requests/advsearch/"+j);e.wbsPopup("close")}});i.button("disable");e.find("input").keyup(function(j){if(h()=="")i.button("disable");else{i.button("enable");j.which==13&&
i.click()}}).bind("paste",function(){$(this);setTimeout(function(){h()==""?i.button("disable"):i.button("enable")},100)});$adv_search_btn_cancel=$("<button>Отмена</button>").button().click(function(){var j=k;e.wbsPopup("close");$("#adv-search-name").val($("#adv-search-name",j).val());$("#adv-search-email").val($("#adv-search-email",j).val());$("#adv-search-id").val($("#adv-search-id",j).val());$("#adv-search-words").val($("#adv-search-words",j).val());$("#adv-search-in-subject",j).is(":checked")?
$("#adv-search-in-subject").attr("checked","checked"):$("#adv-search-in-subject").removeAttr("checked");$("#adv-search-in-request",j).is(":checked")?$("#adv-search-in-request").attr("checked","checked"):$("#adv-search-in-request").removeAttr("checked");$("#adv-search-in-log",j).is(":checked")?$("#adv-search-in-log").attr("checked","checked"):$("#adv-search-in-log").removeAttr("checked");$("#adv-search-users").val($("#adv-search-users",j).val());$("#adv-users-reply",j).is(":checked")?$("#adv-users-reply").attr("checked",
"checked"):$("#adv-users-reply").removeAttr("checked");$("#adv-users-comments",j).is(":checked")?$("#adv-users-comments").attr("checked","checked"):$("#adv-users-comments").removeAttr("checked")});e.append($("<div class='button-pane' />").append(i).append($adv_search_btn_cancel));a.append(c).append(d).append(f);var k=e.clone(true);e.wbsPopup({padding:3,parentShadow:false,parent:f,absolute:true,appendToBody:true,open:function(){k=e.clone(true)}});$(".adv-search-users-mode, #adv-search-users").change(function(){h()==
""?i.button("disable"):i.button("enable")})},checkEmail:function(a){var b=$("<a href='javascript:void(0)'>Обновить</a>"),c=$("<img src='img/ajax-loader-w.gif'/><span>&nbsp;Загрузка&hellip;</span>");$link=$("<div class='refresh-link'/>");$link.append(b);a.append($link);$link.click(function(){if($link.find("a").length){$link.empty().append(c);$.get("?m=requests&act=check&force=1",function(d){d=$.parseJSON(d);$link.empty().append(b);if(d.status=="ERR")for(key in d.error)$.wbs.widgets.showAlertMsg($("#topPanel"),
d.error[key]);gridData.updatePage()})}});return a},button:function(a,b){a.button(b);return a},transform:function(a,b){var c=a.attr("class");a=$("<"+b.tag+"/>");for(var d in b)typeof a[d]=="function"&&a[d](b[d]);a.attr("class",c);return a},title:function(a){var b=$('<h1></h1><div class="requests-count-div" style="display:none">(<span id="requests-count">0</span><span id="requests-count-label"> запросов</span>)</div>');a.css("width","100%");a.append(b)},grid:function(a){a.wbsGrid()},toggleTabPanel:function(){if($("#tabs-toolbar").length){if(typeof $defaultContent!=
"undefined"){var a=$defaultContent.clone(true);$("#ticket").replaceWith(a)}$("#detail").text("показать подробно");$(".buttons").prepend($("#toolbarbuttons"));$("#tabs-toolbar").remove();$("#info-container").show();$(".ticket-toolbar").show()}else{$(".ticket-toolbar").before('<div id="tabs-toolbar"></div>');$.ajax({url:"?m=requests&act=tabs",data:{id:$.wbs.get("current-request-id")},dataType:"html",success:function(b){$("#tabs-toolbar").css({position:"relative",display:"block",height:"32px","z-index":"100"});
$("#detail").text("скрыть подробности");$("#tabs-toolbar").append(b);$("#tabs-toolbar").append($("#toolbarbuttons"));$("#textarea").wbsEditor("resize")}})}$("#textarea").wbsEditor("resize")},toggleBottomPanel:function(a,b){if($("#bottomPanel").is(":visible")||a=="hide"){$("#gridPanel").is(":visible")||this.toggleTopPanel();$bottomPanel=$("#bottomPanel");$gridSplitter=$("#splitter2");$("#bottomPanel").hide();$("#splitter2").hide();gridPanelHeight=$("#gridPanel").height();$("#gridPanel").height($("#mainPage").height()-
$("#toolbar").outerHeight());$("#grid").wbsGrid("resize");if(typeof scrollTop!="undefined"&&$(".ui-grid-wrapper").length)$(".ui-grid-wrapper")[0].scrollTop=scrollTop;$("#grid").addClass("tr-cursor-pointer");b||$.cookie("single-panel-view","true");return"Закрыть"}if(!$("#bottomPanel").is(":visible")||a=="show"){$("#bottomPanel").show();$("#splitter2").show();$("#gridPanel").height(gridPanelHeight);$("#grid").wbsGrid("resize");b||$.cookie("single-panel-view","false");return"Развернуть"}},toggleTopPanel:function(a){if($("#gridPanel").is(":visible")||
a=="hide"){$toolbar=$("#toolbar");$gridPanel=$("#gridPanel");$gridSplitter=$("#splitter2");if($(".ui-grid-wrapper").length)scrollTop=$(".ui-grid-wrapper")[0].scrollTop;$("#toolbar").hide();$("#gridPanel").hide();$("#splitter2").hide();$("#bottomPanel").height($("#mainPage").height());$("#textarea").wbsEditor("resize");$("#grid").addClass("tr-cursor-pointer");$.cookie("single-panel-view","true");return false}if(!$("#gridPanel").is(":visible")||a=="show"){$("#toolbar").show();$("#gridPanel").show();
$("#splitter2").show();if(typeof $defaultContent!="undefined"){a=$defaultContent.clone(true);$("#ticket").replaceWith(a)}$("#info-container").show();$(".ticket-toolbar").show();$("#grid").removeClass("tr-cursor-pointer");$("#gridPanel").height(parseInt($.cookie("grid-height"),10));$.cookie("single-panel-view","true");return true}},textarea:function(a){a.wbsEditor({fill:true,showToolbar:false,editable:false})},splitter1:function(a){a.wbsSplitter()},splitter2:function(a){a.wbsSplitter({orientation:"horizontal"})},
splitter3:function(a){a.wbsSplitter({zIndex:1})},knowledge:function(){},loadKnowledge:function(a){$("#kb-wrapper").length||a.load("?m=knowledge",function(){$(":button, :submit, input[type=button]").button()})},border:function(a){a.addClass("ui-splitter")},logTemplate:function(a){if(a.data){var b=a.data.info;a.data.type.toLowerCase()}else{b=a.info?a.info:a;a.type.toLowerCase()}return msg=$('<div class="ticket-log-container log-state'+b.state_id+'"><div class="header ui-corner-top '+(b.text?"":"ui-corner-bottom")+
'"><span class="date"> '+b.datetime+'</span><span title="" class="author"> '+b.contact+' </span><span class="action"> '+b.log_name+" </span>"+(b.to?'<span class="action">'+b.to+"</span>":"")+"</div>"+(b.text?'<div class="text ui-corner-bottom">'+b.text+"</div>":"")+"</div>")},showChangesInRequests:function(){(new Date).getTime();$btn=$('<a href="#">Перегрузить страницу</a>');$closeBtn=$('<div style="float:right; cursor:pointer" class="close-log-message-btn ui-icon ui-icon-closethick"></div>');var a=0,
b=$.wbs.get("data").actions;$.get("?m=requests&act=changes",{id:$.wbs.get("current-request-id"),lastreqlogid:$.wbs.get("last_req_log_id"),lastreqid:$.wbs.get("last_req_id"),lastlogid:$.wbs.get("last_log_id")},function(c){c=$.parseJSON(c).data;a=c.count;$.wbs.set("unread_count",a);if(a=="0"){$("#myRequestsTitle").css("font-weight","normal");$("#myRequestsTitle span").remove()}else{$("#myRequestsTitle").css("font-weight","bold");$("#myRequestsTitle span").length||$("#myRequestsTitle").append("<span/>");
a="("+a+")"}$("#myRequestsTitle span").html(a);$("#title h1").text()==$("#myRequestsTitle").text()&&$("#title h1").html($("#myRequestsTitle").text());log=c.log;for(var d in log){if(d!="actions"){var f=log[d];f='<div class="log-message ticket-log-container"><p class="action-info"><span title="" class="author"> '+f.contact+'</span><span class="action"> '+b[f.action_id].log_name+" </span></p></div>"}var e=$(f);if($("#info-container .ticket-log-container").length)$(".info-container .ticket-log-container").replaceWith(e);
else{e.append($btn);e.prepend($closeBtn);$("#info-container").append(e);$closeBtn.click(function(){e.remove()})}}$btn.click(function(){$btn.html("Загрузка...");$("#grid").length?$("#grid").wbsGrid("selectBlock",$.wbs.get("current-request-id")):location.reload()});if($.wbs.controller.currentAction!="requestsAdvsearch"&&$.wbs.controller.currentAction!="requestsSearch"){if(c.updated!=""){if(typeof gridData!="undefined"){f="";for(d in c.updated)if($(".ui-grid-column-id[rel='"+c.updated[d].data.id.data+
"']").length)gridData.updateBlockByData(c.updated[d]);else f+=c.updated[d].data.id.data+",";f!=""&&gridData.insertNewBlocks(f,$.wbs.get("last_req_id"))}gridData.checkForIrrelevantRow(true)}if(c.newRequests[0]["COUNT(*)"]>0){if(typeof gridData!="undefined"){gridData.requestData.offset=0;gridData.insertNewBlocks(false,$.wbs.get("last_req_id"))}gridData.checkForIrrelevantRow(true)}}$.wbs.set("last_req_id",c.last_req_id);$.wbs.set("last_log_id",c.last_log_id)})},classChanger:function(a){$dialog=$("<div/>");
$.wbs.ajaxRequest({url:"?m=classes&act=list&id="+a,callback:function(b){classifyBtnClick=false;var c="";for(key in b){var d=b[key],f="";classTypeStr='<div class="classTypeDiv ui-widget-content ui-corner-all"><h4 class="ui-state-default ui-corner-top">'+d.name+"</h4>";for(classKey in d.classes){var e=d.classes[classKey];classTypeStr+='<p><input type="'+(d.multiple==1?"checkbox":"radio")+'" id="classes_'+e.id+'" name="classes['+(d.multiple==0?d.id:"")+']" value="'+e.id+'" '+(e.selected==1?"checked":
"")+' /><label for="classes_'+e.id+'">'+e.name+"</label></p>";if(e.selected==1)f=e.id}if(d.multiple==0)classTypeStr+='<input class="selectedvalue" value="'+f+'" type="hidden">';classTypeStr+="</div>";c+=classTypeStr}c="<form>"+c+"</form>";$btnSave=$("<button>Сохранить</button>").button();$btnCancel=$("<button>Отмена</button>").button();$btnSave.click(function(){$btnSave.attr("disabled",true);$.wbs.ajaxRequest({url:"?m=classes&act=requestsave&id="+a,data:$("form",$dialog).serialize(),callback:function(){$(".ui-editor-editablefield").load("?m=requests&act=info&id="+
$.wbs.get("current-request-id"),function(){$dialog.remove()})}})});$btnCancel.click(function(){$dialog.remove()});$dialog.append(c).append($btnSave).append($btnCancel);$("form",$dialog).css({"max-height":$(window).height()-150,overflow:"auto"});$("form",$dialog).children().css("margin-bottom",10);$('form input[type="radio"]',$dialog).click(function(){var g=$(this).parent().parent();if($(this).val()==$(".selectedvalue",g).val()){$(this).attr("checked",false);$(".selectedvalue",g).val("")}else $(".selectedvalue",
g).val($(this).val())});$dialog.dialog({modal:true,title:"Изменить классификаторы",zIndex:1E4,open:function(g){$parent=$(g.target).parent();var h=$parent.width();g=Math.round($(window).width()/2);h=(g-h)/2;$parent.width(g);$parent.offset({left:$parent.offset().left-h})}})}})}};dragged=false;
$.widget("ui.wbsSearchlist",{options:{filter:"input",source:"?m=contacts&act=list",filterSource:false,loadOnCreate:false,disableScroll:false,hideInput:false,onSelect:function(){return false}},createItems:function(a,b){var c=this,d=this.options,f,e;f=b?b+", 30":"30";if($("input",a).length){e=$("input:first",a).val();$("input:first",a).addClass("ui-autocomplete-loading")}else{e=a.val();a.addClass("ui-autocomplete-loading")}d.filter!="input"&&!c.content.find("option").length&&!c.content.find(".empty-results").length&&c.content.append('<span class="empty-results">Загрузка...</span>');
c.content.find("option").length&&c.select.append('<span class="empty-results">Загрузка...</span>');$.wbs.ajaxRequest({url:d.source,data:{text:e,limit:f},callback:function(g){c.content.find(".empty-results").remove();a.removeClass("ui-autocomplete-loading");$("input:first",a).removeClass("ui-autocomplete-loading");if(!c.content.find("select").length){var h=$("<select multiple='multiple' style='width:100%;height:100px'/>");c.content.append(h);c.select=h;if(!d.disableScroll){c.select.unbind();c.select.scroll(function(){var k=
$(this);if(!c.appending_rows)if(this.scrollHeight-100-this.scrollTop<10){c.appending_rows=true;c.createItems(c.input,k.find("option").length)}})}}for(key in g){var i=g[key];h=$("<option/>");h.append(i);h.addClass("ui-state-default");h.dblclick(function(){c.selectButton.click()});h.click(function(){c.selectButton.button("enable")});i=c.select.scrollTop();c.select.append(h);c.select.scrollTop(i)}if(!c.content.find("option").length){c.select.remove();c.content.append('<span class="empty-results">нет контактов</span>')}c.appending_rows=
false}});return true},_create:function(){var a=this,b=this.options;this.content=$("<div class='box ui-widget-content'/>");this.btnPane=$("<div class='ui-widget-content'/>");if(b.filter=="input"){var c=$("<button>Искать</button>").button(),d=$("<input class='ui-autocomplete-input' style='width:315px' />");d.val("Поиск по имени или email");d.focus(function(){this.value=""});d.keypress(function(e){e.which==13&&c.click()});this.input=$("<div />").append(d).append(c);c.click(function(){a.content.empty();
a.createItems(d)});if(b.loadOnCreate){d.val("");a.content.find(".empty-results").length||a.content.append('<span class="empty-results">Загрузка...</span>');a.createItems(d)}b.hideInput&&this.input.hide()}else{this.input=$("<select class='input-p100 ui-autocomplete-input'></select>");this.input.append("<option value='0' selected='selected'>Все папки</option>");if(b.filterSource){a.content.find(".empty-results").length||a.content.append('<span class="empty-results">Загрузка...</span>');
$.wbs.ajaxRequest({url:b.filterSource,callback:function(e){a.content.find(".empty-results").remove();a.input.removeClass("ui-autocomplete-loading");for(key in e){var g=e[key],h=$("<option/>"),i="";g=g.split("|");for(var k=0;k<parseInt(g[0]);k++)i+="&nbsp;&nbsp;";i+=g[1];h.append(i);h.val(key);a.input.append(h)}a.createItems(a.input)}})}this.input.change(function(){a.content.empty();a.createItems(a.input)})}this.selectButton=$selectButton=$("<button class='select-btn'>Выбрать</button>");this.btnPane.append($selectButton).append('<span class="use-ctrl-msg">Используйте Ctrl+click или Shift+click для выбора нескольких контактов</span>');
this.element.addClass("ui-widget");$selectButton.button();$.browser.msie||$selectButton.button("disable");var f=$("#contact-search-form.ui-popup");this.element.prepend($('<a href="#" style="position:absolute; top:5px; right: 5px;">Закрыть</a>').click(function(){f.wbsPopup("close")}));$selectButton.click(function(){var e=[];$("option:selected",a.content).each(function(h){e[h]=$.wbs.trim($(this).text())});e=$.wbs.implode(", ",e);var g=f.wbsPopup("option","selectedParent").prev();if(g.get(0).tagName.toLowerCase()!=
"input")g=$("input",f.wbsPopup("option","selectedParent").prev());g.val()!=""?g.val(g.val()+", "+e):g.val(e);g.val().length>55&&g.css("width",$("#action-container").width()-500);f.wbsPopup("close")});a.appending_rows=false;this.element.append(this.input);this.input.wrap("<div class='input-wrapper'>");this.element.append(this.content);this.element.append(this.btnPane)}});