jQuery.cookie=function(b,j,m){if(typeof j!="undefined"){m=m||{};if(j===null){j="";m.expires=-1}var e="";if(m.expires&&(typeof m.expires=="number"||m.expires.toUTCString)){var f;if(typeof m.expires=="number"){f=new Date();f.setTime(f.getTime()+(m.expires*24*60*60*1000))}else{f=m.expires}e="; expires="+f.toUTCString()}var l=m.path?"; path="+(m.path):"";var g=m.domain?"; domain="+(m.domain):"";var a=m.secure?"; secure":"";document.cookie=[b,"=",encodeURIComponent(j),e,l,g,a].join("")}else{var d=null;if(document.cookie&&document.cookie!=""){var k=document.cookie.split(";");for(var h=0;h<k.length;h++){var c=jQuery.trim(k[h]);if(c.substring(0,b.length+1)==(b+"=")){d=decodeURIComponent(c.substring(b.length+1));break}}}return d}};(function(b){b.fn.__bind__=b.fn.bind;b.fn.__unbind__=b.fn.unbind;b.fn.__find__=b.fn.find;var a={version:"0.7.8",override:/keydown|keypress|keyup/g,triggersMap:{},specialKeys:{27:"esc",9:"tab",32:"space",13:"return",8:"backspace",145:"scroll",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"del",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},newTrigger:function(d,e,c){var f={};f[d]={};f[d][e]={cb:c,disableInInput:false};return f}};if(b.browser.mozilla){a.specialKeys=b.extend(a.specialKeys,{96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"})}b.fn.find=function(c){this.query=c;return b.fn.__find__.apply(this,arguments)};b.fn.unbind=function(c,f,d){if(b.isFunction(f)){d=f;f=null}if(f&&typeof f==="string"){var e=((this.prevObject&&this.prevObject.query)||(this[0].id&&this[0].id)||this[0]).toString();var g=c.split(" ");for(var h=0;h<g.length;h++){delete a.triggersMap[e][g[h]][f]}}return this.__unbind__(c,d)};b.fn.bind=function(j,n,h){var l=j.match(a.override);if(b.isFunction(n)||!l){return this.__bind__(j,n,h)}else{var e=null,k=b.trim(j.replace(a.override,""));if(k){e=this.__bind__(k,n,h)}if(typeof n==="string"){n={combi:n}}if(n.combi){for(var f=0;f<l.length;f++){var c=l[f];var m=n.combi.toLowerCase(),o=a.newTrigger(c,m,h),g=((this.prevObject&&this.prevObject.query)||(this[0].id&&this[0].id)||this[0]).toString();o[c][m].disableInInput=n.disableInInput;if(!a.triggersMap[g]){a.triggersMap[g]=o}else{if(!a.triggersMap[g][c]){a.triggersMap[g][c]=o[c]}}var d=a.triggersMap[g][c][m];if(!d){a.triggersMap[g][c][m]=[o[c][m]]}else{if(d.constructor!==Array){a.triggersMap[g][c][m]=[d]}else{a.triggersMap[g][c][m][d.length]=o[c][m]}}this.each(function(){var p=b(this);if(p.attr("hkId")&&p.attr("hkId")!==g){g=p.attr("hkId")+";"+g}p.attr("hkId",g)});e=this.__bind__(l.join(" "),n,a.handler)}}return e}};a.findElement=function(c){if(!b(c).attr("hkId")){if(b.browser.opera||b.browser.safari){while(!b(c).attr("hkId")&&c.parentNode){c=c.parentNode}}}return c};a.handler=function(t){var j=a.findElement(t.currentTarget),p=b(j),c=p.attr("hkId");if(c){c=c.split(";");var r=t.which,g=t.type,h=a.specialKeys[r],k=!h&&String.fromCharCode(r).toLowerCase(),q=t.shiftKey,d=t.ctrlKey,l=t.altKey||t.originalEvent.altKey,s=null;for(var f=0;f<c.length;f++){if(a.triggersMap[c[f]][g]){s=a.triggersMap[c[f]][g];break}}if(s){var o;if(!q&&!d&&!l){o=s[h]||(k&&s[k])}else{var m="";if(l){m+="alt+"}if(d){m+="ctrl+"}if(q){m+="shift+"}o=s[m+h];if(!o){if(k){o=s[m+k]||s[m+a.shiftNums[k]]||(m==="shift+"&&s[a.shiftNums[k]])}}}if(o){var e=false;for(var f=0;f<o.length;f++){if(o[f].disableInInput){var n=b(t.target);if(p.is("input")||p.is("textarea")||n.is("input")||n.is("textarea")){return true}}e=e||o[f].cb.apply(this,[t])}return e}}}};window.hotkeys=a;return b})(jQuery);(function($){$.fn.editable=function(target,options){var settings={target:target,name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",loaddata:{},submitdata:{},fieldCount:10};if(options){$.extend(settings,options)}var plugin=$.editable.types[settings.type].plugin||function(){};var submit=$.editable.types[settings.type].submit||function(){};var buttons=$.editable.types[settings.type].buttons||$.editable.types.defaults.buttons;var content=$.editable.types[settings.type].content||$.editable.types.defaults.content;var element=$.editable.types[settings.type].element||$.editable.types.defaults.element;var reset=$.editable.types[settings.type].reset||$.editable.types.defaults.reset;var callback=settings.callback||function(){};var startEvent=settings.startEvent||function(){};var endEvent=settings.endEvent||function(){};var cancelEvent=settings.cancelEvent||function(){};if(!$.isFunction($(this)[settings.event])){$.fn[settings.event]=function(fn){return fn?this.bind(settings.event,fn):this.trigger(settings.event)}}$(this).attr("title",settings.tooltip);settings.autowidth="auto"==settings.width;settings.autoheight="auto"==settings.height;return this.each(function(){var self=this;var savedwidth=$(self).width();var savedheight=$(self).height();if(!$.trim($(this).html())){$(this).html(settings.placeholder)}$(this)[settings.event](function(e){if(self.editing){return}startEvent.apply();if(0==$(self).width()){settings.width=savedwidth;settings.height=savedheight}else{if(settings.width!="none"){settings.width=settings.autowidth?$(self).width():settings.width}if(settings.height!="none"){settings.height=settings.autoheight?$(self).height():settings.height}}if($(this).html().toLowerCase().replace(/;/,"")==settings.placeholder.toLowerCase().replace(/;/,"")){$(this).html("")}self.editing=true;self.revert=$(self).next().text();self.revertmin=$(self).text();$(self).html("");var form=$("<form/>");if(settings.cssclass){if("inherit"==settings.cssclass){form.attr("class",$(self).attr("class"))}else{form.attr("class",settings.cssclass)}}if(settings.style){if("inherit"==settings.style){form.attr("style",$(self).attr("style"));form.css("display",$(self).css("display"))}else{form.attr("style",settings.style)}}var input=element.apply(form,[settings,self]);var input_content;if(settings.loadurl){var t=setTimeout(function(){input.disabled=true;content.apply(form,[settings.loadtext,settings,self])},100);var loaddata={};loaddata[settings.id]=self.id;if($.isFunction(settings.loaddata)){$.extend(loaddata,settings.loaddata.apply(self,[self.revert,settings]))}else{$.extend(loaddata,settings.loaddata)}$.ajax({type:settings.loadtype,url:settings.loadurl,data:loaddata,async:false,success:function(result){window.clearTimeout(t);input_content=result;input.disabled=false}})}else{if(settings.data){input_content=settings.data;if($.isFunction(settings.data)){input_content=settings.data.apply(self,[self.revert,settings])}}else{input_content=self.revert}}content.apply(form,[input_content,settings,self]);input.attr("name",settings.name);buttons.apply(form,[settings,self]);$(self).append(form);plugin.apply(form,[settings,self]);$(":input:visible:enabled:first",form).focus();if(settings.select){input.select()}input.keydown(function(e){if(e.keyCode==27){e.preventDefault();reset.apply(form,[settings,self])}});input.keydown(function(e){if(e.keyCode==13){e.preventDefault();form.submit()}});var t;if("cancel"==settings.onblur){input.blur(function(e){t=setTimeout(function(){reset.apply(form,[settings,self])},500)})}else{if("submit"==settings.onblur){input.blur(function(e){form.submit()})}else{if($.isFunction(settings.onblur)){input.blur(function(e){settings.onblur.apply(self,[input.val(),settings])})}else{input.blur(function(e){})}}}form.submit(function(e){if(t){clearTimeout(t)}e.preventDefault();if(false!==submit.apply(form,[settings,self])){if($.isFunction(settings.target)){var str=settings.target.apply(self,[input.val(),settings]);$(self).html(str);self.editing=false;callback.apply(self,[self.innerHTML,settings]);if(!$.trim($(self).html())){$(self).html(settings.placeholder)}}else{var submitdata={};submitdata[settings.name]=input.val();submitdata[settings.id]=self.id;if($.isFunction(settings.submitdata)){$.extend(submitdata,settings.submitdata.apply(self,[self.revert,settings]))}else{$.extend(submitdata,settings.submitdata)}if("PUT"==settings.method){submitdata._method="put"}$(self).html(settings.indicator);$.post(settings.target,submitdata,function(str){var result=str.response;if(result.length<=0){return false}$(self).next().text(result);if(result.length>settings.fieldCount){result=result.substr(0,settings.fieldCount-3)+"..."}$(self).text(result);$(self).attr("title",result);self.editing=false;callback.apply(self,[self.innerHTML,settings]);if(!$.trim($(self).html())){$(self).html(settings.placeholder)}endEvent.apply(self,[self.innerHTML,settings])},"json")}}return false})});this.reset=function(){$(self).text(self.revertmin);self.editing=false;if(!$.trim($(self).html())){$(self).html(settings.placeholder)}}})};$.editable={types:{defaults:{element:function(settings,original){var input=$('<input type="hidden">');$(this).append(input);return(input)},content:function(string,settings,original){$(":input:first",this).val(string)},reset:function(settings,original){original.reset()},buttons:function(settings,original){var form=this;if(settings.submit){if(settings.submit.match(/>$/)){var submit=$(settings.submit).click(function(){if(submit.attr("type")!="submit"){form.submit()}})}else{var submit=$('<button type="submit">');submit.html(settings.submit)}$(this).append(submit);$(this).append(" "+settings.postSubmitText+" ")}if(settings.cancel){if(settings.cancel.match(/>$/)){var cancel=$(settings.cancel)}else{var cancel=$('<a href="#" />');cancel.html(settings.cancel)}$(this).append(cancel);$(cancel).click(function(event){if($.isFunction($.editable.types[settings.type].reset)){var reset=$.editable.types[settings.type].reset}else{var reset=$.editable.types.defaults.reset}reset.apply(form,[settings,original]);if(settings.cancelEvent){settings.cancelEvent.apply()}return false})}}},text:{element:function(settings,original){var input=$("<input>");if(settings.width!="none"){input.width(settings.width)}if(settings.height!="none"){input.height(settings.height)}input.attr("autocomplete","off");$(this).append(input);return(input)}},textarea:{element:function(settings,original){var textarea=$("<textarea>");if(settings.rows){textarea.attr("rows",settings.rows)}else{textarea.height(settings.height)}if(settings.cols){textarea.attr("cols",settings.cols)}else{textarea.width(settings.width)}$(this).append(textarea);return(textarea)}},select:{element:function(settings,original){var select=$("<select>");$(this).append(select);return(select)},content:function(string,settings,original){if(String==string.constructor){eval("var json = "+string);for(var key in json){if(!json.hasOwnProperty(key)){continue}if("selected"==key){continue}var option=$("<option>").val(key).append(json[key]);$("select",this).append(option)}}$("select",this).children().each(function(){if($(this).val()==json.selected||$(this).text()==original.revert){$(this).attr("selected","selected")}})}}},addInputType:function(name,input){$.editable.types[name]=input}}})(jQuery);(function(e){var b=Math.abs,a=Math.max,d=Math.min,c=Math.round;function f(){return e("<div/>")}e.imgAreaSelect=function(q,S){var aw=e(q),U,ar=f(),af=f(),H=f().add(f()).add(f()).add(f()),Y=f().add(f()).add(f()).add(f()),L=e([]),R,n,p,az,N,j,A,M,B=0,ad="absolute",Q,P,aa,Z,V=10,I,T,K,y,aA,x,ay,v={x1:0,y1:0,x2:0,y2:0,width:0,height:0},l,aq,am,ag,ac,an,u;function G(h){return h+az.left-M.left}function F(h){return h+az.top-M.top}function E(h){return h-az.left+M.left}function z(h){return h-az.top+M.top}function ak(h){return h.pageX-M.left}function ai(h){return h.pageY-M.top}function D(h){var w=h||aa,o=h||Z;return{x1:c(v.x1*w),y1:c(v.y1*o),x2:c(v.x2*w),y2:c(v.y2*o),width:c(v.x2*w)-c(v.x1*w),height:c(v.y2*o)-c(v.y1*o)}}function ae(o,aB,h,w,aC){var aE=aC||aa,aD=aC||Z;v={x1:c(o/aE),y1:c(aB/aD),x2:c(h/aE),y2:c(w/aD)};v.width=(h=G(v.x2))-(o=G(v.x1));v.height=(w=G(v.y2))-(aB=G(v.y1))}function ao(){if(!aw.width()){return}az={left:c(aw.offset().left),top:c(aw.offset().top)};N=aw.width();j=aw.height();if(e().jquery=="1.3.2"&&e.browser.safari&&ad=="fixed"){az.top+=a(document.documentElement.scrollTop,e("body").scrollTop());az.left+=a(document.documentElement.scrollLeft,e("body").scrollLeft())}M=e.inArray(A.css("position"),["absolute","relative"])+1?{left:c(A.offset().left)-A.scrollLeft(),top:c(A.offset().top)-A.scrollTop()}:ad=="fixed"?{left:e(document).scrollLeft(),top:e(document).scrollTop()}:{left:0,top:0};n=G(0);p=F(0)}function X(h){if(!K){return}ar.css({left:G(v.x1),top:F(v.y1)}).add(af).width(ac=v.width).height(an=v.height);af.add(H).add(L).css({left:0,top:0});H.width(a(ac-H.outerWidth()+H.innerWidth(),0)).height(a(an-H.outerHeight()+H.innerHeight(),0));e(Y[0]).css({left:n,top:p,width:v.x1,height:j});e(Y[1]).css({left:n+v.x1,top:p,width:ac,height:v.y1});e(Y[2]).css({left:n+v.x2,top:p,width:N-v.x2,height:j});e(Y[3]).css({left:n+v.x1,top:p+v.y2,width:ac,height:j-v.y2});ac-=L.outerWidth();an-=L.outerHeight();switch(L.length){case 8:e(L[4]).css({left:ac/2});e(L[5]).css({left:ac,top:an/2});e(L[6]).css({left:ac/2,top:an});e(L[7]).css({top:an/2});case 4:L.slice(1,3).css({left:ac});L.slice(2,4).css({top:an})}if(h!==false){if(!e.browser.safari){if(e.imgAreaSelect.keyPress!=at){e(document).unbind(e.imgAreaSelect.keyPress,e.imgAreaSelect.onKeyPress)}}if(S.keys){e(document)[e.imgAreaSelect.keyPress](e.imgAreaSelect.onKeyPress=at)}}if(e.browser.msie&&H.outerWidth()-H.innerWidth()==2){H.css("margin",0);setTimeout(function(){H.css("margin","auto")},0)}}function t(h){ao();X(h);y=G(v.x1);aA=F(v.y1);x=G(v.x2);ay=F(v.y2)}function ah(h,o){S.fadeSpeed?h.fadeOut(S.fadeSpeed,o):h.hide()}function C(o){var h=E(ak(o))-v.x1,w=z(ai(o))-v.y1;if(!u){ao();u=true;ar.one("mouseout",function(){u=false})}I="";if(S.resizable){if(w<=V){I="n"}else{if(w>=v.height-V){I="s"}}if(h<=V){I+="w"}else{if(h>=v.width-V){I+="e"}}}ar.css("cursor",I?I+"-resize":S.movable?"move":"");if(R){R.toggle()}}function aj(h){e("body").css("cursor","");if(S.autoHide||v.width*v.height==0){ah(ar.add(Y),function(){e(this).hide()})}S.onSelectEnd(q,D());e(document).unbind("mousemove",ab);ar.mousemove(C)}function s(h){if(h.which!=1){return false}ao();if(I){e("body").css("cursor",I+"-resize");y=G(v[/w/.test(I)?"x2":"x1"]);aA=F(v[/n/.test(I)?"y2":"y1"]);e(document).mousemove(ab).one("mouseup",aj);ar.unbind("mousemove",C)}else{if(S.movable){Q=n+v.x1-ak(h);P=p+v.y1-ai(h);ar.unbind("mousemove",C);e(document).mousemove(g).one("mouseup",function(){S.onSelectEnd(q,D());e(document).unbind("mousemove",g);ar.mousemove(C)})}else{aw.mousedown(h)}}return false}function r(){x=a(n,d(n+N,y+b(ay-aA)*T*(x>y||-1)));ay=c(a(p,d(p+j,aA+b(x-y)/T*(ay>aA||-1))));x=c(x)}function al(){ay=a(p,d(p+j,aA+b(x-y)/T*(ay>aA||-1)));x=c(a(n,d(n+N,y+b(ay-aA)*T*(x>y||-1))));ay=c(ay)}function av(){if(b(x-y)<S.minWidth){x=y-S.minWidth*(x<y||-1);if(x<n){y=n+S.minWidth}else{if(x>n+N){y=n+N-S.minWidth}}}if(b(ay-aA)<S.minHeight){ay=aA-S.minHeight*(ay<aA||-1);if(ay<p){aA=p+S.minHeight}else{if(ay>p+j){aA=p+j-S.minHeight}}}x=a(n,d(x,n+N));ay=a(p,d(ay,p+j));if(T){if(b(x-y)/T>b(ay-aA)){al()}else{r()}}if(b(x-y)>S.maxWidth){x=y-S.maxWidth*(x<y||-1);if(T){al()}}if(b(ay-aA)>S.maxHeight){ay=aA-S.maxHeight*(ay<aA||-1);if(T){r()}}v={x1:E(d(y,x)),x2:E(a(y,x)),y1:z(d(aA,ay)),y2:z(a(aA,ay)),width:b(x-y),height:b(ay-aA)};X();S.onSelectChange(q,D())}function ab(h){x=I==""||/w|e/.test(I)||T?ak(h):G(v.x2);ay=I==""||/n|s/.test(I)||T?ai(h):F(v.y2);av();return false}function O(h,o){x=(y=h)+v.width;ay=(aA=o)+v.height;v=e.extend(v,{x1:E(y),y1:z(aA),x2:E(x),y2:z(ay)});X();S.onSelectChange(q,D())}function g(h){y=a(n,d(Q+ak(h),n+N-v.width));aA=a(p,d(P+ai(h),p+j-v.height));O(y,aA);h.preventDefault();return false}function ax(){ao();x=y;ay=aA;av();I="";if(Y.is(":not(:visible)")){ar.add(Y).hide().fadeIn(S.fadeSpeed||0)}K=true;e(document).unbind("mouseup",ap).mousemove(ab).one("mouseup",aj);ar.unbind("mousemove",C);S.onSelectStart(q,D())}function ap(){e(document).unbind("mousemove",ax);ah(ar.add(Y));v={x1:E(y),y1:z(aA),x2:E(y),y2:z(aA),width:0,height:0};S.onSelectChange(q,D());S.onSelectEnd(q,D())}function m(h){if(S.isStopNewSelect){return false}if(h.which!=1||Y.is(":animated")){return false}ao();Q=y=ak(h);P=aA=ai(h);e(document).one("mousemove",ax).one("mouseup",ap);return false}function W(){t(false)}function au(){U=true;J(S=e.extend({classPrefix:"imgareaselect",movable:true,resizable:true,parent:"body",onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},S));ar.add(Y).css({visibility:""});if(S.show){K=true;ao();X();ar.add(Y).hide().fadeIn(S.fadeSpeed||0)}setTimeout(function(){S.onInit(q,D())},0)}var at=function(aB){var h=S.keys,aC,w,o=aB.keyCode||aB.which;aC=!isNaN(h.alt)&&(aB.altKey||aB.originalEvent.altKey)?h.alt:!isNaN(h.ctrl)&&aB.ctrlKey?h.ctrl:!isNaN(h.shift)&&aB.shiftKey?h.shift:!isNaN(h.arrows)?h.arrows:10;if(h.arrows=="resize"||(h.shift=="resize"&&aB.shiftKey)||(h.ctrl=="resize"&&aB.ctrlKey)||(h.alt=="resize"&&(aB.altKey||aB.originalEvent.altKey))){switch(o){case 37:aC=-aC;case 39:w=a(y,x);y=d(y,x);x=a(w+aC,y);if(T){al()}break;case 38:aC=-aC;case 40:w=a(aA,ay);aA=d(aA,ay);ay=a(w+aC,aA);if(T){r()}break;default:return}av()}else{y=d(y,x);aA=d(aA,ay);switch(o){case 37:O(a(y-aC,n),aA);break;case 38:O(y,a(aA-aC,p));break;case 39:O(y+d(aC,N-E(x)),aA);break;case 40:O(y,aA+d(aC,j-z(ay)));break;default:return}}return false};function k(h,o){for(option in o){if(S[option]!==undefined){h.css(o[option],S[option])}}}function J(h){if(h.parent){(A=e(h.parent)).append(ar.add(Y))}S=e.extend(S,h);ao();if(h.handles!=null){L.remove();L=e([]);am=h.handles?h.handles=="corners"?4:8:0;while(am--){L=L.add(f())}L.addClass(S.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:B+1||1});if(!parseInt(L.css("width"))){L.width(5).height(5)}if(ag=S.borderWidth){L.css({borderWidth:ag,borderStyle:"solid"})}k(L,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})}aa=S.imageWidth/N||1;Z=S.imageHeight/j||1;if(h.x1!=null){ae(h.x1,h.y1,h.x2,h.y2);h.show=!h.hide}if(h.keys){S.keys=e.extend({shift:1,ctrl:"resize"},h.keys)}Y.addClass(S.classPrefix+"-outer");af.addClass(S.classPrefix+"-selection");for(am=0;am++<4;){e(H[am-1]).addClass(S.classPrefix+"-border"+am)}k(af,{selectionColor:"background-color",selectionOpacity:"opacity"});k(H,{borderOpacity:"opacity",borderWidth:"border-width"});k(Y,{outerColor:"background-color",outerOpacity:"opacity"});if(ag=S.borderColor1){e(H[0]).css({borderStyle:"solid",borderColor:ag})}if(ag=S.borderColor2){e(H[1]).css({borderStyle:"dashed",borderColor:ag})}ar.append(af.add(H).add(L).add(R));if(e.browser.msie){if(ag=Y.css("filter").match(/opacity=([0-9]+)/)){Y.css("opacity",ag[1]/100)}if(ag=H.css("filter").match(/opacity=([0-9]+)/)){H.css("opacity",ag[1]/100)}}if(h.hide){ah(ar.add(Y))}else{if(h.show&&U){K=true;ar.add(Y).fadeIn(S.fadeSpeed||0);t()}}T=(aq=(S.aspectRatio||"").split(/:/))[0]/aq[1];if(S.disable||S.enable===false){ar.unbind("mousemove",C).unbind("mousedown",s);aw.add(Y).unbind("mousedown",m);e(window).unbind("resize",W);aw.add(aw.parents()).unbind("scroll",W)}else{if(S.enable||S.disable===false){if(S.resizable||S.movable){ar.mousemove(C).mousedown(s)}if(!S.persistent){aw.add(Y).mousedown(m)}e(window).resize(W);aw.add(aw.parents()).scroll(W)}}S.enable=S.disable=undefined}this.getOptions=function(){return S};this.setOptions=J;this.getSelection=D;this.setSelection=ae;this.update=t;l=aw;while(l.length&&!l.is("body")){if(!isNaN(l.css("z-index"))&&l.css("z-index")>B){B=l.css("z-index")}if(l.css("position")=="fixed"){ad="fixed"}l=l.parent()}if(!isNaN(S.zIndex)){B=S.zIndex}if(e.browser.msie){aw.attr("unselectable","on")}e.imgAreaSelect.keyPress=e.browser.msie||e.browser.safari?"keydown":"keypress";if(e.browser.opera){R=f().css({width:"100%",height:"100%",position:"absolute",zIndex:B+2||2})}ar.add(Y).css({visibility:"hidden",position:ad,overflow:"hidden",zIndex:B||"0"});ar.css({zIndex:B+2||2});af.add(H).css({position:"absolute"});q.complete||q.readyState=="complete"||!aw.is("img")?au():aw.one("load",au)};e.fn.imgAreaSelect=function(g){g=g||{};this.each(function(){if(e(this).data("imgAreaSelect")){e(this).data("imgAreaSelect").setOptions(g)}else{if(g.enable===undefined&&g.disable===undefined){g.enable=true}e(this).data("imgAreaSelect",new e.imgAreaSelect(this,g))}});if(g.instance){return e(this).data("imgAreaSelect")}return this}})(jQuery);(function(a){a.fn.wbsPager=function(f){var b=f.limit||0;var d=f.count||0;var e=f.current||1;if(d==0){return false}var c=function(g){alert("goto page "+g)};c=f.pagegoto||c;return this.each(function(){if(d<=1){return false}var g=a('<ul class="pager-select"/>');if(e!=1){a('<li class="page-arrow">&#8592;</li>').appendTo(g).click(function(){c(e-1)})}if(b>=parseInt(d)-2){for(var h=1;h<=d;h++){if(h!=e){a("<li>"+h+"</li>").appendTo(g).click(function(){c(this)}.bind(h))}else{g.append('<li class="current-page">'+h+"</li>")}}}else{if(b<d){if(e<parseInt(b)+1){for(var h=1;h<=parseInt(b)+1;h++){if(h!=e){a("<li>"+h+"</li>").appendTo(g).click(function(){c(this)}.bind(h))}else{g.append('<li class="current-page">'+h+"</li>")}}g.append('<li class="pager-space">...</li>');a("<li>"+d+"</li>").appendTo(g).click(function(){c(this)}.bind(d))}else{if(e>d-b){a("<li>1</li>").appendTo(g).click(function(){c(1)});g.append('<li class="pager-space">...</li>');for(var h=(d-b);h<=d;h++){if(h!=e){a("<li>"+h+"</li>").appendTo(g).click(function(){c(this)}.bind(h))}else{g.append('<li class="current-page">'+h+"</li>")}}}else{a("<li>1</li>").appendTo(g).click(function(){c(1)});g.append('<li class="pager-space">...</li>');for(var h=(e-1);h<=(e+1);h++){if(h!=e){a("<li>"+h+"</li>").appendTo(g).click(function(){c(this)}.bind(h))}else{g.append('<li class="current-page">'+h+"</li>")}}g.append('<li class="pager-space">...</li>');a("<li>"+d+"</li>").appendTo(g).click(function(){c(this)}.bind(d))}}}}if(e!=d){a('<li class="page-arrow">&#8594;</li>').appendTo(g).click(function(){c(e+1)})}a(this).append(g)})}})(jQuery);(function(a){a.fn.slider=function(b){config={widthCss:100,onChangeComplite:function(){}};if(b){a.extend(b,config)}var c=false;var e=0;var d=0;return this.each(function(){var l=a("<div></div>").addClass("slider-basic");l.css({width:config.widthCss});a(this).append(l);var j=a("<div></div>").addClass("slider-horz");l.append(j);var h=a("<div></div>").addClass("slider-horz-end");j.append(h);var g=a("<div></div>").addClass("slider-horz-inner");h.append(g);var f=a("<div></div>").addClass("slider-horz-thumb");g.append(f);var k=a('<a href="#"></a>').addClass("slider-focus");g.append(k);a(document).mouseup(function(m){c=false;config.onChangeComplite({pos:this.pos})});f.mousedown(function(m){c=true});a(document).mousemove(function(n){if(c){var m=getMouseOffset(l.get(0),n).x;m=(m<7)?7:m;m=(m>config.widthCss-7)?config.widthCss-7:m;m-=14;f.css({left:m});e=config.startValue+(m+7)/d;config.onChange({x:m+7,pos:this.pos})}})})}})(jQuery);function WsbSlider(b){this.config=b;this.isThumbDrag=false;this.widthCss=(b.widthCss)?b.widthCss:100;this.onChange=b.onChange;this.onChangeComplite=b.onChangeComplite;this.startValue=(b.startValue)?b.startValue:0;this.endValue=(b.endValue)?b.endValue:this.startValue+this.widthCss;var a=this.endValue-this.startValue;this.kof=this.widthCss/a;this.render=function(){var j=this.config.elem;var e=createDiv("slider-basic");e.style.width=this.widthCss+"px";j.appendChild(e);this.baseContener=e;var h=createDiv("slider-horz");e.appendChild(h);var c=createDiv("slider-horz-end");h.appendChild(c);var g=createDiv("slider-horz-inner");c.appendChild(g);var f=createDiv("slider-horz-thumb");g.appendChild(f);this.thumbElem=f;this.thumbElem.moveThis=function(k){this.thumbMouseDownHandle(k);this.thumbMouseMoveHandle(k);this.thumbMouseUpHandle(k,true)}.bind(this);var d=createElem("a","slider-focus");g.appendChild(d)};this.thumbMouseUpHandle=function(f,d){if(this.isThumbClick||this.isSliderClick){this.isThumbDrag=false;this.isThumbClick=false;this.isSliderClick=false;var c=getMouseOffset(this.baseContener,f).x;c=(c<7)?7:c;c=(c>this.widthCss-7)?this.widthCss-7:c;c-=14;this.thumbElem.style.left=c+"px";this.pos=this.startValue+(c+7)/this.kof;if(this.onChange){this.onChange({x:c+7,pos:this.pos})}if(this.onChangeComplite){this.onChangeComplite({pos:this.pos})}}}.bind(this);this.UpHandle=function(c){this.isThumbDrag=false;this.onChangeComplite({pos:this.pos})}.bind(this),this.thumbMouseDownHandle=function(c){this.isThumbDrag=true;this.isThumbClick=true;if(c){c.preventDefault()}}.bind(this);this.sliderMouseDownHandle=function(){this.isSliderClick=true}.bind(this);this.thumbMouseMoveHandle=function(d){if(this.isThumbClick){var c=getMouseOffset(this.baseContener,d).x;c=(c<7)?7:c;c=(c>this.widthCss-7)?this.widthCss-7:c;c-=14;this.thumbElem.style.left=c+"px";this.pos=this.startValue+(c+7)/this.kof;if(this.onChange){this.onChange({x:c+7,pos:this.pos})}}}.bind(this);this.setPosition=function(d){var c=(d-this.startValue)*this.kof-7;this.thumbElem.style.left=c+"px"};this.init=function(){$(document).bind("mouseup",this.thumbMouseUpHandle);$(this.thumbElem).bind("mousedown",this.thumbMouseDownHandle);$(this.baseContener).bind("mousedown",this.sliderMouseDownHandle);$(document).bind("mousemove",this.thumbMouseMoveHandle)};this.destroy=function(){$(document).unbind("mouseup",this.thumbMouseUpHandle);$(this.thumbElem).unbind("mousedown",this.thumbMouseDownHandle);$(this.baseContener).unbind("mousedown",this.sliderMouseDownHandle);$(document).unbind("mousemove",this.thumbMouseMoveHandle)};this.render();this.init();if(this.config.defaultValue){this.setPosition(this.config.defaultValue)}}function mousePageXY(b){var a=0,c=0;if(!b){b=window.event}if(b.pageX||b.pageY){a=b.pageX;c=b.pageY}else{if(b.clientX||b.clientY){a=b.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)-document.documentElement.clientLeft;c=b.clientY+(document.documentElement.scrollTop||document.body.scrollTop)-document.documentElement.clientTop}}return{x:a,y:c}}Number.prototype.NaN0=function(){return isNaN(this)?0:this};var USER_DATA={Browser:{KHTML:/Konqueror|KHTML/.test(navigator.userAgent)&&!/Apple/.test(navigator.userAgent),Safari:/KHTML/.test(navigator.userAgent)&&/Apple/.test(navigator.userAgent),Opera:!!window.opera,MSIE:!!(window.attachEvent&&!window.opera),Gecko:/Gecko/.test(navigator.userAgent)&&!/Konqueror|KHTML/.test(navigator.userAgent)},OS:{Windows:navigator.platform.indexOf("Win")>-1,Mac:navigator.platform.indexOf("Mac")>-1,Linux:navigator.platform.indexOf("Linux")>-1}};var IS_IE=USER_DATA.Browser.MSIE;function getPosition(c){var b=0;var a=0;while(c.offsetParent){b+=c.offsetLeft+(c.currentStyle?(parseInt(c.currentStyle.borderLeftWidth)).NaN0():0);a+=c.offsetTop+(c.currentStyle?(parseInt(c.currentStyle.borderTopWidth)).NaN0():0);c=c.offsetParent}b+=c.offsetLeft+(c.currentStyle?(parseInt(c.currentStyle.borderLeftWidth)).NaN0():0);a+=c.offsetTop+(c.currentStyle?(parseInt(c.currentStyle.borderTopWidth)).NaN0():0);return{x:b,y:a}}function getAlignedPosition(d){var c=0;var b=0;while(d.offsetParent){c+=d.offsetLeft+(d.currentStyle?(parseInt(d.currentStyle.borderLeftWidth)).NaN0():0);b+=d.offsetTop+(d.currentStyle?(parseInt(d.currentStyle.borderTopWidth)).NaN0():0);d=d.offsetParent;if(d.scrollLeft){c-=d.scrollLeft}if(d.scrollTop){b-=d.scrollTop}}var a=document.documentElement?document.documentElement:document.body;c+=d.offsetLeft+(d.currentStyle?(parseInt(d.currentStyle.borderLeftWidth)).NaN0():0)+(IS_IE?(parseInt(a.scrollLeft)).NaN0():0)-(parseInt(a.clientLeft)).NaN0();b+=d.offsetTop+(d.currentStyle?(parseInt(d.currentStyle.borderTopWidth)).NaN0():0)+(IS_IE?(parseInt(a.scrollTop)).NaN0():0)-(parseInt(a.clientTop)).NaN0();return{x:c,y:b}}function mouseCoords(b){if(b.pageX||b.pageY){return{x:b.pageX,y:b.pageY}}var a=document.documentElement?document.documentElement:document.body;return{x:b.clientX+a.scrollLeft-a.clientLeft,y:b.clientY+a.scrollTop-a.clientTop}}function getMouseOffset(e,c,d){c=c||window.event;if(d==null){d=false}var b=d?getAlignedPosition(e):getPosition(e);var a=mouseCoords(c);return{x:a.x-b.x,y:a.y-b.y}}function createDiv(a){return createElem("div",a)}function createElem(a,b){var c=document.createElement(a);if(b){c.className=b}return c}function addClass(d,c){var b=d.className.split(" ");for(var a=0;a<b.length;a++){if(b[a]==c){return}}b[b.length]=c;d.className=b.join(" ")}function removeClass(d,c){var b=d.className.split(" ");var e=new Array();for(var a=0;a<b.length;a++){if(b[a]==c){continue}e[e.length]=b[a]}d.className=e.join(" ")}PDApplacation=newClass(null,{constructor:function(){this.readerAlbums=this.createStore("backend.php?controller=ajax&action=albumList");this.readerImages=this.createStore("backend.php?controller=ajax&action=imageList");this.readerImageOne=this.createStore("backend.php?controller=ajax&action=imageOne");this.albumManager=new AlbumManager({elem:jQuery("album-content-body").get(0),readerAlbums:this.readerAlbums,readerImages:this.readerImages,readerImageOne:this.readerImageOne})},createStore:function(b){var a=new WbaReader({url:b,baseParams:{}});a.addListener("success",function(c){});return a},refreshData:function(){}});Rights={create_album:-1,manage_album:-1,manage_collections:-1,modify_design:-1,album:-1,isRead:function(){return this.album>=1},isWrite:function(){return this.album>=3},isFull:function(){return this.album==7}};$().ajaxComplete(function(b,a){if(a.responseText.match(/Allowed memory/)){alert($.sprintf("Not enough memory to perfom operation (memory_limit=%s)",document.memory_limit))}});WbaReader=newClass(null,{constructor:function(a){this.callbackList=new Array();this.url=a.url;this.baseParams=a.baseParams},addListener:function(a,b){this.callbackList.push(b)},load:function(b){var a=this.url;jQuery.post(this.url,b,function(d,e){if(d.redirectUrl){if(window.parent){window.parent.location=d.redirectUrl}else{window.location=d.redirectUrl}return false}if(d.status=="ERR"){alert(d.error);return false}for(var c=0;c<this.callbackList.length;c++){this.callbackList[c](d)}}.bind(this),"json")}});StateName={Alubms:"Albums",ImageTile:"ImageTile",ImageDetail:"ImageDetail",ImageOne:"ImageOne",Back:"Back"};AlbumManager=newClass(null,{constructor:function(b){this.config=b;this.contentElem=b.elem;this.resizer=new WAResize();this.imageHashe=new Object();this.albumList=new Array();Helper.setManager(this);this.config.readerAlbums.addListener("changed",this.storeChangeHandle,this);this.config.readerImages.addListener("changed",this.storeChangeHandle,this);this.config.readerImageOne.addListener("changed",this.storeChangeHandle,this);if(!jQuery.cookie("imageSize")){document.imageSize=144;jQuery.cookie("imageSize",144)}else{document.imageSize=jQuery.cookie("imageSize")}$().ajaxStart(function(){Helper.getManager().startProccess()});$().ajaxSuccess(function(d,c){Helper.getManager().stopProccess()});WBS.History.init();WBS.History.on("change",this.hashUrlChange);this.templateBroker=new TemplateBroker();this.moduleBroker=new ModuleBroker();this.initKey();var a=$.cookie("limit")||50;this.state={limit:a,offset:0};this.hashUrlChange(WBS.History._getToken())},startProccess:function(){if(window.parent.showHideLoading){window.parent.showHideLoading(true)}$(".sidebar-btn").addClass("sidebar-btn-disable")},stopProccess:function(){if(window.parent.showHideLoading&&!document.isProcessSleep){window.parent.showHideLoading(false)}$(".sidebar-btn").removeClass("sidebar-btn-disable")},initKey:function(){WbsData.set({isKeyEnable:true});var b=function(){if(WbsData.get().isKeyEnable){if(Helper.getManager().getState().stateName==StateName.ImageOne){if(WbsData.get("nextIdPhoto",null)){Helper.getManager().setState({viewName:"ImageOn",imageId:WbsData.get("nextIdPhoto")})}}else{if(Helper.getManager().getState().stateName==StateName.ImageTile){var f=Helper.getManager().getState().offset;var d=Helper.getManager().getState().limit;var e=Data.total;if(f<e-d){Helper.getManager().setState({offset:parseInt(f)+parseInt(d)})}}}}}.bind(this);jQuery(document).bind("keydown","space",b);var a=function(){if(WbsData.get().isKeyEnable){if(Helper.getManager().getState().stateName==StateName.ImageOne){if(WbsData.get("nextIdPhoto",null)){Helper.getManager().setState({viewName:"ImageOn",imageId:WbsData.get("nextIdPhoto")})}}else{if(Helper.getManager().getState().stateName==StateName.ImageTile){var f=Helper.getManager().getState().offset;var d=Helper.getManager().getState().limit;var e=Data.total;if(f<e-d){if($("#arrange-link").hasClass("opened")){Helper.getManager().setStateParam({arrange:true})}Helper.getManager().setState({offset:parseInt(f)+parseInt(d)})}}}}}.bind(this);jQuery(document).bind("keydown","right",a);jQuery(document).bind("keydown","Ctrl+right",a);var c=function(){if(WbsData.get().isKeyEnable){if(Helper.getManager().getState().stateName==StateName.ImageOne){if(WbsData.get("prevIdPhoto",null)){Helper.getManager().setState({viewName:"ImageOn",imageId:WbsData.get("prevIdPhoto")})}}else{if(Helper.getManager().getState().stateName==StateName.ImageTile){var e=Helper.getManager().getState().offset;var d=Helper.getManager().getState().limit;if(e>0){if($("#arrange-link").hasClass("opened")){Helper.getManager().setStateParam({arrange:true})}Helper.getManager().setState({offset:e-d})}}}}}.bind(this);jQuery(document).bind("keydown","left",c);jQuery(document).bind("keydown","Ctrl+left",c)},getState:function(){return this.state},keyEsc:function(){switch(Helper.getManager().getState().stateName){case StateName.Alubms:break;case StateName.ImageTile:Helper.getManager().setState({stateName:StateName.Alubms});break;case StateName.ImageOne:Helper.getManager().setState({stateName:StateName.ImageTile});break}return false},hashUrlChange:function(c){if(!c){c="#"}if(c==document.myState){return false}var a=/albums/.exec(c);var e=/ImageTile\/([0-9]+)/.exec(c);var b=/ImageOne\/([0-9]+)/.exec(c);var d=/page\/([0-9]+)/.exec(c);d=(d)?d[1]:0;if(a){Helper.getManager().setState({stateName:StateName.Alubms,offset:d})}else{if(e){Helper.getManager().setState({stateName:StateName.ImageTile,albumId:e[1],offset:d})}else{if(b){Helper.getManager().setState({stateName:StateName.ImageOne,imageId:b[1]})}else{Helper.getManager().setState({stateName:StateName.Alubms})}}}}.bind(this),openUploadDlg:function(){this.fup.selectFiles()},getUploadDlg:function(){if(this.uploadDlg==null){this.uploadDlg=new WbsUploadDlg({contentElemId:"dlg-upload-content",cls:"upload-dlg",contentElemId:"dlg-upload-content",uploadURL:"../../../../PD/ajax/file_upload.php",ieUploadURL:"../../PD/ajax/file_upload.php",swfURL:"../../common/html/res/swfupload/swfupload.swf",sessID:jQuery.cookie("PHPSESSID")})}return this.uploadDlg},storeChangeHandle:function(a){Helper.getManager().updateState(a)},updateState:function(a){Data=a;if(a.RIGHTS){$.extend(Rights,a.RIGHTS)}if(a.RIGHT){Rights.album=a.RIGHT}if(a){this.templateBroker.updateState(this.state,a);this.moduleBroker.updateState(this.state,a)}else{this.templateBroker.updateState(this.state)}if(this.callback){this.callback()}this.callback=null},setStateParam:function(a){for(i in a){this.state[i]=a[i]}},setState:function(f,g){f=f||{};if((f.stateName==StateName.ImageTile)&&(f.albumId)){this.setStateParam({offset:0})}if($.isFunction(g)){this.callback=g}else{this.extParam=g}for(i in f){this.state[i]=f[i]}if(this.state.stateName==StateName.Alubms){this.config.readerAlbums.load(this.state);var d=(this.state.offset>0)?"/page/"+this.state.offset:"";var b="/"+this.state.stateName+d;document.myState=b;WBS.History.add(b)}else{if(this.state.stateName==StateName.ImageTile){if(this.lastStateName==StateName.ImageOne){var c=parseInt(Data.data.c.PL_SORT);var e=parseInt(this.state.offset);var a=parseInt(this.state.limit);if(c<e||c>=parseInt(e)+parseInt(a)){this.state.offset=Math.floor(c/a)*a}}this.config.readerImages.load(this.state);var d=(this.state.offset>0)?"/page/"+this.state.offset:"";var b="/"+this.state.stateName+"/"+this.state.albumId+d;document.myState=b;WBS.History.add(b)}else{if(this.state.stateName==StateName.ImageDetail){this.config.readerImages.load(this.state);var d=(this.state.offset>0)?"/page/"+this.state.offset:"";var b="/"+this.state.stateName+"/"+this.state.albumId+d;document.myState=b;WBS.History.add(b)}else{if(this.state.stateName==StateName.ImageOne){this.config.readerImageOne.load(this.state);var b="/"+this.state.stateName+"/"+this.state.imageId;document.myState=b;WBS.History.add(b)}else{if(this.state.stateName==StateName.Back){this.updateState()}}}}}if(f.stateName){this.lastStateName=f.stateName}$("img.image-one").imgAreaSelect({hide:true});Semaphore.stopProccess()}});ImageInfo={_lastImagePos:null,lastImageId:function(b){if(b){jQuery.cookie("lastImageId",b)}else{var a=jQuery.cookie("lastImageId");return(a)?a:null}},lastImagePos:function(a){if(a){this._lastImagePos=a}else{return this._lastImagePos}}};TemplateBroker=newClass(null,{constructor:function(){this.lastTemplate=null;this.lastTemplateScrollH=null;this.activeTemplate=null;this.imageOneTemplate=null},updateState:function(c,b){switch(c.stateName){case StateName.Alubms:var a=$("<div></div>").get("0");this._render(a,c);TemplateAlbums.render(a,b);var d=$('<div id="album-add-panel" class="color-top-panel" style="overflow: hidden;"> </div>');if(Rights.manage_album==1){d.append('<div class="albom-manage"><a href="#" id="btn-album-arrange">Organize albums</a></div>')}if(Rights.create_album==1){d.append('<input value="New album" id="btn-album-add" type="button" />')}d.append('<span id="album-arrange-tile" style="display: none;">Drag\'n\'drop to arrange albums.</span>');$("#album-content-body > div").before(d);break;case StateName.ImageTile:var a=createDiv("");TemplateImageTile.render(a,b);this._render(a,c);break;case StateName.ImageDetail:var a=createDiv("");TemplateImageDetail.render(a,b);this._render(a,c);break;case StateName.ImageOne:var a=createDiv("");if(!this.imageOneTemplate){this.imageOneTemplate=new TemplateImageOn();ViewImageOn.template=this.imageOneTemplate}this.imageOneTemplate.render(a,b);this._render(a,c);ImageInfo.lastImageId(b.data.c.PL_ID);ImageInfo.lastImagePos(b.data.c.PL_SORT);break;case StateName.Back:this._renderBack();break}$("#album-content-body").scrollTop(0);if(c.stateName==StateName.ImageTile){$("#album-content-body").scrollTop(this.lastTemplateScrollH)}$("#album-content-body").css({"background-color":""});jQuery("#pending-comment").text(b.pendingComment)},_render:function(a,b){this.lastState=b.stateName;if(b.stateName==StateName.ImageOne){this.lastTemplateScrollH=$("#album-content-body").get(0).scrollTop}if(this.activeTemplate){this.lastTemplate=this.activeTemplate}if(this.activeTemplate){$("#album-content-body").scrollTop(0);$("#album-content-body").children().remove()}$("#album-content-body").append(a);this.activeTemplate=a},_renderAndHash:function(a){if(this.activeTemplate){this.lastTemplateScrollH=$("#album-content-body").get(0).scrollTop;$("#album-content-body").get(0).removeChild(this.activeTemplate);this.lastTemplate=this.activeTemplate}$("#album-content-body").get(0).appendChild(a);this.activeTemplate=a},_renderBack:function(){if(this.lastTemplate){$("#album-content-body").get(0).removeChild(this.activeTemplate);$("#album-content-body").get(0).appendChild(this.lastTemplate);this.activeTemplate=this.lastTemplate;$("#album-content-body").get(0).scrollTop=this.lastTemplateScrollH}}});ModuleBroker=newClass(null,{constructor:function(){this.rightImages=new Array();this.footer=new Array()},updateState:function(d,c){if(!this.rightImages[d.stateName]){this.rightImages[d.stateName]=new ModuleRightImages({manager:Helper.getManager(),elem:$("album-util-panel")})}var b=this.rightImages[d.stateName].render(d,c);if(!this.footer[d.stateName]){this.footer[d.stateName]=new ModuleFooter({manager:Helper.getManager(),elem:$("#footer-info-panel").get(0)})}var b=this.footer[d.stateName].render(d,c);var a=new ModuleInfoPanel();a.render(d,c)}});TemplateAlbums={render:function(e,f){this.contentElem=e;this.data=f.data;$(this.contentElem).empty();var k=$('<ul class="album-list"> </ul>');$(this.contentElem).append(k);if(this.data.length==0){$('<div class="center">There are no photo albums in your library.<br /><br /><em>Create a new album to upload photos.</em> </div>').appendTo(k);return}var b=new Array();for(var g=0;g<this.data.length;g++){var h=$("<li > </li>");h.attr("uid",this.data[g].PF_ID);h.append(this._createAlbumItem(this.data[g]));k.append(h);b.push(h.get(0))}var j=[];for(var c in this.data){var d=this.data[c];if((!d.PF_THUMB||d.PF_THUMB==0)&&d.PHOTOS_COUNT!=0){j.push(d)}}if(j.length>0){var a=function(){var l=j.pop();$.ajax({url:"backend.php?controller=ajax&action=changeNewThumbAlbum&albumId="+l.PF_ID,success:function(){var m=$("li[uid="+l.PF_ID+"] img");m.attr("src",m.attr("src")+"&v="+Math.random());if(j.length>0){a()}},async:false})}.bind(this);setTimeout(function(){a()},1000)}},_createAlbumItem:function(j){Helper.getManager().albumList.push({name:j.PF_NAME,id:j.PF_ID});var m=$('<div  class="album-thumb" > </div>');var o=$("<div > </div>");m.append(o);if(j.RIGHT>=1){var n=j.PF_NAME_H}else{var n="You do not have permissions to access this album."}var a=$('<img style="width: 170px; height: 173px;" title="'+n+'" alt="'+j.PF_NAME_H+'"/>');var k="image.php?filename=";k+="dGh1bWIuanBn";k+="&albumId=";k+=j.PF_ID+"&v="+j.PF_THUMB;a.attr("src",k);o.append(a);a.addClass("album");if(j.RIGHT>=1){a.get(0).onclick=function(){if(document.arrangeAction){document.arrangeAction=false;return false}Helper.getManager().setState({stateName:StateName.ImageTile,albumId:this.id})}.bind({t:this,id:j.PF_ID});a.addClass("cursor-point");var n=j.PF_NAME_H}else{m.css({opacity:0.5})}var f=$('<div class="album-name" title="'+n+'"> </div>');var g=$('<div class="album-name-full" style="display: none;" ></div>');var l=j.PF_NAME;var c=j.PF_NAME;if(j.PF_NAME.length>20-3){l=l.substr(0,20-3)+"..."}f.text(l);if(j.RIGHT>=1){if(l.length>0){f.click(function(){if(document.arrangeAction){document.arrangeAction=false;return false}Helper.getManager().setState({stateName:StateName.ImageTile,albumId:this.id})}.bind({t:this,id:j.PF_ID}))}f.css({cursor:"pointer"})}var e=$('<div class="album-photos-count" > </div>');e.text(j.PHOTOS_COUNT);m.append(e);var d=$('<div class="album-published" > </div>');m.append(d);if(j.PF_STATUS==1){d.append('<span class="publish_yes" title="Album is published"> </span>')}if(j.PF_STATUS==3){d.append('<span class="publish_hide" title="Album is published privately"> </span>')}m.append(f);m.append(g);if(j.RIGHT>1){m.append($('<a href="#" class="delete-album" style="display: none;">Delete</a>').click(function(p){if(confirm("This will permanently delete all photos inside this album. Delete?")){$.post("backend.php?controller=ajax&action=deleteAlbum",{albumId:j.PF_ID},function(q){if(q.status=="OK"){$("li[uid="+j.PF_ID+"]").remove()}},"json")}return false}));$(".delete-album").css({position:"relative","z-index":2})}var h=$('<div class="album-date" > </div>');var b=j.PF_DATESTR||"";h.attr("title",b);if(b.length>50){b=b.substr(0,50-3)+"..."}h.text(b);m.append(h);return m.get(0)}};ViewImageOn={size:970,template:{}};ModuleRightImages=newClass(null,{constructor:function(a){this.config=a;this.contentElem=a.elem;this.manager=a.manger;var b=a.manger;if(Helper.getManager().getState().stateName==StateName.Alubms){}else{if(Helper.getManager().getState().stateName==StateName.ImageTile){}}},render:function(S,R){jQuery("#album-util-panel > div").css("display","none");var e=R.album;this.album=e;var E=R.data.c;this.record=E;var n=R.exif;var P=$("#rigth-info-panel");switch(S.stateName){case StateName.Alubms:P.hide();$("#main-content").css("margin-right",0);$("#util-album").css("display","");break;case StateName.ImageTile:P.show();$("#main-content").css("margin-right",200);$("#util-image-tile").css("display","");P.empty();var I=$('<div class="rigth-panel-block album_settings"> </div>');P.append(I);$('<a href="#" class="iconlink" id="slideshow-link"><span class="icon"></span><b>Slideshow</b></a>').click(function(){window.open(document.hostUrl+"PD/backend.php?controller=album&action=slideShow&albumId="+e.PF_ID);return false}).appendTo(I);I.append('<p id="rigth-album-datastr">'+e.PF_DATESTR+"</p>");var Q=$('<p id="rigth-album-desc" class="rigth-album-desc"></p>').appendTo(I);Q.append(e.PF_DESC+"<br>");if(Rights.isWrite()){if(e.PF_DESC.length>0){Q.append('<a id="album-desc-edit" href="#"><span></span>edit</a>')}else{Q.append('<a id="album-desc-edit" href="#"><span></span>Edit album description</a>')}}if(Rights.isWrite()){var c=$('<p class="panel-link" > </p>');var b=$('<p class="panel-link" > </p>');var m=$('<a id="view-link" class="opened" href="#"><span></span><span class="dott-border">View</span></a>');var d=$('<a id="arrange-link" class="closed" href="#"><span></span><span class="dott-border">Organize and share</span></a>');document.arrangeOn=function(){document.arrange=new WaArrange({listElements:jQuery(".album-list li").get(),albumId:this.album.PF_ID,updateUrl:"backend.php?controller=ajax&action=sortImage",cssClass:"image-src"});$("#album-content-body").css({"background-color":"#5e5e5e"});$(".image-contener").append('<div class="image-action"><input type="checkbox"/></div>').css({"background-color":"#7c7c7c"});$(".image-contener").find("input").click(function(){var h=$(this).parent().parent().find("img");if($(this).attr("checked")){$(this).parent().parent().css({"background-color":"#d3a300"})}else{$(this).parent().parent().css({"background-color":"#7C7C7C"})}});$(".image-src").removeClass("static").addClass("move");$(".arrange-utils").show();$(".arrange-close").show();$("#arrange-link").removeClass("closed").addClass("opened");$("#view-link").removeClass("opened").addClass("closed");return false};document.arrangeOff=function(){Helper.getManager().setStateParam({arrange:false});Helper.getManager().setState({});$("#album-content-body").css({"background-color":"#fff"});$(".arrange-utils").hide();$("#arrange-link").removeClass("opened").addClass("closed");$("#view-link").removeClass("closed").addClass("opened");return false};d.clickw(function(h){document.arrangeOn.apply(this,[h]);return false}.bind(this));m.clickw(function(){document.arrangeOff.apply(this);return false});c.append(m);b.append(d);I.append(c);I.append(b);if(Helper.getManager().state.arrange){document.arrangeOn.apply(this)}}var J="";if(!Helper.getManager().state.arrange){J='style="display: none;"'}Helper.getManager().setStateParam({arrange:false});var a=$('<div class="arrange-utils" '+J+" />");a.append("<p>Arrange photos using drag'n'drop.</p><br>");a.append('<p>With selected photos (<span class="selectCount">0</span>):</p>');$('<p class="selectall"><a href="#">select all</a><p>').appendTo(a).click(function(){if($(".album-list input[type=checkbox]:checked").size()<$(".album-list input[type=checkbox]").size()){$(".album-list input[type=checkbox]").attr("checked","checked");$(".album-list .image-contener").css({"background-color":"#d3a300"});$(".selectCount").text($(".album-list input[type=checkbox]").size())}else{$(".album-list input[type=checkbox]").attr("checked","");$(".album-list .image-contener").css({"background-color":"#7C7C7C"});$(".selectCount").text(0)}return false});$('<a class="albumlinks" href="#"><span></span><b>Links to photos</b></a>').appendTo(a).click(function(){var h=[];$("ul.album-list li").filter(function(){if($('input[@type$="checkbox"]:checked',this).size()>0){return 1}else{return 0}}).each(function(){h.push($(this).attr("uid"))});$("#swfupload").wbsPopup({url:"backend.php?controller=album&action=linkToImage&images="+h.join(","),width:760,height:440,iframe:true,hidePopup:function(){},callback:{}});return false});if(Rights.manage_collections){a.append('<a class="createlink" href="#"><span></span><b>Create a collection from selected photos</b></a>')}$('<a class="transfer" href="#"><span></span><b>Move to another album</b></a>').appendTo(a).click(function(){var h=$("ul.album-list li").filter(function(){if($('input[@type$="checkbox"]:checked',this).size()>0){return 1}else{return 0}});if(h.size()==0){alert("No images selected.");return false}var k=null;$.ajax({url:"backend.php?controller=ajax&action=albumListCompact",async:false,dataType:"json",success:function(w){k=w.data}});$("#photo-move select").empty();for(index in k){$("#photo-move select").append('<option value="'+k[index].PF_ID+'" title="'+k[index].PF_NAME_FULL+'">'+k[index].PF_NAME+"</option>")}$("#photo-move").wbsPopup({width:400,height:300,iframe:false,hidePopup:function(){}});$("#photo-move #btn_move").unbind().click(function(){var U=$(this);U.attr("disabled","disabled");U.after('<img class="progress" src="img/ajload.gif" />');var T=[];var w=$("ul.album-list li").filter(function(){if($('input[@type$="checkbox"]:checked',this).size()>0){return 1}else{return 0}});w.each(function(){T.push($(this).attr("uid"))});$.post("backend.php?controller=ajax&action=photomove",{albumId:$("#photo-move option:selected").val(),"photolist[]":T},function(){Helper.getManager().setState({viewName:StateName.ImageTile});U.attr("disabled","");$(".progress").remove();$("#photo-move").wbsPopupClose()});return false});return false});var t=$('<a class="albumdelete" href="#"><span></span><b>Delete photos</b></a>');t.clickw(function(){var h=$("ul.album-list li").filter(function(){if($('input[@type$="checkbox"]:checked',this).size()>0){return 1}else{return 0}});if(h.size()==0){alert("No images selected.");return false}if(!confirm("Delete selected photos?")){return false}h.each(function(){var k=$(this).attr("uid");$.ajax({type:"POST",url:"backend.php?controller=ajax&action=deleteImage",data:{imageId:k},async:false,dataType:"json",success:function(){$(".selectCount").text($('input[@type$="checkbox"]:checked',this).size())}});$(this).remove()});return false});a.append(t);I.append(a);$(".createlink").clickw(function(){var k=$("ul.album-list li").filter(function(){if($('input[@type$="checkbox"]:checked',this).size()>0){return 1}else{return 0}}).get();var h="";for(field in k){h+=$(k[field]).attr("uid")+","}$("#pp").wbsPopup({url:"backend.php?controller=album&action=createCollection&albumId="+e.PF_ID+"&imageList="+h,width:760,height:440,iframe:true,hidePopup:function(w){document.notSend=true},loadComplite:function(w){if(document.notSend){document.notSend=false;return}window.location.href=document.hostUrl+"PD/backend.php?controller=album&action=collection&id="+w}});return false});if(Rights.isWrite()){var G=$('<div class="rigth-panel-block"> </div>');P.append(G);$("#rigth-album-desc").click(function(){$("#pp").wbsPopup({url:"backend.php?controller=album&action=changeDescElement&type=album&albumId="+this.album.PF_ID,width:500,height:440,iframe:true,hidePopup:function(){Helper.getManager().setState()}});return false}.bind(this));$('<a href="#" id="descr-edit" class="iconlink"><span class="icon"></span><b>Edit photo descriptions</b></a>').click(function(){$("#pp").wbsPopup({url:"backend.php?controller=album&action=changePhotoDesc&albumId="+this.album.PF_ID,width:760,height:440,iframe:true,hidePopup:function(){}});return false}.bind(this)).appendTo(G);if(Rights.manage_collections){var p=$('<a id="creat-collection" class="iconlink" href="#"><span class="icon"> </span><b>Create a collection</b></a>');G.append(p);p.clickw(function(){var k=$("ul.album-list li").filter(function(){if($('input[@type$="checkbox"]:checked',this).size()>0){return 1}else{return 0}}).get();var h="";for(field in k){h+=$(k[field]).attr("uid")+","}$("#pp").wbsPopup({url:"backend.php?controller=album&action=createCollection&albumId="+e.PF_ID+"&imageList="+h,width:760,height:440,iframe:true,hidePopup:function(w){document.notSend=true},loadComplite:function(w){if(document.notSend){document.notSend=false;return}window.location.href=document.hostUrl+"PD/backend.php?controller=album&action=collection&id="+w}});return false})}var D=$('<a id="flickr-import" href="#" class="iconlink"><span class="icon"></span><b>Import from Flickr<img src="img/new_window_icon.gif" width="13" height="11" alt="" /></b></a>');D.clickw(function(){window.open(document.hostUrl+"/PD/backend.php?controller=flickr&action=auth&album="+e.PF_ID);return false});G.append(D);if(Rights.isFull()){$('<a id="delete-album" href="#" class="iconlink"><span class="icon"></span><b>Delete album</b></a>').click(function(){if(confirm("This will permanently delete all photos inside this album. Delete?")){$.post("backend.php?controller=ajax&action=deleteAlbum",{albumId:e.PF_ID},function(){Helper.getManager().setState({stateName:StateName.Alubms})})}return false}).appendTo(G)}}break;case StateName.ImageOne:$("#rigth-info-panel").show();$("#main-content").css("margin-right",200);$("#util-image-tile").css("display","");P.empty();I=$('<div class="rigth-panel-block preview-info"> </div>');P.append(I);var Q=$('<p id="rigth-album-desc" class="rigth-album-desc"></p>').appendTo(I);Q.append(E.PL_DESC+"<br/>");if(Rights.isWrite()){if(E.PL_DESC.length>0){Q.append('<a href="#">edit</a>')}else{Q.append('<a href="#">Edit photo description</a>')}$("#rigth-album-desc a").click(function(){$("#pp").wbsPopup({url:"backend.php?controller=album&action=changeDescElement&type=image&imageId="+this.record.PL_ID,width:500,height:440,iframe:true,hidePopup:function(){Helper.getManager().setState()}});return false}.bind(this))}var A=$('<ul class="size_list"></ul>');var F=parseInt(ViewImageOn.originalW);var O=parseInt(ViewImageOn.originalH);var N=F/O;if(F>O){A.append('<li id="size_96" s="96"><a href="#">96x96</a></li>');A.append('<li id="size_144" s="144"><a href="#">144x144</a></li>');if(F>256){A.append('<li id="size_256" s="256"><a href="#">256x'+Math.floor(256/N)+"</a></li>")}if(F>512){A.append('<li id="size_512" s="512"><a href="#">512x'+Math.floor(512/N)+"</a></li>")}if(F>750){A.append('<li id="size_750" s="750"><a href="#">750x'+Math.floor(750/N)+"</a></li>")}if(F>970){A.append('<li id="size_970" s="970"><a href="#">970x'+Math.floor(970/N)+"</a></li>")}}else{A.append('<li id="size_96" s="96"><a href="#">96x96</a></li>');A.append('<li id="size_144" s="144"><a href="#">144x144</a></li>');if(O>256){A.append('<li id="size_256" s="256"><a href="#">'+Math.floor(256*N)+"x256</a></li>")}if(O>512){A.append('<li id="size_512" s="512"><a href="#">'+Math.floor(521*N)+"x512</a></li>")}if(O>750){A.append('<li id="size_750" s="750"><a href="#">'+Math.floor(750*N)+"x750</a></li>")}if(O>970){A.append('<li id="size_970" s="970"><a href="#">'+Math.floor(970*N)+"x970</a></li>")}}I.append(A);$("li",A).removeClass();$("#size_"+$.cookie("sizeOneView"),A).addClass("size_active");if($("#size_"+$.cookie("sizeOneView")).size()==0){$(".size_list li:last").addClass("size_active")}var q=function(V,w,W){if(!V){return false}var h=String(w.IMG_URL+"/"+V).split("/");var T=h.pop();var k=h.pop();$("#link_main").val(W.urlToView+k+"/"+T);$("#link_main_a").attr("href",W.urlToView+k+"/"+T);var X="";if(w.PL_DESC_H.length>0){X='alt=" '+w.PL_DESC_H+' "'}var U=String(w.IMG_URL_R).replace(/\.[0-9]+\.jpg/i,"."+V+".jpg");$("#link_url").val(U);$("#link_html").val('<img src="'+U+'" '+X+"/>");$("#link_bb").val("[IMG]"+U+"[/IMG]")};var l=$(".size_active").attr("s");$("li a",A).click(function(){if($(".imgareaselect-border2:visible").size()>0){$("img.image-one").imgAreaSelect({hide:true})}$(".crop-span").hide();Semaphore.stopProccess();var W=$(this).parent().attr("s");if(W<=144){$(".crop").hide()}else{$(".crop").show()}jQuery.cookie("sizeOneView",W);var V=$(".image-one");Helper.getManager().startProccess();V.load(function(){Helper.getManager().stopProccess()});V.attr("src",V.attr("src").replace(/size=([0-9])+/,"size="+W));var T=ViewImageOn.originalW;var X=ViewImageOn.originalH;var U=T/X;if((W in {96:"",144:""})){ViewImageOn.template.data.PL_WIDTH=W;ViewImageOn.template.data.PL_HEIGHT=W}else{if(Data.data.c&&Data.data.c.sizes&&Data.data.c.sizes[W]){ViewImageOn.template.data.PL_WIDTH=Data.data.c.sizes[W].w;ViewImageOn.template.data.PL_HEIGHT=Data.data.c.sizes[W].h}else{if(T>X){ViewImageOn.template.data.PL_WIDTH=W;ViewImageOn.template.data.PL_HEIGHT=W/U}else{ViewImageOn.template.data.PL_WIDTH=W*U;ViewImageOn.template.data.PL_HEIGHT=W}}}q(W,E,R);$(".size_list li").removeClass();$("#size_"+W).addClass("size_active");$("#link_main, #link_url, #link_html, #link_bb").css("font-weight","bold");setTimeout(function(){$("#link_main, #link_url, #link_html, #link_bb").css("font-weight","normal")},700);return false});var x=$('<div class="photourls"></div>');I.append(x);x.append('<h4 class="photourls-h"> </h4>');x.append('<a id="link_main_a" href="" target="_blank"><img src="img/new_window_icon.gif" /></a><label for="link_main"><b>Link (for email and IM):</b></label>');x.append('<p><input id="link_main" type="text" value="" readonly="true" /> </p>');x.append('<label for="link_html">HTML (for websites and blogs):</label>');x.append('<p><input id="link_html" type="text" value="" readonly="true" /> </p>');x.append('<label for="link_bb">BBcode (forums):</label>');x.append('<p><input id="link_bb" type="text" value="" readonly="true" /> </p>');x.append('<label for="link_url">URL:</label>');x.append('<p><input id="link_url" type="text" value="" readonly="true"/> </p>');$(".rigth-panel-block input").clickToSelect();var l=($.cookie("sizeOneView"))?$.cookie("sizeOneView"):970;q(l,E,R);var j=$('<div class="rigth-panel-block original"> </div>');P.append(j);j.append("<h4>Original</h4>");j.append('<p class="photo-size">'+parseInt(E.PL_W)+"x"+parseInt(E.PL_H)+", "+$.filesizeformat(E.PL_FILESIZE)+"</p>");var g=E.HASH;j.append('<p class="org-link"><a href="'+g+'" target="_blank"><img src="img/new_window_icon.gif" /></a><input id="oreginal-link" type="text" value="'+g+'"/></p>');$("#oreginal-link").clickToSelect();$("#link_main, #link_url, #link_html, #link_bb, #oreginal-link").focus(function(){WbsData.set({isKeyEnable:false})}).blur(function(){WbsData.set({isKeyEnable:true})});var H=$('<div class="rigth-panel-block actions"> </div>');P.append(H);if(Rights.isWrite()){Semaphore.init();var M=$('<a href="#" class="sidebar-btn rleft"><span class="active" alt="Rotate left" title="Rotate left" >&nbsp;</span></a>');this.$leftRotate=M;Semaphore.addButton(M);M.clickw(function(){if(!Semaphore.startProccess($(this))){return false}startProgress();$.post("backend.php?controller=ajax&action=rotateImage",{imageId:this.record.PL_ID,imageFile:this.record.PL_DISKFILENAME,albumId:this.record.PF_ID,width:this.record.PL_WIDTH,height:this.record.PL_HEIGHT,rotate:-90},function(){Helper.getManager().setState({stateName:StateName.ImageOne});Semaphore.stopProccess();stopProgress()}.bind(this));return false}.bind(this));H.append(M);$(".rleft span").hover(function(){$(this).removeClass("active").addClass("hovered")},function(){$(this).removeClass("hovered").addClass("active")});var C=$('<a href="#" class="sidebar-btn rright"><span class="active" alt="Rotate right" title="Rotate right">&nbsp;</span></a>');this.$rigthRotate=C;Semaphore.addButton(C);C.clickw(function(){if(!Semaphore.startProccess($(this))){return false}startProgress();$.post("backend.php?controller=ajax&action=rotateImage",{imageId:this.record.PL_ID,imageFile:this.record.PL_DISKFILENAME,albumId:this.record.PF_ID,width:this.record.PL_WIDTH,height:this.record.PL_HEIGHT,rotate:90},function(){Helper.getManager().setState({stateName:StateName.ImageOne});Semaphore.stopProccess();stopProgress()}.bind(this));return false}.bind(this));H.append(C);$(".rright span").hover(function(){$(this).removeClass("active").addClass("hovered")},function(){$(this).removeClass("hovered").addClass("active")});if($.cookie("sizeOneView")<=144){var K='style="display: none"'}else{var K=""}var f=$('<a href="#" class="sidebar-btn crop" '+K+'><span class="active" alt="Crop" title="Crop">&nbsp;</span></a>');this.$cropbtn=f;Semaphore.addButton(f);f.clickw(function(){if(!Semaphore.startProccess($(this))){return false}this.imageAreaSelect={imageId:this.record.PL_ID,imageFile:this.record.PL_DISKFILENAME,albumId:this.record.PF_ID,x:$("img.image-one").width()*0.1,y:$("img.image-one").height()*0.1,width:$("img.image-one").width()-2*$("img.image-one").width()*0.1,height:$("img.image-one").height()-2*$("img.image-one").height()*0.1};$("img.image-one").imgAreaSelect({isStopNewSelect:true,handles:true,x1:$("img.image-one").width()*0.1,y1:$("img.image-one").height()*0.1,x2:$("img.image-one").width()-$("img.image-one").width()*0.1,y2:$("img.image-one").height()-$("img.image-one").height()*0.1,minWidth:2,minHeight:2,keys:false,onSelectChange:function(k,h){this.imageAreaSelect={imageId:this.record.PL_ID,imageFile:this.record.PL_DISKFILENAME,albumId:this.record.PF_ID,x:h.x1,y:h.y1,width:h.width,height:h.height}}.bind(this)});$(window).resize(function(){$("img.image-one").imgAreaSelect({hide:true});Semaphore.stopProccess();$(".crop-span").hide()});$(".crop-span").show();return false}.bind(this));WBS.History.on("change",function(){$("img.image-one").imgAreaSelect({hide:true});Semaphore.stopProccess()});H.append(f);var B=$(".size_active").attr("s");if(B<=144){$(".crop").hide()}else{$(".crop").show()}$(".crop span").hover(function(){$(this).removeClass("active").addClass("hovered")},function(){$(this).removeClass("hovered").addClass("active")});var s=$('<span class="crop-span" style="display: none"/>');var y=$('<input class="sidebar-btn crop-done" value="Crop" type="button"/>');this.$cropDoneBtn=y;var v=function(){if($(".imgareaselect-border2:visible").size()>0){startProgress();var h=this.record.PL_W/$(".image-one").width();this.imageAreaSelect.x*=h;this.imageAreaSelect.y*=h;this.imageAreaSelect.width*=h;this.imageAreaSelect.height*=h;$.post("backend.php?controller=ajax&action=cropImage",this.imageAreaSelect,function(){$(".image-one").imgAreaSelect({hide:true});Helper.getManager().setState({stateName:StateName.ImageOne},function(){var k=$(".size_active").attr("s");if(k<=144){$(".crop").hide()}else{$(".crop").show()}});Semaphore.stopProccess();stopProgress()}.bind(this));$(".crop-span").hide();$("img.image-one").imgAreaSelect({hide:true});Semaphore.stopProccess()}return false}.bind(this);y.clickw(v);$(document).unbind("keydown","return",v).bind("keydown","return",v);s.append(y);var u=$('<a href="#" class="sidebar-btn crop-cancel" >Cancel</a>');this.$cropCancelBtn=u;u.clickw(function(){$(".image-one").imgAreaSelect({hide:true});$(".crop-span").hide();Semaphore.stopProccess();return false});s.append(u);H.append(s);if(this.album.PF_THUMB!=this.record.PL_ID){var o="<b>Make this a key photo</b>";var z="thumb_btn"}else{var r="";if(Data.album.PF_NAME.length>30){r=Data.album.PF_NAME.substr(0,30)+"..."}else{r=Data.album.PF_NAME}var o=$.sprintf('This is a key photo for this album "%s"',r);var z="thumb_btn_des"}H.append('<div class="btn_thumb_album"></div>');$('<a href="#" class="'+z+'"><span> </span>'+o+"</a>").click(function(){$.post("backend.php?controller=ajax&action=changeThumbAlbum",{albumId:this.album.PF_ID,thumbId:this.record.PL_ID,thumbPath:this.record.PL_DISKFILENAME},function(k,w){if(k.status=="OK"){var h="";if(Data.album.PF_NAME.length>30){h=Data.album.PF_NAME.substr(0,30)+"..."}else{h=Data.album.PF_NAME}$(".thumb_btn").html($.sprintf('<span> </span><b class="lightb">This is a key photo for album "%s".</b>',h)).removeClass().addClass("thumb_btn_des")}},"json");return false}.bind(this)).appendTo(H);P.append(H)}if(Rights.isWrite()){$(H).append('<br class="clearleft" />');$('<a id="delete-image" href="#" class="iconlink"><span class="icon"></span><b>Delete photo</b></a>').click(function(){if(confirm("This will permanently delete photo. Are you sure?")){$.post("backend.php?controller=ajax&action=deleteImage",{imageId:this.record.PL_ID},function(){Helper.getManager().setState({stateName:StateName.ImageTile})})}return false}.bind(this)).appendTo(H)}G=$('<div class="rigth-panel-block details"> </div>');P.append(G);G.append('<p class="exif-info"><b>Details (EXIF)</b><p>');if(n.PE_DATETIME&&n.PE_DATETIME.length>0){G.append("<p>Taken: <span>"+n.PE_DATETIME+"</span></p>")}if(this.record.PL_UPLOADDATETIME&&this.record.PL_UPLOADDATETIME.length>0){G.append("<p>Uploaded: <span>"+this.record.PL_UPLOADDATETIME+"</span></p>")}if(this.record.PL_W||n.PL_H){G.append("<p>Image size: <span>"+parseInt(this.record.PL_W)+"x"+parseInt(this.record.PL_H)+"</span></p>")}if(n.PE_MODEL&&n.PE_MODEL.length>0){G.append("<p>Camera: <span>"+n.PE_MODEL+"</span></p>")}if(n.PE_EXPOSURETIME&&n.PE_EXPOSURETIME.length>0){var L=(/1\//.test(n.PE_EXPOSURETIME))?n.PE_EXPOSURETIME:n.PE_EXPOSURETIME+" sec";G.append("<p>Shutter: <span>"+L+"</span></p>")}if(n.PE_FNUMBER&&n.PE_FNUMBER.length>0){G.append("<p>Aperture: <span>"+n.PE_FNUMBER+"</span></p>")}if(n.PE_FOCALLENGTH&&n.PE_FOCALLENGTH.length>0){G.append("<p>Focal length: <span>"+n.PE_FOCALLENGTH+"</span></p>")}if(n.PE_ISOSPEEDRATINGS&&n.PE_ISOSPEEDRATINGS.length>0){G.append("<p>ISO: <span>"+n.PE_ISOSPEEDRATINGS+"</span></p>")}$("p span",G).each(function(){if($(this).text()==""||$(this).text()=="undefined"){$(this).parent().remove()}});break}},_addItem:function(a){addClass(a,"album-util-panel-item");this.contentElem.appendChild(div)}});ModuleRightImages.resetProccess=function(){$("img.image-one").imgAreaSelect({hide:true});$(".crop-span").hide();Semaphore.stopProccess()};var startProgress=function(){var c=$(".image-one");var b=$('<div id="bg"> </div>').css({position:"absolute",top:c.offset().top,left:c.offset().left,width:c.width(),height:c.height(),"background-color":"#FFF","z-index":600,opacity:0.5});var a=$('<div id="bganimate"> <img src="img/proccess.gif" /></div>').css({top:c.offset().top+c.height()/2-50/2,left:c.offset().left+c.width()/2-50/2,width:41,height:41,display:"block",position:"absolute","z-index":610,"background-color":"#000","padding-left":9,"padding-top":9});b.appendTo("body");a.appendTo("body")};var stopProgress=function(){$("#bg").remove();$("#bganimate").remove()};ModuleInfoPanel=newClass(null,{render:function(a,f){switch(a.stateName){case StateName.Alubms:Helper.getManager().resizer.setHResize1();jQuery("#hor-info-panel").css("display","none");Helper.getManager().resizer.resize();jQuery("#btn-album-add").clickw(function(){$(this).attr("disabled","disabled");$(this).after('<img src="img/ajload.gif" />');jQuery.post("backend.php?controller=ajax&action=createAlbum",function(){Helper.getManager().setState({},function(){$(".album-list .album-name:first").editable("backend.php?controller=ajax&action=cangeAlbumName",{name:"albumName",submitdata:{albumId:$(".album-list li:first").attr("uid")},tooltip:d,style:"inherit",onblur:"ignore",cancel:" ",width:"",height:"",cssclass:"inline-select",submit:"Save",postSubmitText:"",fieldCount:20,callback:function(){$(".album-list .album-name:first").unbind().click(function(){Helper.getManager().setState({stateName:StateName.ImageTile,albumId:$(this).parent().parent().attr("uid")})})}}).click();$(".album-list .album-thumb:first").find(".album-photos-count").hide()})})});document.iSbtnAlbumAdd=true;jQuery("#btn-album-arrange").toggle(function(){$(".album-name a").click();document.arrange=new WaArrange({listElements:jQuery(".album-list li").get(),updateUrl:"backend.php?controller=ajax&action=sortAlbum",cssClass:"album"});jQuery("#btn-album-arrange").text("View albums mode");jQuery("#album-content-body").css({"background-color":"#D8E0E5"});$(".delete-album").show();$(".album-thumb").addClass("album-edit");$(".album-list img.album").css({cursor:"move"});$(".album-date").hide();$("#btn-album-add").hide();$("#album-arrange-tile").show()},function(){jQuery("#btn-album-arrange").text("Organize albums");document.arrange=null;Helper.getManager().setState({});jQuery("#album-content-body").css({"background-color":"#fff"});$(".delete-album").hide();$("#btn-album-add").show();$("#album-arrange-tile").hide()});break;case StateName.ImageOne:case StateName.ImageDetail:case StateName.ImageTile:Helper.getManager().resizer.setHResize2();jQuery("#hor-info-panel").css("display","");Helper.getManager().resizer.resize();var c=f.album;this.album=f.album;if(!Rights.isWrite()){$(".upload-box").hide()}else{$(".upload-box").show()}jQuery("#content-header-bar").css("display","");jQuery("#content-header").css("height","80");var g=c.PF_NAME;var d=c.PF_NAME;$("#album-info").empty().append('<span id="album-name"></span>').append('<span id="album-name-full" style="display: none;"></span>');$("#album-name").next().text(d);if(g.length>40){g=g.substr(0,40-3)+"..."}$("#album-name").text(g);if(Rights.isWrite()){var j=$('<span class="album-rename">rename</span>').click(function(){$(this).hide();$("#album-name").click()});$("#album-name").next().after(j)}if(Rights.isWrite()){$("#album-name").editable("backend.php?controller=ajax&action=cangeAlbumName",{name:"albumName",submitdata:{albumId:c.PF_ID},tooltip:d,style:"inherit",onblur:"ignore",cancel:"cancel",width:"",height:"",cssclass:"album-name-edit",submit:"Save",fieldCount:40,postSubmitText:"or",startEvent:function(){WbsData.set({isKeyEnable:false});$(".album-rename").hide()},endEvent:function(){WbsData.set({isKeyEnable:true});$(".album-rename").show()},cancelEvent:function(){WbsData.set({isKeyEnable:true});$(".album-rename").show()}})}else{$("#album-name").unbind()}var h=document.mainUrl+c.PF_LINK;if(h.length>45){h=h.slice(0,22)+"..."+h.slice(-20,h.length)}if(c.PF_STATUS==0||c.PF_STATUS==2){$("#album-access").get(0).innerHTML="<span class='publish-no'>Album is not published.</span>";$("#album-url").empty();if(Rights.isFull()){$("#btn-album-setting").text("Publish")}}else{if(c.PF_STATUS==1){$("#album-access").get(0).innerHTML="<span class='publish-yes'>Album is published:</span>";$("#album-url").empty().append('<a target="_blank" href="'+document.mainUrl+c.PF_LINK+'">'+h+' <img src="img/new_window_icon.gif" /></a>');if(Rights.isFull()){$("#btn-album-setting").text("Settings")}}else{if(c.PF_STATUS==3){$("#album-access").get(0).innerHTML="<span class='publish-lock'>Album is published privately:</span>";$("#album-url").empty().append($('<a target="_blank" href="'+document.mainUrl+c.PF_LINK+'">'+h+' <img src="img/new_window_icon.gif" /></a>'));if(Rights.isFull()){$("#btn-album-setting").text("Settings")}}}}if(!document.iSbtnAlbumSetting){$("#btn-album-setting").unbind();$("#btn-album-setting").get(0).onclick=function(){$("#pp").wbsPopup({url:"backend.php?controller=album&action=albumSetting&albumId="+Helper.getManager().getState({}).albumId,width:760,height:440,iframe:true,hidePopup:function(){Helper.getManager().setState({})}});return false};document.iSbtnAlbumSetting=true}if(Rights.isWrite()){$("#btn-album-setting").show()}else{$("#btn-album-setting").hide()}$("#album-date-create").text(c.PF_CREATEDATETIME);var b=c.PF_CREATEUSERNAME;if(b.length>20){b=b.slice(0,17)+"..."}$("#album-user").text(b);var e="";if(Rights.album=="7"){e="full"}else{if(Rights.album=="3"){e="read & write"}else{if(Rights.album=="1"){e="read"}else{e="read"}}}$("#album-right").text(e);break}}});ModuleFooter=newClass(null,{constructor:function(a){this.config=a;this.contentElem=a.elem;this.manager=a.manager},render:function(a,j){switch(a.stateName){case StateName.Alubms:removeChildNodes(this.contentElem);var o=createElem("div","image-pager");this.contentElem.appendChild(o);var d=new WaPager({elem:o,manager:Helper.getManager()});d.render(a,j);break;case StateName.ImageDetail:case StateName.ImageTile:this.data=j[0];removeChildNodes(this.contentElem);var p=createElem("div","image-slider");var o=createElem("div","image-pager");var m=createElem("div","image-page-select");this.contentElem.appendChild(p);var k=$('<div class="back_album"></div>');$('<a href="#" title="Back to albums"><img style="width: 25px; height: 25px" src="img/back.gif" alt="Back to albums"/>Albums</a>').appendTo(k).click(function(){Helper.getManager().setState({stateName:StateName.Alubms});return false});$(this.contentElem).append(k);this.contentElem.appendChild(o);var f=Helper.getManager().getState().limit;$(this.contentElem).append('<div class="image-count"><span class="image-page-count">'+f+"</span>photos on a page</div>");$(".image-page-count").clickw(function(q){var r=new PDPAgePop({isPd:true});r.show(q);return false});this.contentElem.appendChild(m);var d=new WaPager({elem:o,manager:Helper.getManager()});d.render(a,j);if(document.slider&&document.slider!=undefined&&document.slider.destroy){document.slider.destroy()}var b=new WsbSlider({elem:p,widthCss:150,startValue:144,defaultValue:jQuery.cookie("imageSize"),endValue:512,onChange:function(t){var q=$(".image-src").get();for(var r=0;r<q.length;r++){var s=$(q[r]);if(Number(document.imageGeometry[s.attr("gid")].w)>Number(document.imageGeometry[s.attr("gid")].h)){s.css("width",t.pos)}else{s.css("height",t.pos)}s.parent().css({width:parseInt(t.pos)+parseInt(8),height:parseInt(t.pos)+parseInt(8)});$(".image-contener i").css({height:parseInt(t.pos)+parseInt(8)})}},onChangeComplite:function(t){var q=$(".image-src").get();for(var r=0;r<q.length;r++){var s=q[r];var u=$(s).attr("src");if(t.pos<=96){if(u){u=u.replace(/size\=[0-9]+/,"size=96")}document.imgSizeProp[r].img_src=u;$(s).attr("src-c",u);$(s).attr("size-c",s.orig_size);$(s).attr("src",u)}else{if(t.pos<=144){if(u){u=u.replace(/size\=[0-9]+/,"size=144")}document.imgSizeProp[r].img_src=u;$(s).attr("src-c",u);$(s).attr("size-c",s.orig_size);$(s).attr("src",u)}else{if(t.pos<=256&&s.orig_size>=256){if(u){u=u.replace(/size\=[0-9]+/,"size=256")}document.imgSizeProp[r].img_src=u;$(s).attr("src-c",u);$(s).attr("size-c",s.orig_size);$(s).attr("src",u)}else{if(t.pos<=512&&s.orig_size>=512){if(u){u=u.replace(/size\=[0-9]+/,"size=512")}document.imgSizeProp[r].img_src=u;$(s).attr("src-c",u);$(s).attr("size-c",s.orig_size);$(s).attr("src",u)}}}}}jQuery.cookie("imageSize",t.pos);document.imageSize=t.pos;for(var r=0;r<document.imgSizeProp.length;r++){document.imgSizeProp[r].loadSrc()}}});document.slider=b;var g=Helper.getManager().getState().offset;var f=Helper.getManager().getState().limit;$(m).wbsPager({current:g/f+1,count:Math.ceil(j.total/f),limit:3,pagegoto:function(q){if($("#arrange-link").hasClass("opened")){Helper.getManager().setStateParam({arrange:true})}Helper.getManager().setState({offset:q*f-f})}});return this.contentElem;break;case StateName.ImageOne:this.data=j.data.c;this.datal=j.data.l;this.datar=j.data.r;removeChildNodes(this.contentElem);var e=j.data.c;$('<div class="back-to-album"><img src="img/back.gif" width="25" height="25" alt="Back to album" /><a href="#">Back to album</a></div>').appendTo(this.contentElem).find("a").click(function(){Helper.getManager().setState({stateName:StateName.ImageTile,albumId:e.PF_ID});return false});var l=createElem("div","image-selector");var c=createElem("a");$(c).attr("href","#");c.onclick=function(){if(this.datal&&this.datal.PL_ID!=undefined){Helper.getManager().setState({viewName:"ImageOn",imageId:this.datal.PL_ID})}return false}.bind(this);c.innerHTML="&larr;";var n=createElem("span");n.innerHTML=$.sprintf("Photo %s of %s",parseInt(this.data.PL_SORT)+1,j.imageCount);var h=createElem("a");$(h).attr("href","#");h.onclick=function(){if(this.datar&&this.datar.PL_ID!=undefined){Helper.getManager().setState({viewName:"ImageOn",imageId:this.datar.PL_ID})}return false}.bind(this);h.innerHTML="&rarr;";l.appendChild(c);l.appendChild(n);l.appendChild(h);this.contentElem.appendChild(l);return this.contentElem;break}}});PDPAgePop=newClass(WbsPopmenu,{constructor:function(b){document.isArrangemod=function(){if($("#arrange-link").hasClass("opened")){Helper.getManager().setStateParam({arrange:true})}};var a=[{label:"10",onClick:function(){document.isArrangemod.apply();Helper.getManager().setState({limit:10,offset:0});$.cookie("limit",10)}},{label:"20",onClick:function(){document.isArrangemod.apply();Helper.getManager().setState({limit:20,offset:0});$.cookie("limit",20)}},{label:"50",onClick:function(){document.isArrangemod.apply();Helper.getManager().setState({limit:50,offset:0});$.cookie("limit",50)}},{label:"100",onClick:function(){document.isArrangemod.apply();Helper.getManager().setState({limit:100,offset:0});$.cookie("limit",100)}},{label:"150",onClick:function(){document.isArrangemod.apply();Helper.getManager().setState({limit:150,offset:0});$.cookie("limit",150)}}];this.superclass().constructor.call(this,{items:a,isPd:b.isPd})}});TemplateImageTile={render:function(f,g){this.contentElem=f;$(f).css({height:"100%"});var d=g.data;this.ulContener=createElem("ul","album-list");var b=new Array();document.imgSizeProp=new Array();document.imageGeometry=new Array();for(var e=0;e<d.length;e++){var a=createElem("li");jQuery(a).attr("uid",d[e].PL_ID);var c=new ImageItem(d[e],e);a.appendChild(c.elem);this.ulContener.appendChild(a);b.push(a)}for(var e=0;e<document.imgSizeProp.length;e++){document.imgSizeProp[e].loadSrc()}this.contentElem.appendChild(this.ulContener)}};ImageItem=newClass(null,{constructor:function(a,f){this.isLoaded=false;this.num=f;this.data=a;var g=createElem("div","image-contener");this.elem=g;if(document.imageSize){$(g).css({width:parseInt(document.imageSize)+parseInt(6),height:parseInt(document.imageSize)+parseInt(6)});if($.browser.msie&&($.browser.version=="6.0"||$.browser.version=="7.0")){$("<i></i>").css({height:document.imageSize}).appendTo(g)}}var c=createElem("img","image-src");this.img_src="image.php?filename=";this.img_src+=a.PL_DISKFILENAME;this.img_src+="&albumId=";this.img_src+=a.PF_ID;c.data=this.data;c.orig_size=Math.max(this.data.PL_WIDTH,this.data.PL_HEIGHT);$(c).addClass("static");var e=jQuery.cookie("imageSize");var b="144";if(e>144&&c.orig_size>=256){b=256}if(e>256&&c.orig_size>=512){b=512}this.img_src+="&size="+b+"&v="+a.PL_ROTATE;this.img=c;this.img.srcurl=this.img_src;g.appendChild(c);var d=$(c);if(a.PL_ID==ImageInfo.lastImageId()){d.addClass("oldImage")}jQuery("#album-content-body").bind("scroll",function(){this.scrollHandle()}.bind(this));document.imgSizeProp.push(this);document.imageGeometry[a.PL_ID]={w:this.data.PL_WIDTH,h:this.data.PL_HEIGHT};$(c).attr("gid",a.PL_ID);c.owner_obj=this;c.onclick=function(){document.isProcessSleep=true;if(this.isArrange){return false}var q=$(this).offset();var l=$(this).width();var u=$(this).height();var n=l/u;var j=$('<img id="previewimg"/>').attr("src",$(this).attr("src")).css({position:"absolute",left:q.left,top:q.top,width:l,height:u,"z-index":102});$("body").append(j);this.$img=j;var t=$("#album-content-body").width();var p=$("#album-content-body").height();var o=$("#album-content-body").offset();var x=$('<div id="backg" ></div>').css({position:"absolute",width:t,height:p,left:o.left,top:o.top,opacity:0,backgroundColor:"#FFFFFF","z-index":100});$("body").append(x);var y=jQuery.cookie("sizeOneView");size1=(y)?y:970;size2=maxSizeByImg(Math.max(this.data.PL_WIDTH,this.data.PL_HEIGHT),[256,512,750,970]);y=Math.min(size1,size2);if(y>144){var n=this.data.PL_WIDTH/this.data.PL_HEIGHT;if(this.data.PL_WIDTH>this.data.PL_HEIGHT){this.data.PL_WIDTH=parseInt(y);this.data.PL_HEIGHT=parseInt(y/n)}else{this.data.PL_HEIGHT=parseInt(y);this.data.PL_WIDTH=parseInt(y*n)}}else{this.data.PL_WIDTH=y;this.data.PL_HEIGHT=y}var m=this.data.PL_WIDTH;var s=this.data.PL_HEIGHT;t=Math.min(t,970);p=Math.min(p,970);if(t-l>p-u){t=Math.min(m,t)}else{p=Math.min(s,p)}if(p-t/n>t-p*n){var v=t;var r=t/n}else{var v=n*p;var r=p}document.isAnim=true;j.animate({top:$("#album-content-body").offset().top+$("#album-content-body").height()/2-r/2,left:$("#album-content-body").width()/2-v/2,width:v,height:r},300,function(){if(!document.isAnim){return false}Helper.getManager().setState({stateName:StateName.ImageOne,imageId:$(this).parent().parent().attr("uid")},function(){j.click(function(){$(this).unbind().remove();$(".image-one").remove();$("#backg").remove();document.isAnim=false;if(Helper.getManager().getState().stateName!=StateName.ImageTile){Helper.getManager().setState({stateName:StateName.ImageTile})}})})}.bind(this));document.imageOneLoad=function(){$("#backg").remove();this.animate({opacity:0},600,function(){$("#previewimg").remove();document.isProcessSleep=false;Helper.getManager().stopProccess()})}.bind(j);x.animate({opacity:1},200);return false}.bind(c)},scrollHandle:function(){this.loadSrc()},getActualSrc:function(c,a){var b=jQuery.cookie("imageSize");if(b<=144){b=144;c=c.replace(/size\=[0-9]+/,"size="+b)}else{if(b<=256&&a>=256){b=256;c=c.replace(/size\=[0-9]+/,"size="+b)}else{if(b<=512&&a>=512){b=512;c=c.replace(/size\=[0-9]+/,"size="+b)}}}return c},loadSrc:function(){if(!this.isLoaded){if(Helper.getManager().imageHashe[this.data.PL_ID]){if($(this.img).attr("src-c")){this.img.setAttribute("src",$(this.img).attr("src-c"))}else{this.img.setAttribute("src",this.img.srcurl)}jQuery(this.img).css("opacity",1)}else{jQuery(this.img).css("opacity",0);var b=jQuery("#main").height();var a=jQuery("#album-content-body").width();var c=jQuery.cookie("imageSize");var d=0;var f=Math.ceil(this.num*c/a)*c;if(f<=(b+parseInt(jQuery("#album-content-body").scrollTop()))){this.img.setAttribute("src",this.getActualSrc(this.img.srcurl,$(this.img).attr("size-c")));this.img.onload=function(){Helper.getManager().imageHashe[this.data.PL_ID]=this.data.PL_ID;jQuery(this.img).animate({opacity:1},500)}.bind(this);this.isLoaded=true}}}var e=jQuery.cookie("imageSize");if(Number(this.data.PL_WIDTH)>Number(this.data.PL_HEIGHT)){this.img.style.width=(e)+"px"}else{this.img.style.height=(e)+"px"}this.elem.style.width=(parseInt(e)+parseInt(8))+"px";this.elem.style.height=(parseInt(e)+parseInt(8))+"px"}});TemplateImageDetail={render:function(e,f){this.elem=e;var c=f.data;var b=createElem("ul","album-list-detail");for(var d=0;d<c.length;d++){var a=createElem("li");a.appendChild(this._createImageItem(c[d]));b.appendChild(a)}this.elem.appendChild(b);return e},_createImageItem:function(a){var e=createElem("div","image-thumb");addClass(e,"galery");e.style.width=document.imageSize;e.style.height=document.imageSize;var b=createElem("img","galery-img");var c="image.php?filename=";c+=a.PL_DISKFILENAME;c+="&albumId=";c+=a.PF_ID;c+="&size=256";b.setAttribute("src",c);b.onload=function(){e.appendChild(b);if(jQuery(this).width()>jQuery(this).height()){document.imgSizeProp.push({target:this,prop:"width"});this.style.width=document.imageSize}else{document.imgSizeProp.push({target:this,prop:"height"});this.style.height=document.imageSize}}.bind(b);b.style.width=document.imageSize;var d=createDiv("");d.innerHTML="description";e.appendChild(d);return e}};WAResize=newClass(null,{HEADER_HEIGHT:50,constructor:function(a){jQuery(window).resize(function(){this.resize()}.bind(this))},setHResize1:function(){this.HEADER_HEIGHT=41},setHResize2:function(){this.HEADER_HEIGHT=102},resize:function(){var a=jQuery(window).height()-this.HEADER_HEIGHT;jQuery(".resize").height(a);jQuery("#album-content-body").height(a-26)}});TemplateImageOn=newClass(null,{constructor:function(a){this.data=null;jQuery(window).resize(function(){this.resize()}.bind(this))},resize:function(){var e=this.data.PL_WIDTH;var g=this.data.PL_HEIGHT;var f=e/g;var b=e/g;var c=Math.min(parseInt(jQuery.cookie("sizeOneView")),parseInt($(".size_list li:last").attr("s")));var a=$("#album-content-body").width();var d=$("#album-content-body").height();a=Math.min(a,c);d=Math.min(d,c);if(c==96||c==144){a=c;d=c}else{if((Data.data.c&&Data.data.c.sizes&&Data.data.c.sizes[c])&&Data.data.c.sizes[c].w<a&&Data.data.c.sizes[c].h<d){a=Data.data.c.sizes[c].w;d=Data.data.c.sizes[c].h}else{if(Data.data.c.PL_WIDTH<a&&Data.data.c.PL_HEIGHT<d){a=Data.data.c.PL_WIDTH;d=Data.data.c.PL_HEIGHT}else{if(d-a/f>a-d*f){d=parseInt(a/f)}else{a=parseInt(f*d)}}}}if(!isNaN(parseInt(a))&&!isNaN(parseInt(d))){$(this.image).width(parseInt(a));$(this.image).height(parseInt(d));$(this.image).css({marginTop:$("#album-content-body").height()/2-d/2})}},render:function(b,f){if(f.data.r&&f.data.r.PL_ID!=undefined){WbsData.set({nextIdPhoto:f.data.r.PL_ID})}else{WbsData.set({nextIdPhoto:null})}if(f.data.l&&f.data.l.PL_ID!=undefined){WbsData.set({prevIdPhoto:f.data.l.PL_ID})}else{WbsData.set({prevIdPhoto:null})}this.contentElem=b;f=f.data;this.data=f.c;if(f.r){this.dataNext=f.r}if(f.l){this.dataPrev=f.l}ViewImageOn.originalW=this.data.PL_WIDTH;ViewImageOn.originalH=this.data.PL_HEIGHT;var d=this.data.PL_WIDTH/this.data.PL_HEIGHT;var a=createDiv("album-content-body");a.style.textAlign="center";var l=jQuery.cookie("sizeOneView");if(l){size1=l}else{size1=970;jQuery.cookie("sizeOneView",970)}size2=maxSizeByImg(Math.max(this.data.PL_WIDTH,this.data.PL_HEIGHT),[256,512,750,970]);l=Math.min(size1,size2);if(l>144){if(parseInt(this.data.PL_WIDTH)>parseInt(this.data.PL_HEIGHT)){this.data.PL_WIDTH=parseInt(l);if(this.data.sizes&&this.data.sizes[l]){this.data.PL_HEIGHT=this.data.sizes[l].h}else{this.data.PL_HEIGHT=parseInt(this.data.PL_WIDTH/d)}}else{this.data.PL_HEIGHT=parseInt(l);if(this.data.sizes&&this.data.sizes[l]){this.data.PL_WIDTH=this.data.sizes[l].w}else{this.data.PL_WIDTH=parseInt(this.data.PL_HEIGHT*d)}}}else{this.data.PL_WIDTH=l;this.data.PL_HEIGHT=l}var g="image.php?filename=";g+=this.data.PL_DISKFILENAME;g+="&albumId=";g+=this.data.PF_ID;g+="&size="+l+"&v="+this.data.PL_ROTATE;this.contentElem.appendChild(a);var c=$('<img class="image-one" />');this.image=c.get(0);$(a).append(c);if($.browser.mozilla){c.hide()}c.click(function(){Helper.getManager().setState({stateName:StateName.ImageTile,albumId:this.data.PF_ID,offset:e})}.bind(this));c.load(function(){this.resize();if($.browser.mozilla){c.show()}if(document.imageOneLoad){document.imageOneLoad()}}.bind(this));c.attr("src",g);if(!document.oldImageId){if(this.dataPrev){var h="image.php?filename=";h+=this.dataPrev.PL_DISKFILENAME;h+="&albumId=";h+=this.dataPrev.PF_ID;h+="&size="+l+"&v="+this.dataPrev.PL_ROTATE;new Image().src=h}if(this.dataNext){var j="image.php?filename=";j+=this.dataNext.PL_DISKFILENAME;j+="&albumId=";j+=this.dataNext.PF_ID;j+="&size="+l+"&v="+this.dataNext.PL_ROTATE;new Image().src=j}}else{if(this.dataNext&&this.dataNext.PL_ID==document.oldImageId){if(this.dataPrev){var h="image.php?filename=";h+=this.dataPrev.PL_DISKFILENAME;h+="&albumId=";h+=this.dataPrev.PF_ID;h+="&size="+l+"&v="+this.dataPrev.PL_ROTATE;new Image().src=h}}else{if(this.dataPrev&&this.dataPrev.PL_ID==document.oldImageId){if(this.dataNext){var j="image.php?filename=";j+=this.dataNext.PL_DISKFILENAME;j+="&albumId=";j+=this.dataNext.PF_ID;j+="&size="+l+"&v="+this.dataNext.PL_ROTATE;new Image().src=j}}}}document.oldImageId=this.data.PL_ID;var e=(Helper.getManager().getState().offset)?Helper.getManager().getState().offset:0}});function maxSizeByImg(a,c){var b=144;for(key in c){if(a>c[key]){b=c[key]}else{break}}return b}WaArrange=newClass(null,{constructor:function(a){this.listElements=a.listElements;this.updateUrl=a.updateUrl;this.makeFunction=a.makeFunction;this.cssClass=a.cssClass;document.isMoveSorted=false;$(".oldImage").removeClass("oldImage");for(var b=0;b<this.listElements.length;b++){if($.browser.msie){$("."+this.cssClass,this.listElements[b]).get(0).attachEvent("ondragstart",function(){window.event.cancelBubble=true;window.event.returnValue=false;document.arrangeAction=true})}$("."+this.cssClass,this.listElements[b]).get(0).isArrange=true;$("."+this.cssClass,this.listElements[b]).mousedown(function(c){this.elementMouseDownHandle(c)}.bind(this));$(this.listElements[b]).bind("mousemove",this.sorted);$(this.listElements[b]).find(".image-contener").attr("title","Click to select, drag'n'drop to sort")}$(document).mouseup(function(c){this.elementMouseUpHandle(c)}.bind(this))},elementSelect:function(b){var d=$(".selectCount");var e=(d.text().length>0)?d.text():0;var a=$("input",b);if(a.attr("checked")){a.attr("checked","");b.find(".image-contener").css({"background-color":"#7C7C7C"});var f=e-1;f=(f<1)?0:f;d.text(e-1)}else{a.attr("checked","checked");b.find(".image-contener").css({"background-color":"#d3a300"});d.text(parseInt(e)+1);d.show()}},elementMouseDownHandle:function(c){c=c||window.event;var b=c.target||c.srcElement;if(Helper.getManager().getState({}).stateName==StateName.Alubms){var d=$(b).parent().parent().parent()}else{var d=$(b).parent().parent()}d.attr("id","sel");var a=$("<div id='sorted'></div>");a.css("position","absolute");a.css("cursor","move");a.css("border","5px dashed yellow");a.css("z-index","100");if(!jQuery.browser.msie){a.css("width",d.width()-10);a.css("height",d.height()-10)}else{a.css("width",d.width());a.css("height",d.height())}d.prepend(a);this.isClick=true;document.isArrangeClick=true;document.arrangeAction=true;if(!$.browser.msie){c.originalEvent.preventDefault()}return false},elementMouseUpHandle:function(c){if(this.isClick){c=c||window.event;var b=b=c.target||c.srcElement;var d=$(b).parent();jQuery("#sorted").remove();jQuery("#sel").removeAttr("id");var a=new Array();jQuery(".album-list li").each(function(e,f){a.push(jQuery(f).attr("uid"))});if(document.isMoveSorted){jQuery.post(this.updateUrl,{data:a.toString(),albumId:Helper.getManager().getState({}).albumId,limit:Helper.getManager().getState({}).limit,offset:Helper.getManager().getState({}).offset},function(){document.isMoveSorted=false})}else{this.elementSelect(d)}if($.browser.msie){$(b).get(0).attachEvent("ondragstart",function(){window.event.cancelBubble=true;window.event.returnValue=false;document.arrangeAction=true})}this.isClick=false;document.isArrangeClick=false;return false}},sorted:function(f){f=f||window.e;if(document.isArrangeClick){if(jQuery(this).attr("id")!="sel"){var g=jQuery("#sel").clone(true);var d=jQuery(this);var b=jQuery(".album-list li").get();for(var a=0;a<b.length;a++){if(b[a]==jQuery("#sel").get(0)){var c=true;break}if(b[a]==this){var c=false;break}}jQuery("#sel").remove();if(c){jQuery(this).after(g);document.isMoveSorted=true}else{jQuery(this).before(g);document.isMoveSorted=true}}}if(!$.browser.msie){f.originalEvent.preventDefault()}}});WaPager=newClass(null,{constructor:function(a){this.contentElem=a.elem;this.data=a.data;this.manager=a.manager},render:function(c,b){this.data=b;removeChildNodes(this.contentElem);var f=createDiv("");var e=parseInt(b.offset)+1;var a=parseInt(b.offset)+Math.min(parseInt(b.limit),parseInt(b.total));if(!b.limit){e=1;a=b.total}if(a>b.total){a=b.total}if(b.total==0){if(Helper.getManager().getState().stateName==StateName.Alubms){f.innerHTML="<div class='page-button-div'>Create a new album to upload photos.</div>"}else{f.innerHTML="<div class='page-button-div'>There are no photos in this album.</div>"}}else{if(Helper.getManager().getState().stateName==StateName.Alubms){f.innerHTML="<div class='page-button-div'>"+$.sprintf("%d photos in %d album(s)",b.imageCount,b.total)+"</div>"}else{f.innerHTML="<div class='page-button-div'>Photos<span>"+e+"</span>&mdash;<span>"+a+"</span> of <span>"+b.total+"</span></div>"}}var d=createElem("a");this.contentElem.appendChild(f)}});Helper=function(){var a=null;return{setManager:function(b){a=b},getManager:function(){return a}}}();Data={};Semaphore=function(){var b=new Array();var a=false;return{init:function(){b=new Array()},addButton:function(c){b.push(c.children("span"))},startProccess:function(d){if(a){return false}for(var c in b){if(b[c]===d){continue}b[c].removeClass("active").addClass("desactive")}a=true;return true},stopProccess:function(d){a=false;for(var c in b){if(b[c]===d){continue}b[c].removeClass("desactive").addClass("active")}}}}();PDAlbum={};PDImage={};function removeChildNodes(a){while(a.childNodes[0]){a.removeChild(a.childNodes[0])}}(function(a){a.fn.viewModeSelector=function(b){var c=a('<div class="viewmode-select"><span>View:</span></div>');return this.each(function(){a(this).append(c);for(i in b){var e=b[i];var d=a('<div class="mode-elem" > </div>');d.append('<img src="'+e.ico+'">');c.append(d);d.clickw(function(){var f=a(this).children("img");var g=f.attr("src");g=g.replace(/\.gif/ig,"_on.gif");g=g.replace(/\.png/ig,"_on.png");f.attr("src",g)})}})}})(jQuery);(function(b){var a=b("<div>sss </div>");b.fn.moreWindow=function(d){var c=b.extend({},d);this.each(function(){var e=b(this);a.css({position:"absolute",left:e.offset().left,top:parseInt(e.offset().top)+e.width(),border:"1px soled red"})})}})(jQuery);(function(a){a.fn.clickw=function(b){this.each(function(){this.onclick=b})}})(jQuery);(function(a){a.extend(a.fn,{selectRange:function(d,b){if(a(this).get(0).createTextRange){var c=a(this).get(0).createTextRange();c.collapse(true);c.moveEnd("character",b);c.moveStart("character",d);c.select()}else{if(a(this).get(0).setSelectionRange){a(this).bind("focus",function(f){f.preventDefault()}).get(0).setSelectionRange(d,b)}}return a(this)},clickToSelect:function(){this.each(function(){a(this).click(function(){var b=a(this);b.selectRange(0,b.val().length)})})}})})(jQuery);function htmlspecialchars_(e){var d=Array("&","<",">",'"',"'");var c=Array("&amp;","&lt;","&gt;","&quot;","'");for(var a=0;a<d.length;a++){var b=new RegExp(d[a],"gi");if(b.test(e)){e=e.replace(b,c[a])}}return e}function htmlspecialchars_decode_(e){var d=Array("&amp;","&lt;","&gt;","&quot;","'");var c=Array("&","<",">",'"',"'");for(var a=0;a<d.length;a++){var b=new RegExp(d[a],"gi");if(b.test(e)){e=e.replace(b,c[a])}}return e}(function(d){var a={"%":function(e){return"%"},b:function(e){return parseInt(e,10).toString(2)},c:function(e){return String.fromCharCode(parseInt(e,10))},d:function(e){return parseInt(e,10)?parseInt(e,10):0},u:function(e){return Math.abs(e)},f:function(f,e){return(e>-1)?Math.round(parseFloat(f)*Math.pow(10,e))/Math.pow(10,e):parseFloat(f)},o:function(e){return parseInt(e,10).toString(8)},s:function(e){return e},x:function(e){return(""+parseInt(e,10).toString(16)).toLowerCase()},X:function(e){return(""+parseInt(e,10).toString(16)).toUpperCase()}};var c=/%(?:(\d+)?(?:\.(\d+))?|\(([^)]+)\))([%bcdufosxX])/g;var b=function(f){if(f.length==1&&typeof f[0]=="object"){f=f[0];return function(j,h,l,k,g,n,m){return a[g](f[k])}}else{var e=0;return function(j,h,l,k,g,n,m){return a[g](f[e++],l)}}};d.extend({sprintf:function(f){var e=Array.apply(null,arguments).slice(1);return f.replace(c,b(e))},vsprintf:function(f,e){return f.replace(c,b(e))}})})(jQuery);
