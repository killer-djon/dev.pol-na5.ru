<?assign var=dw value=2 ?>
<? assign var=firstMonth value=1 ?>

<? assign var=holiday_pic value="images/day_pic_holiday.gif"|stylesetitem:"classic":$styleSet:"PM" ?>
<? assign var=day_pic value="images/day_pic.gif"|stylesetitem:"classic":$styleSet:"PM" ?>
<? assign var=day_pic_actual value="images/day_pic_actual.gif"|stylesetitem:"classic":$styleSet:"PM" ?>
<? assign var=day_pic_planned value="images/day_pic_planned.gif"|stylesetitem:"classic":$styleSet:"PM" ?>
<? assign var=day_pic_overdue value="images/day_pic_overdue.gif"|stylesetitem:"classic":$styleSet:"PM" ?>
<? assign var=spacer10 value="images/spacer10.gif"|stylesetitem:"classic":$styleSet:"PM" ?>

<? assign var=day_pic_complete value="images/day_pic_complete.gif"|stylesetitem:"classic":$styleSet:"PM" ?>
<? assign var=day_pic_normal value=$day_pic ?>

<? assign var=day_pic_actual_complete value="images/day_pic_actual_complete.gif"|stylesetitem:"classic":$styleSet:"PM" ?>
<? assign var=day_pic_actual_normal value=$day_pic_actual ?>

<? assign var=day_pic_planned_complete value="images/day_pic_planned_complete.gif"|stylesetitem:"classic":$styleSet:"PM" ?>
<? assign var=day_pic_planned_normal value=$day_pic_planned ?>

<? assign var=day_pic_overdue_complete value="images/day_pic_overdue_complete.gif"|stylesetitem:"classic":$styleSet:"PM" ?>
<? assign var=day_pic_overdue_normal value=$day_pic_overdue ?>

<table cellspacing=0 cellpadding=0 border=0 class=ganttTable width="100%">
	<tr>
		<th class=ganttTable_header_rightBorder_text rowspan=3 align=left width=10><b><? $pmStrings.pm_id_title ?></b></th>
		<th class=ganttTable_header_rightBorder_text rowspan=3 align=left><b><? $pmStrings.pm_summary_title ?></b></th>
		<th class=ganttTable_header colspan="<? $ganttSettings.DAY_COUNT ?>" align=center>
			<table cellspacing=0 cellpadding=0 border=0 width="100%">
				<tr>
					<td align=center><b><nobr><? $ganttSettings.INTERVAL_TITLE?></nobr></b></td>
				</tr>
			</table>
		</th>
		<th class=ganttTable_header_leftBorder_text rowspan=3 align=center><b><? $pmStrings.pm_days_title ?></b></th>
	</tr>
	<tr>
		<? if !$ganttSettings.DISPLAY_DAYS ?>
			<? foreach from=$ganttSettings.MONTHS item=monthData ?>
				<? assign var=monthNum value=$monthData.key ?>
				<th <? if !$firstMonth ?>class=ganttTable_header_leftBorder<? else ?>class=ganttTable_header<? /if ?> colspan=<? $monthData.cnt ?> align=center><? $monthData.name ?></th>
				<? assign var=firstMonth value=0 ?>
			<? /foreach ?>
		<? else ?>
			<? assign var=firstDay value=1 ?>
			<? foreach from=$ganttSettings.DATE_INDEX item=dateData ?>
				<th 
					<? if !$firstDay && !$dateData.TOMORROW ?>
						class=ganttTable_leftBottomBorder
					<? else ?>
						class=ganttTable_bottomBorder
					<? /if ?>
				>
				<? $dateData.INDEX ?></th>
				<? assign var=firstDay value=0 ?>
			<? /foreach ?>
		<? /if ?>
	</tr>
	<tr>
		<? assign var=firstDay value=1 ?>
		<? foreach from=$ganttSettings.DATE_INDEX item=dateData ?>
			<th <? if !$firstDay &&  $dateData.INDEX == 1 ?>class=ganttTable_leftBottomBorder<? else ?>class=ganttTable_bottomBorder<? /if ?> align=center <? if $dateData.HOLIDAY ?>background="<? $holiday_pic ?>"<? else ?>background="<? $day_pic ?>"<? /if ?>
			><? if $dateData.HOLIDAY ?><img width="<? $dw ?>" height=5 src="<? $holiday_pic ?>"><? else ?><img width="<? $dw ?>" height=5 src="<? $day_pic ?>"><? /if ?></th>
			<? assign var=firstDay value=0 ?>
		<? /foreach ?>
	</tr>
	<? foreach from=$project_works item=work name=rowLoop ?>

		<? if !$work.COMPLETE?>
			<? assign var=day_pic value=$day_pic_normal ?>
			<? assign var=day_pic_actual value=$day_pic_actual_normal ?>
			<? assign var=day_pic_planned value=$day_pic_planned_normal ?>
			<? assign var=day_pic_overdue value=$day_pic_overdue_normal ?>
		<? else ?>
			<? assign var=day_pic value=$day_pic_normal ?>
			<? assign var=day_pic_actual value=$day_pic_actual_complete ?>
			<? assign var=day_pic_planned value=$day_pic_planned_normal ?>
			<? assign var=day_pic_overdue value=$day_pic_overdue_normal ?>
		<? /if ?>

		<? assign var=workSpan value=1 ?>
		<? if ($work.DUE_SPAN != "" && $work.DUE_SPAN > 0) || ($work.OVERDUE_SPAN != "" && $work.OVERDUE_SPAN > 0) ?>
			<? assign var=workSpan value=2 ?>
		<? /if ?>

		<? assign var=cell_style value="style='border-bottom: 1px solid #CCCCCC;'" ?>
		<? assign var=mid_cell_style value="" ?>

		<tr>
			<td valign=top rowspan=<? $workSpan ?> <? $cell_style ?> class=ganttTable_rightBorder_text><a href="<? $work.ROW_URL ?>"><? $work.PW_ID ?></a></td>			
			<td valign=top <? $cell_style ?> rowspan=<? $workSpan ?> <? if $ganttSettings.TODAY_INDEX || $ganttSettings.TODAY_INDEX == "" ?>class=ganttTable_rightBorder_text<? else ?>class=ganttTable_rightBorder_text_today<? /if ?>><a href="<? $work.ROW_URL ?>"><? $work.PW_DESC|htmlsafe:true:true ?></a></td>
			<? assign var=startOffset value = 0 ?>
			<? if $work.START_SPAN > 0 ?>
				<? assign var=src value=$day_pic ?>
				<? include file="../../../PM/html/classic/ganttrecord.htm" duration=$work.START_SPAN complete=$work.COMPLETE ?>

				<? math equation="x + y" x=$startOffset y=$work.START_SPAN assign=startOffset ?>
			<? /if ?>

			<? if $work.ACTUAL_SPAN > 0 ?>
				<? assign var=src value=$day_pic_actual ?>
				<? include file="../../../PM/html/classic/ganttrecord.htm" duration=$work.ACTUAL_SPAN ?>
				<? math equation="x + y" x=$startOffset y=$work.ACTUAL_SPAN assign=startOffset ?>
			<? /if ?>

			<? if $work.END_SPAN > 0 ?>
				<? assign var=src value=$day_pic ?>
				<? include file="../../../PM/html/classic/ganttrecord.htm" duration=$work.END_SPAN ?>
			<? /if ?>

			<td rowspan=<? $workSpan ?> <? $cell_style ?> class=ganttTable_leftBorder align=center>
				<? if $work.ACTUAL_LENGTH && !$work.DUMMY_DAY ?><? $work.ACTUAL_LENGTH ?><? else ?>1<? /if ?><? if ( $work.DUE_SPAN != "" && $work.DUE_SPAN > 0) || ($work.OVERDUE_SPAN != "" && $work.OVERDUE_SPAN > 0) ?><? "/"|cat:"<font color='#289E00'>"|cat:$work.ACTUAL_DUE|cat:"</font>" ?><? if $work.ACTUAL_OVERDUE > 0 ?><? "/<font color='#FF0000'>"|cat:$work.ACTUAL_OVERDUE|cat:"</font>" ?><? /if ?>
				<? /if ?>
			</td>
		</tr>
		<? if $smarty.foreach.rowLoop.iteration == $ganttSettings.ROW_COUNT ?>
			<? assign var=mid_cell_style value=$cell_style ?>
		<? /if ?>
		<? if ($work.DUE_SPAN != "" && $work.DUE_SPAN > 0) || ($work.OVERDUE_SPAN != "" && $work.OVERDUE_SPAN > 0) ?>
			<tr>
				<? assign var=startOffset value = 0 ?>

				<? assign var=endspan value = $ganttSettings.DAY_COUNT ?>
				<? if $work.START_SPAN > 0 ?>
					<? assign var=src value=$day_pic ?>
					<? include file="../../../PM/html/classic/ganttrecord.htm" duration=$work.START_SPAN ?>

					<? math equation="x + y" x=$startOffset y=$work.START_SPAN assign=startOffset ?>
					<? math equation="x - y" x=$endspan y=$work.START_SPAN assign=endspan ?>
				<? /if ?>

				<? if $work.DUE_SPAN != "" && $work.DUE_SPAN > 0 ?>
					<? assign var=src value=$day_pic_planned ?>
					<? include file="../../../PM/html/classic/ganttrecord.htm" duration=$work.DUE_SPAN ?>
					<? math equation="x + y" x=$startOffset y=$work.DUE_SPAN assign=startOffset ?>
					<? math equation="x - y" x=$endspan y=$work.DUE_SPAN assign=endspan ?>
				<? /if ?>

				<? assign var=src value=$day_pic_overdue ?>
				<? if $work.OVERDUE_SPAN > 0 ?>
					<? include file="../../../PM/html/classic/ganttrecord.htm" duration=$work.OVERDUE_SPAN ?>
					<? math equation="x + y" x=$startOffset y=$work.OVERDUE_SPAN assign=startOffset ?>
					<? math equation="x - y" x=$endspan y=$work.OVERDUE_SPAN assign=endspan ?>
				<? /if ?>

				<? if $endspan > 0 ?>
					<? assign var=src value=$day_pic ?>
					<? include file="../../../PM/html/classic/ganttrecord.htm" duration=$endspan ?>
				<? /if ?>
			</tr>
		<? /if ?>
	<? foreachelse ?>
		<tr>
			<? math equation="x + 3" x=$ganttSettings.DAY_COUNT assign=duration ?>
			<td colspan="<? $duration ?>" class=ganttTable_bottomBorder><center><? $kernelStrings.app_noentrieis_text|htmlsafe:true:true ?></center></td>
		</tr>
	<? /foreach ?>
	<? assign var=mid_cell_style value="" ?>
	<tr>
		<? assign var=startOffset value = -2 ?>
		<? math equation="x+1" x=$ganttSettings.DAY_COUNT assign=duration ?>
		<? assign var=src value=$spacer10 ?>
		<? include file="../../../PM/html/classic/gantttodayrecord.htm"?>
	</tr>
	<tr>
		<td style="border-top: none" class=ganttTable_header ><img src="<? $spacer10 ?>" width=10 height=1></td>
		<td style="border-top: none" class=ganttTable_header ><img src="<? $spacer10 ?>" width=300 height=1></td>
		<td style="border-top: none" class=ganttTable_header  colspan=<? $ganttSettings.DAY_COUNT ?>><img src="<? $spacer10 ?>" width=1 height=1></td>
		<td style="border-top: none" class=ganttTable_header ><img src="<? $spacer10 ?>" width=1 height=1></td>
	</tr>

</table>
