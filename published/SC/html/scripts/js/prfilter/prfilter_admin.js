/*Модуль дополнительные характеристики (расширенная) (версия 1)Разработано: © JOrange.ru*/var requestSent = false;	$(function() {		//hover style	$(document).on('mouseenter','.prfilter-category', function (event) { $(this).addClass("prfilter-category-hover");	}).on('mouseleave','.prfilter-category',  function(){ $(this).removeClass("prfilter-category-hover");	});	$(document).on('mouseenter','.prfilter-template-category', function (event) { $(this).addClass("prfilter-template-category-hover");	}).on('mouseleave','.prfilter-template-category',  function(){ $(this).removeClass("prfilter-template-category-hover");	});	$(document).on('mouseenter','.prfilter-template-category-groupless', function (event) { $(this).addClass("prfilter-template-category-groupless-hover");	}).on('mouseleave','.prfilter-template-category-groupless',  function(){ $(this).removeClass("prfilter-template-category-groupless-hover");	});	$(document).on('mouseenter','.prfilter-template-category-item', function (event) { $(this).addClass("prfilter-template-category-item-hover"); }).on('mouseleave','.prfilter-template-category-item',  function(){ $(this).removeClass("prfilter-template-category-item-hover");	});	$(document).on('mouseenter','.prfilter-params-list tr', function (event) { $(this).addClass("prfilter-params-tr-hover"); }).on('mouseleave','.prfilter-params-list tr',  function(){ $(this).removeClass("prfilter-params-tr-hover");	});			/* ==========================================================*	*                    CATEGORYES AND OPTIONS                  *	*============================================================*/		//Expand other languages	$('body').on('click', '.expand_languages', function(e) {		$(this).closest('.lang_fields').find('#'+$(this).attr('rel')).show();		$(this).hide();		e.preventDefault();	});			//Confirm notification	$('body').on('click', '.confirm_actionN', function(e) {		return window.confirm($(this).attr('title')); 	});		//Expand/collapse all categoryes	$('body').on('click', 'a.prfilter-category-toogle', function(e) {		$(this).toggleClass('shown');		if($(this).hasClass('shown')){			$(this).find('img').attr('src','images_common/minus.gif');			$('.prfilter-category .prfilter-category-list').show();			$('.prfilter-category .prfilter-category-title img').attr('src','images_common/minus.gif');			if($('.prfilter-categoryes, .prfilter-category').find('.prfilter-category-list').length>0){				$('.prfilter-categoryes, .prfilter-category').find('.prfilter-category-list').each(function(){				var categoryID = $(this).closest('.prfilter-category').attr('categoryID');				prfilter_setCookie('open_categoryID'+categoryID,'1');			})}					}else{			$(this).find('img').attr('src','images_common/plus.gif');			$('.prfilter-category .prfilter-category-list').hide();			$('.prfilter-category .prfilter-category-title img').attr('src','images_common/plus.gif');							if($('.prfilter-categoryes, .prfilter-category').find('.prfilter-category-list').length>0){				$('.prfilter-categoryes, .prfilter-category').find('.prfilter-category-list').each(function(){				var categoryID = $(this).closest('.prfilter-category').attr('categoryID');				prfilter_setCookie('open_categoryID'+categoryID,'0');			})}		}		e.preventDefault();	});	//Expand/collapse categoryes	$('body').on('click', 'a.prfilter-category-title', function(e) {		$(this).closest('.prfilter-category').find('.prfilter-category-list:first').toggle();		var categoryID = $(this).closest('.prfilter-category').attr('categoryID');		if($(this).closest('.prfilter-category').find('.prfilter-category-list:first').is(':visible')){ 			$(this).find('img').attr('src','images_common/minus.gif');			prfilter_setCookie('open_categoryID'+categoryID,'1');		}else{ 			$(this).find('img').attr('src','images_common/plus.gif');			prfilter_setCookie('open_categoryID'+categoryID,'0');		}			var count = $('#prfilter-categoryes, .prfilter-category').find('.prfilter-category-list').length;		var count_visible = $('#prfilter-categoryes, .prfilter-category').find('.prfilter-category-list:visible').length;		if(count==count_visible){			$('a.prfilter-category-toogle').removeClass('shown').addClass('shown').find('img').attr('src','images_common/minus.gif');		}else{			$('a.prfilter-category-toogle').removeClass('shown').find('img').attr('src','images_common/plus.gif');		}		e.preventDefault();	});		//Open additional field of options	$('body').on('click', 'a.prfilter-editoption-link', function(e) {		e.stopPropagation();		var div = $(this).parent().find('.prfilter-editoption:first');		var width = div.width();		var height = div.height();		var page = getPageSize();		var left = parseInt((page[2] - width)/2);if(left<0){left=0;}		var top = parseInt((page[3] - height)/2);if(top<10){top=10;}		div.css('top',top+'px').css('left',left+'px').show();		$('body').append('<div class="prfilter-editoption-overlay"></div>');		e.preventDefault();	});	//Close additional field of options	$('body').on('click', 'a.prfilter-editoption-close', function(e) {prfilter_ListsClosePopup(); e.preventDefault(); });	$(document).click(function(e) { prfilter_ListsClosePopup(); });	$(document).keyup(function(e) { if (e.keyCode == 27) { prfilter_ListsClosePopup(); } });	$(document).click(function(e) { prfilter_ListsClosePopup(); });	$('body').on('click', '.prfilter-editoption, .prfilter-editoption-link', function(e) { e.stopPropagation();	});		//Process of change category name	$('#prfilter-categoryes').on('click', '.prfilter-category-edit', function(e) {				var LinkEdit = $(this);		var CategoryName = LinkEdit.prev('.prfilter-category-title').find('span');		var CategoryImg = LinkEdit.prev('.prfilter-category-title').find('img');		var CategoryEmpty = LinkEdit.prev('.prfilter-category-title').find('i');		LinkEdit.hide();		CategoryName.hide();		CategoryImg.hide();			CategoryEmpty.hide();			LinkEdit.closest('.prfilter-category:first').addClass('prfilter-category-active');		LinkEdit.next('.prfilter-category-edit-input').show();		LinkEdit.next('.prfilter-category-edit-input').find('input:first').focus();		e.preventDefault();	});	//Save the category name	$('#prfilter-categoryes').on('click', 'input[name="save_categoryname"]', function(e) {		var LinkEdit = $(this).closest('.prfilter-category').find('.prfilter-category-edit');		var CategoryName = LinkEdit.prev('.prfilter-category-title').find('span');		var CategoryImg = LinkEdit.prev('.prfilter-category-title').find('img');				var CategoryEmpty = LinkEdit.prev('.prfilter-category-title').find('i');				var InputRu = $(this).closest('.prfilter-category-edit-input').find('input[lang="ru"]:first');		if(InputRu.length != 0 && $.trim(InputRu.val())!=''){			var CategoryNameText = InputRu.val();		}else{			var CategoryNameText = $(this).closest('.prfilter-category-edit-input').find('input[lang!="ru"]:first').val();		}		var notEmpty=0;		$(this).closest('.prfilter-category-edit-input').find('input[type="text"]').each(function(){			if($.trim($(this).val())!='') notEmpty++;		});		$(this).closest('.prfilter-category-edit-input').hide();		$(this).closest('.prfilter-category:first').removeClass('prfilter-category-active');		LinkEdit.removeAttr('style');		CategoryName.show();		CategoryImg.show();		CategoryEmpty.show();		if(notEmpty!=''){ 			CategoryName.html(CategoryNameText);			var formValues = $(this).closest('.prfilter-category-edit-input').find('*').serialize();			if(!requestSent) {			requestSent = true;			$.ajax({     				url: set_query('?ukey=prfilter_admin'),				data: "action=save_options_categoryes&"+formValues,				type: "POST",				dataType : "json",				success: function(returnData){ 						$('.prfilter-categoryes-select').each(function(){						var Select = $(this);						var SelectValue = $(this).val();						var toSelect = '<option value="0">---</option>';						$.each( returnData.categoryes, function( key, category ) {							toSelect+= '<option value="'+category.categoryID+'">'+category.category_name+'</option>'						});						Select.html(toSelect).val(SelectValue);					});				},				complete: function() {					requestSent = false;				}			});				}		}				}); 		//Undo changes to the category name	$('#prfilter-categoryes').on('click', 'input[name="cancel_categoryname"]', function(e) {		var LinkEdit = $(this).closest('.prfilter-category').find('.prfilter-category-edit');		var CategoryName = LinkEdit.prev('.prfilter-category-title').find('span');		var CategoryImg = LinkEdit.prev('.prfilter-category-title').find('img');		var CategoryEmpty = LinkEdit.prev('.prfilter-category-title').find('i');			$(this).closest('.prfilter-category-edit-input').hide();		$(this).closest('.prfilter-category:first').removeClass('prfilter-category-active');		LinkEdit.removeAttr('style');		CategoryName.show();		CategoryImg.show();		CategoryEmpty.show();	}); 			//Process of add category	$('body').on('click', '.prfilter-category-add', function(e) {		var NewCategoryDiv = $(this).parent().find('.prfilter-category-new:first').clone(true).show().appendTo('#prfilter-categoryes-new');			var LinkEdit = NewCategoryDiv.find('.prfilter-category-edit');		var CategoryName = LinkEdit.prev('.prfilter-category-title').find('span');		var CategoryImg = LinkEdit.prev('.prfilter-category-title').find('img');		var CategoryEmpty = LinkEdit.prev('.prfilter-category-title').find('i');				var random = Math.floor(Math.random()*1000);		NewCategoryDiv.find('.prfilter-category-edit-input table tbody td div').attr('id','category_name_ru_'+random);		NewCategoryDiv.find('.prfilter-category-edit-input .expand_languages').attr('rel','category_name_ru_'+random);				LinkEdit.hide();		CategoryName.hide();		CategoryImg.hide();			CategoryEmpty.hide();			LinkEdit.closest('.prfilter-category:first').addClass('prfilter-category-active');		LinkEdit.next('.prfilter-category-edit-input').show();		LinkEdit.next('.prfilter-category-edit-input').find('input:first').focus();		e.preventDefault();	}); 	//Save the new category	$('#prfilter-categoryes-new').on('click', 'input[name="save_categoryname"]', function(e) {		var SaveButton = $(this);		var formValues = SaveButton.closest('.prfilter-category-edit-input').find('*').serialize();		var notEmpty=0;		SaveButton.closest('.prfilter-category-edit-input').find('input[type="text"]').each(function(){if($.trim($(this).val())!='') notEmpty++;});		if(notEmpty){			if(!requestSent) {			requestSent = true;			$.ajax({   				url: set_query('?ukey=prfilter_admin'),				data: "action=save_options_categoryes&"+formValues,				type: "POST",				dataType : "json",				success: function(returnData){ 						var LinkEdit = SaveButton.closest('.prfilter-category').find('.prfilter-category-edit');					var CategoryName = LinkEdit.prev('.prfilter-category-title').find('span');					var CategoryImg = LinkEdit.prev('.prfilter-category-title').find('img');					var CategoryEmpty = LinkEdit.prev('.prfilter-category-title').find('i');					var InputRu = SaveButton.closest('.prfilter-category-edit-input').find('input[lang="ru"]:first');								if(InputRu.length != 0 && $.trim(InputRu.val())!=''){						CategoryName.html(InputRu.val());					}else{						CategoryName.html(SaveButton.closest('.prfilter-category-edit-input').find('input[lang!="ru"]:first').val());					}						SaveButton.closest('.prfilter-category-edit-input').find('input[type="text"]').each(function(){						var currentName = 'category_name_'+$(this).attr('lang')+'_'+returnData.categoryID;						$(this).attr('name',currentName);					});						SaveButton.closest('.prfilter-category').prepend('<a href="'+set_query('&action=delete_option_categoryes&categoryID='+returnData.categoryID)+'" class="confirm_actionN prfilter-category-remove" title="'+translate.cnfrm_areyousure+'"><img src="images_common/remove.gif" alt="'+translate.btn_delete+'" /></a>');					SaveButton.closest('.prfilter-category-edit-input').hide();					SaveButton.closest('.prfilter-category:first').removeClass('prfilter-category-active');					LinkEdit.removeAttr('style');					CategoryName.show();					CategoryImg.show();					CategoryEmpty.show();					SaveButton.closest('.prfilter-category').attr('categoryID',returnData.categoryID);					SaveButton.closest('.prfilter-category').appendTo('#prfilter-categoryes');										$('.prfilter-categoryes-select').each(function(){						var Select = $(this);						var SelectValue = $(this).val();						var toSelect = '<option value="0">---</option>';						$.each( returnData.categoryes, function( key, category ) {							toSelect+= '<option value="'+category.categoryID+'">'+category.category_name+'</option>'						});						Select.html(toSelect).val(SelectValue);					});										$('#prfilter-categoryes').sortable({						axis:'y',						placeholder: "prfilter-highlight-category",						items: "> div.prfilter-category",						stop: function(event, ui) {							var category_sort = "";							$("#prfilter-categoryes .prfilter-category").each(function(i, el){								var categoryID = $(el).attr('categoryID');								category_sort += '&category_sort_'+categoryID+"="+$(el).index();							});							if(!requestSent) {							requestSent = true;							$.ajax({    								url: set_query('?ukey=prfilter_admin'),								data: "action=save_options_categoryes_sort"+category_sort,								type: "POST",								dataType : "json",								success: function(data){ 											if(data){										var msgEntry = new Message();										msgEntry.init(data);										if(msgEntry.isSuccess()){											msgEntry.showMessage();													return;										}									}								},								complete: function() {									requestSent = false;								}							});							}						}					})									},				complete: function() {					requestSent = false;				}			});				}		}		e.preventDefault();	});	//Undo add category	$('#prfilter-categoryes-new').on('click', 'input[name="cancel_categoryname"]', function(e) {		$(this).closest('.prfilter-category-new').remove();		e.preventDefault();	}); 	 	 	//Change option type	$('body').on('change', 'select.optionType', function(e) {		var current = $(this).val();		var optID = $(this).attr('optID');		switch (current) {		  case '0':			$('#'+optID+'_slider_step_tr, #'+optID+'_slider_prefix_tr').hide();			break		  case 'slider':			$('#'+optID+'_slider_step_tr, #'+optID+'_slider_prefix_tr').show();			break		  case 'single':			$('#'+optID+'_slider_step_tr, #'+optID+'_slider_prefix_tr').hide();			break		  default:			$('#'+optID+'_slider_step_tr, #'+optID+'_slider_prefix_tr').hide();		}	});		//Verify the change in the form	$('.prfilter-category-list td.name, .prfilter-category-list td.sort, .prfilter-params-list td.name, .prfilter-params-list td.sort').on('change keyup', 'input[type="text"]', function(e) {		var TD = $(this).closest('td.name, td.sort');		var Clear = TD.attr('clear');		var NewValues = $.base64Encode(TD.find('*').serialize());		if(Clear != NewValues){			TD.find('input[type="text"]').addClass('notsavedinput');		}else{			TD.find('input[type="text"]').removeClass('notsavedinput');		}	});			//Checking the checkboxes on "excluded" page	$('.prfilter-excluded-item').on('change', 'input:checkbox', function(e) {		var allcheckbox = $(this).closest('.prfilter-excluded-item').find('input[name!="checkall"]:checkbox').length;		var allcheckbox_checked = $(this).closest('.prfilter-excluded-item').find('input[name!="checkall"]:checkbox:checked').length;		var firstcheckbox = $(this).closest('.prfilter-excluded-item').find('input:checkbox:first');				if($(this).attr('name')!='checkall'){			if(allcheckbox == allcheckbox_checked){ firstcheckbox.prop('checked', true); }else{ firstcheckbox.removeAttr('checked'); }		}else{			var checked = $(this).prop('checked');			$(this).closest('.prfilter-excluded-item').find('input:checkbox').each(function(){				if(checked){ $(this).prop('checked', true); }else{ $(this).removeAttr('checked'); }			});		}		e.preventDefault();	});		//Expand/collapse excluded params	$('body').on('click', 'a.prfilter-excluded-title', function(e) {		$(this).closest('tr').next('tr').find('td.prfilter-excluded-item:first').toggle();		if($(this).closest('tr').next('tr').find('td.prfilter-excluded-item:first').is(':visible')){ 			$(this).find('img').attr('src','images_common/minus.gif');		}else{ 			$(this).find('img').attr('src','images_common/plus.gif');		}			e.preventDefault();	});			/* ==========================================================*	*                         TEMPLATES                          *	*============================================================*/		//Submit form	$('.prfilter-template').on("submit", "form.prfilter-template-form", function(e){			$(this).find('input[modifyname="yep"], select[modifyname="yep"]').each(function(){			var categoryID = $(this).closest('.prfilter-template-category').attr('categoryID'),			xname = $(this).attr('xname');			$(this).attr('name','template['+categoryID+'][options]'+xname);		});		return true;	});	//Group "UNUSED"	$('.prfilter-template').on('change', '.prfilter-template-notuse-group', function(e) {			prfilter_TemplateGroupNotUse($(this).is(':checked'));		prfilter_TemplateEmptyMessages();		e.preventDefault();	});			//Group "USED"	$('.prfilter-template').on('change', '.prfilter-template-inuse-group', function(e) {		prfilter_TemplateGroupUse($(this).is(':checked'));		prfilter_TemplateSortTemplate();		prfilter_TemplateEmptyMessages();		e.preventDefault();	});	//Move to "UNUSED"	$('.prfilter-templates-inuse').on('click', 'a.prfilter-templates-restore', function(e) {		var optionItem = $(this).closest('.prfilter-template-category-item');		prfilter_TemplateMoveItemToNotUse(optionItem);		e.preventDefault();	});		//Move to "USED"	$('.prfilter-templates-notuse').on('click', 'a.prfilter-templates-restore', function(e) {		var optionItem = $(this).closest('.prfilter-template-category-item');		prfilter_TemplateMoveItemToUse(optionItem, false);		e.preventDefault();	});				//Add new category	$('.prfilter-template').on('click', '.prfilter-template-addcategory-button a', function(e) {					var NUnewCategory = $('.prfilter-templates-inuse').find('.prfilter-template-newcategory')		if(NUnewCategory.length==0){			var categoryID 	= (NUnewCategory.length*1+1)*-1		}else{			var categoryID 	= 0;			NUnewCategory.each(function(){				if($(this).attr('categoryID')*1 < categoryID){					categoryID = $(this).attr('categoryID')*1-1;				}			});		}		prfilter_TemplateAddCategory(categoryID, true);		prfilter_TemplateSortTemplate();		prfilter_TemplateEmptyMessages();			e.preventDefault();	});			//Remove category	$('.prfilter-templates-inuse').on('click', 'a.prfilter-template-category-remove', function(e) {				if($(this).closest('.prfilter-template-category').find('.prfilter-template-category-item').length==0){			$(this).closest('.prfilter-template-category').remove();		}		prfilter_TemplateEmptyMessages();		e.preventDefault();	});			//Checking the checkboxes	$('.prfilter-template-category-item table').on('change', 'input[type="checkbox"]', function(e) {		var allcheckbox = $(this).closest('.prfilter-template-category-item').find('input[name!="checkall"]:checkbox').length;		var allcheckbox_checked = $(this).closest('.prfilter-template-category-item').find('input[name!="checkall"]:checkbox:checked').length;		var firstcheckbox = $(this).closest('.prfilter-template-category-item').find('input[name="checkall"]:checkbox:first');			if($(this).attr('name')!='checkall'){			if(allcheckbox == allcheckbox_checked){ firstcheckbox.prop('checked', true); }else{ firstcheckbox.removeAttr('checked'); }		}else{			var checked = $(this).prop('checked');			$(this).closest('.prfilter-template-category-item').find('input:checkbox').each(function(){				if(checked){ $(this).prop('checked', true); }else{ $(this).removeAttr('checked'); }			});		}		e.preventDefault();	});	//Expand/collapse categoryes	$('.prfilter-template').on('click', 'a.prfilter-template-category-title', function(e) {		$(this).closest('.prfilter-template-category').find('.prfilter-template-category-items-all:first').toggle();		if($(this).closest('.prfilter-template-category').find('.prfilter-template-category-items-all:first').is(':visible')){ 			$(this).find('img').attr('src','images_common/minus.gif');		}else{ 			$(this).find('img').attr('src','images_common/plus.gif');		}			e.preventDefault();	});	//Expand/collapse options	$('.prfilter-template').on('click', '.prfilter-template-category-item-title-link', function(e) {		var parent = $(this).closest('.prfilter-template-category-item'),		table = parent.find('table:first');		table.toggle();		var linkrestore = parent.find('.prfilter-templates-restore'),		parent_height = parent.height();		if(table.is(':visible')){ 			$(this).find('img').attr('src','images_common/minus.gif');			linkrestore.css('height',parent_height+'px');		}else{ 			$(this).find('img').attr('src','images_common/plus.gif');			linkrestore.removeAttr('style');		}			e.preventDefault();	});			//Expand/collapse the advanced options	$('.prfilter-template').on('click', '.prfilter-templates-paramentr-additionally-link', function(e) {		var table = $(this).closest('td').find('table:first');		table.toggle();		var parent = $(this).closest('.prfilter-template-category-item'),		linkrestore = parent.find('.prfilter-templates-restore'),		parent_height = parent.height();			linkrestore.css('height',parent_height-0+'px');		e.preventDefault();	});			//Select categories window	$('.prfilter-template').on('click', '.add-appended-parent-handler', function(e) {		categoryTreeManager.show_tree('add_appendedcategory');		e.preventDefault();	});		//Select all categories	$('.prfilter-template').on('click', '.add-all-categoryes-handler', function(e) {		categoryTreeManager.addAllCategoryes();		e.preventDefault();	});		//Remove category	$('.prfilter-template').on('click', '.remove_appendedcategory_handler', function(e) {		var catBlock = getLayer("appended-category-"+this.getAttribute('categoryID'));		catBlock.parentNode.removeChild(catBlock);		prfilter_TemplateCountCategories();		e.preventDefault();	});		//Remove all categories	$('.prfilter-template').on('click', '.remove-all-categoryes-handler', function(e) {		$('#appendedcategories-block').html('');		prfilter_TemplateCountCategories();		e.preventDefault();	});		//Toogle all categories	$('.prfilter-template').on('click', '.prfilter-template-showall-categoryes a', function(e) {		if($(this).hasClass('shown')){			$(this).html(translate.showallcategoryies).removeClass('shown');			prfilter_TemplateCountCategories();		}else{			$(this).html(translate.hideallcategoryies).addClass('shown');			$('#appendedcategories-block div').show();		}		e.preventDefault();	});					//Change category name ICON	$('.prfilter-template').on('click', '.prfilter-template-category-edit', function(e) {		var editButton = $(this),		parentCategory = editButton.closest('.prfilter-template-category'),		categoryNameFields = parentCategory.find('.prfilter-template-categoryname');			editButton.hide();		editButton.prev('.prfilter-template-category-title').find('span').hide();		editButton.prev('.prfilter-template-category-title').find('img').hide();		parentCategory.find('.prfilter-template-category-additionally').hide();				parentCategory.find('.prfilter-template-category-remove').hide();				parentCategory.addClass('prfilter-template-category-changename');					categoryNameFields.fadeIn();		e.preventDefault();	});			//Change category name CANCEL	$('.prfilter-template').on('click', '.prfilter-template-categoryname input[name="cancel_categoryname"]', function(e) {			var parentCategory = $(this).closest('.prfilter-template-category');		prfilter_TemplateCancelEdit(parentCategory);		e.preventDefault();	});		//Change category name SAVE	$('.prfilter-template').on('click', '.prfilter-template-categoryname input[name="save_categoryname"]', function(e) {		var parentCategory = $(this).closest('.prfilter-template-category'),		categoryName = parentCategory.find('.prfilter-template-category-title').find('span'),		categoryNameFields = $(this).closest('.prfilter-template-categoryname');						var nameRuField = categoryNameFields.find('input[lang="ru"]:first');					if(nameRuField.length != 0 && $.trim(nameRuField.val())!=''){			categoryName.html(nameRuField.val());		}else{			categoryName.html(categoryNameFields.find('input[lang!="ru"]:first').val());		}			categoryNameFields.hide();		parentCategory.removeClass('prfilter-template-category-changename');		parentCategory.find('.prfilter-template-category-edit').fadeIn();		parentCategory.find('.prfilter-template-category-additionally').fadeIn();				categoryName.fadeIn();		parentCategory.find('.prfilter-template-category-title').find('img').fadeIn();		prfilter_TemplateRemoveCategoryIcon(parentCategory);		var inputs = categoryNameFields.find('input[type="text"]');		$(inputs).each(function(i) {			$(this).attr('xvalue',$(this).val());		});						e.preventDefault();	});	});$(document).ready(function() {		//Additional settings to turn off unused features	prfilter_TemplateSetAdditionallyVisible('type');	$(this).on('change', 'select[additionally="type"]', function(e) {			prfilter_TemplateSetAdditionallyVisible('type');		e.preventDefault();	});		prfilter_TemplateSetAdditionallyVisible('images');	$(this).on('change', 'select[additionally="images"]', function(e) {			prfilter_TemplateSetAdditionallyVisible('images');		e.preventDefault();	});				prfilter_TemplateLoad();	prfilter_ListsPrepare();	prfilter_TemplatePrepare();});	function prfilter_ListsPrepare(){		//Assign additional parameters to change		if($('.prfilter-category-list td').length>0){			$('.prfilter-category-list td.options').each(function(){				$(this).attr('clear',$.base64Encode($(this).find('*').serialize()));			});			$('.prfilter-category-list td.name').each(function(){				$(this).attr('clear',$.base64Encode($(this).find('*').serialize()));			});			$('.prfilter-category-list td.sort').each(function(){				$(this).attr('clear',$.base64Encode($(this).find('*').serialize()));			});		}		//Assign additional parameters to change		if($('.prfilter-params-list td').length>0){			$('.prfilter-params-list td.options').each(function(){				$(this).attr('clear',$.base64Encode($(this).find('*').serialize()));			});			$('.prfilter-params-list td.name').each(function(){				$(this).attr('clear',$.base64Encode($(this).find('*').serialize()));			});			$('.prfilter-params-list td.sort').each(function(){				$(this).attr('clear',$.base64Encode($(this).find('*').serialize()));			});		}					//Sort categories		if($('#prfilter-categoryes .prfilter-category').length>0){			$('#prfilter-categoryes').sortable({				axis:'y',				placeholder: "prfilter-highlight-category",				items: "> div.prfilter-category",				stop: function(event, ui) {					var category_sort = "";					$("#prfilter-categoryes .prfilter-category").each(function(i, el){						var categoryID = $(el).attr('categoryID');						category_sort += '&category_sort_'+categoryID+"="+$(el).index();					});					if(!requestSent) {					requestSent = true;					$.ajax({    						url: set_query('?ukey=prfilter_admin'),						data: "action=save_options_categoryes_sort"+category_sort,						type: "POST",						dataType : "json",						success: function(data){ 									if(data){								var msgEntry = new Message();								msgEntry.init(data);								if(msgEntry.isSuccess()){									msgEntry.showMessage();											return;								}							}						},						complete: function() {							requestSent = false;						}					});					}				}			})		}					//Uncover previously open category		if($('.prfilter-categoryes, .prfilter-category').find('.prfilter-category-list').length>0){			$('.prfilter-categoryes, .prfilter-category').find('.prfilter-category-list').each(function(){				var categoryID = $(this).closest('.prfilter-category').attr('categoryID');				var shown = prfilter_getCookie('open_categoryID'+categoryID);					if(shown=='1'){					$(this).show();					$(this).closest('.prfilter-category').find('a.prfilter-category-title').find('img').attr('src','images_common/minus.gif');				}				var count = $('#prfilter-categoryes, .prfilter-category').find('.prfilter-category-list').length;				var count_visible = $('#prfilter-categoryes, .prfilter-category').find('.prfilter-category-list:visible').length;				if(count==count_visible){					$('a.prfilter-category-toogle').removeClass('shown').addClass('shown').find('img').attr('src','images_common/minus.gif');				}else{					$('a.prfilter-category-toogle').removeClass('shown').find('img').attr('src','images_common/plus.gif');				} 			})		}	}		function prfilter_ListsClosePopup(){		$('.prfilter-editoption, .prfilter-editoption-values').hide();		$('.prfilter-editoption-overlay').remove();		//Check Changes in form		if($('.prfilter-category-list td.options').length>0){			$('.prfilter-category-list td.options').each(function(){				var Clear = $(this).attr('clear');				var NewValues = $.base64Encode($(this).find('*').serialize());				$(this).find('.prfilter-editoption-link').next('span:first').remove();				if(Clear != NewValues){					$('<span>*</span>').insertAfter($(this).find('.prfilter-editoption-link'));				}			});		}		if($('.prfilter-params-list td.options').length>0){			$('.prfilter-params-list td.options').each(function(){				var Fileinput_exist = $(this).find('input[type="file"]').val();				var Clear = $(this).attr('clear');				var NewValues = $.base64Encode($(this).find('*').serialize());				$(this).find('.prfilter-editoption-link').next('span:first').remove();				if(Clear != NewValues||Fileinput_exist){					$('<span>*</span>').insertAfter($(this).find('.prfilter-editoption-link'));				}			});		}	}		function prfilter_TemplateLoad(){		if(template_load!=false && template_load!=undefined){			var obj = $.parseJSON(template_load);			if (typeof obj.template !== 'undefined') {				$.each( obj.template, function( key, category  ) {								//add category					prfilter_TemplateAddCategory(category.categoryID, false);					$.each( category, function( key, value  ) {												//category name						var currentCategoryDiv = $('.prfilter-templates-inuse').find('.prfilter-template-category[categoryID="'+category.categoryID+'"]'),						categoryName = currentCategoryDiv.find('.prfilter-template-category-title').find('span');							currentCategoryDiv.find('input[name="template['+category.categoryID+']['+key+']"]').val(value);						currentCategoryDiv.find('input[name="template['+category.categoryID+']['+key+']"]').attr('xvalue',value);							var nameRuField = currentCategoryDiv.find('input[lang="ru"]:first');									if(nameRuField.length != 0 && $.trim(nameRuField.val())!=''){							categoryName.html(nameRuField.val());						}else{							categoryName.html(currentCategoryDiv.find('input[lang!="ru"]:first').val());						}						//additionally						if(category.visibility) currentCategoryDiv.find('.prfilter-template-category-additionally').find('select').val(category.visibility);					});				});								$.each( obj.template, function( key, category  ) {						//items					$.each( category.options, function( key, option  ) {						var optionItem = $('.prfilter-templates-notuse').find('.prfilter-template-category-item[optionID="'+option.optionID+'"]');						//additionally						$.each( option, function( param, value  ) {							if(optionItem.find('select[xname="['+option.optionID+']['+param+']"]').length>0) optionItem.find('select[xname="['+option.optionID+']['+param+']"]').val(value);						});						//variants						if(typeof option.variants == 'object'){							$.each(option.variants, function( key, variantID  ) {								var variant = optionItem.find('input[variantID="'+variantID+'"]');								variant.prop('checked', true);							});						}else if(typeof option.variants == 'string'){							var variant = optionItem.find('input[variantID="'+option.variants+'"]');							variant.prop('checked', true);						}						var allcheckbox = optionItem.find('input[name!="checkall"]:checkbox').length;						var allcheckbox_checked = optionItem.find('input[name!="checkall"]:checkbox:checked').length;						var firstcheckbox = optionItem.find('input[name="checkall"]:checkbox:first');								if(allcheckbox == allcheckbox_checked){ firstcheckbox.prop('checked', true); }						//move items						prfilter_TemplateMoveItemToUse(optionItem, category.categoryID);					});										});				$('.prfilter-template').find('.prfilter-template-inuse-group').prop('checked', obj.groupbycategory);				prfilter_TemplateGroupUse(obj.groupbycategory);				prfilter_TemplateSetAdditionallyVisible('type');				prfilter_TemplateSetAdditionallyVisible('images');				prfilter_TemplateSortTemplate();				prfilter_TemplateEmptyMessages();			}			prfilter_TemplateCountCategories(); 		}	}				function prfilter_TemplatePrepare(){		if($('input[name="slidecategoryes"]').is(':checked')){			$('.prfilter-template-category-additionally').find('select').attr('disabled',true);		}else{			$('.prfilter-template-category-additionally').find('select').attr('disabled',false);		}		$('.prfilter-template').on('change', 'input[name="slidecategoryes"]', function(e) {			if($(this).is(':checked')){				$('.prfilter-template-category-additionally').find('select').attr('disabled',true);			}else{				$('.prfilter-template-category-additionally').find('select').attr('disabled',false);			}			e.preventDefault();		});			if($('input[name="slideoptions"]').is(':checked')){			$('select[additionally="visibility"]').attr('disabled',true);		}else{			$('select[additionally="visibility"]').attr('disabled',false);		}			$('.prfilter-template').on('change', 'input[name="slideoptions"]', function(e) {			if($(this).is(':checked')){				$('select[additionally="visibility"]').attr('disabled',true);			}else{				$('select[additionally="visibility"]').attr('disabled',false);			}			e.preventDefault();		});	}		function prfilter_TemplateAddCategory(categoryID, top){		var UGroup = $('.prfilter-template').find('.prfilter-template-inuse-group'),		Uparent = $('.prfilter-templates-inuse'),		Ucategory 	= $('.prfilter-templates-inuse').find('.prfilter-template-category[categoryID="'+categoryID+'"]');		if(parseFloat(categoryID)<0){			//new category			var NUcategory = $('.prfilter-templates-notuse').find('.prfilter-template-newcategory');		}else{			//exist category			var NUcategory = $('.prfilter-templates-notuse').find('.prfilter-template-category[categoryID="'+categoryID+'"]');		}		if(Ucategory.length == 0){				var iconEdit 		= '<a href="javascript:void(0);" class="prfilter-icon prfilter-icon-edit prfilter-template-category-edit" title="'+translate.editname+'"></a>',				iconRemove		= '<a href="javascript:void(0);" class="prfilter-template-category-remove" title="'+translate.btn_delete+'"><img src="images/remove.gif" border="0" hspace="6" alt="'+translate.btn_delete+'" /></a>',				selectVisible	= '<div class="prfilter-template-category-additionally">'+translate.visibledefault+': <select name="template['+categoryID+'][visibility]"><option value="true" >'+translate.expand+'</option><option value="false" >'+translate.collapse+'</option></select></div>',				categoryName 	= NUcategory.find('.prfilter-template-category-title').find('span').html();			var classNewCategory= (parseFloat(categoryID)<0)?'prfilter-template-newcategory':'';				categoryEditDiv = NUcategory.find('.prfilter-template-categoryname');			var inputs = categoryEditDiv.find('input[type="text"]');			$(inputs).each(function(i) { $(this).attr('xvalue',$(this).val()); });				var newCategory = $('<div class="prfilter-template-category '+ classNewCategory +'" categoryID="' + categoryID + '">' + iconRemove + selectVisible + '<a href="javascript:void(0);" class="prfilter-template-category-title"><img src="images_common/minus.gif" border="0"><span>' + categoryName + '</span></a> ' + iconEdit + ' <div class="prfilter-template-category-items-all">');			if(top){ newCategory.prependTo(Uparent); }else{ newCategory.appendTo(Uparent); }			categoryEditDiv.clone(true).prependTo(newCategory);							if(!UGroup.is(':checked')){				newCategory.addClass('prfilter-template-category-groupless');				newCategory.find('.prfilter-template-category-title').hide();				newCategory.find('.prfilter-template-category-items-all').addClass('prfilter-template-category-items-all-groupless');			}							if(parseFloat(categoryID)<0){				//for new category replace %catetoryID% by categoryID				newCategoryEditDiv = newCategory.find('.prfilter-template-categoryname');				var inputs = newCategoryEditDiv.find('input[type="text"]');				$(inputs).each(function(i) { 					if($(this).length!=0){						$(this).attr('name',$(this).attr('name').replace('%categoryID%',categoryID));					}				});						if(newCategoryEditDiv.find('.expand_languages').length!=0){					newCategoryEditDiv.find('.expand_languages').attr('rel',newCategoryEditDiv.find('.expand_languages').attr('rel').replace('%categoryID%',categoryID));				}				newCategoryEditDiv.find('div').each(function(i) {					if($(this).length!=0){						$(this).attr('id',$(this).attr('id').replace('%categoryID%',categoryID));					}				});					//active group by category if new category				UGroup.prop('checked', true);				prfilter_TemplateGroupUse(true);			}		}			return true;	}		function prfilter_TemplateMoveItemToUse(optionItem, LcategoryID){		var NUcategoryDiv = optionItem.closest('.prfilter-template-category'),		NUcategoryID = NUcategoryDiv.attr('categoryID');		UGroup = $('.prfilter-template').find('.prfilter-template-inuse-group');						//if load template				if(LcategoryID!==false){			var UcategoryDiv = $('.prfilter-templates-inuse').find('.prfilter-template-category[categoryID="'+LcategoryID+'"]'),			appendTo = '.prfilter-templates-inuse .prfilter-template-category[categoryID="'+LcategoryID+'"] .prfilter-template-category-items-all';			}else{			var UcategoryDiv = $('.prfilter-templates-inuse').find('.prfilter-template-category[categoryID="'+NUcategoryID+'"]');			//add category			prfilter_TemplateAddCategory(NUcategoryID, false);				if(UGroup.is(':checked')){				var appendTo = '.prfilter-templates-inuse .prfilter-template-category[categoryID="'+NUcategoryID+'"] .prfilter-template-category-items-all';					}else{				var appendTo = '.prfilter-templates-inuse .prfilter-template-category:last .prfilter-template-category-items-all';			}			}		//clone item		newItem = optionItem.clone(true).fadeIn(500).appendTo(appendTo);		if($(appendTo).find(newItem).length > 0){				//fix: Set all selects			var selects = optionItem.find("select");			$(selects).each(function(i) { 				var select = this;				newItem.find("select").eq(i).val($(select).val()); 			});			//remove NU item			optionItem.remove();			//hide NU category if item count null			if (NUcategoryDiv.find('.prfilter-template-category-item').length == 0)	NUcategoryDiv.hide();			//style move icon			newItem.find('.prfilter-templates-restore').attr('title',translate.remove).removeClass('prfilter-icon-left').addClass('prfilter-icon-right');		}		//style appear		newItem.removeClass('prfilter-template-category-item-hover');		prfilter_TemplateSortTemplate();		prfilter_TemplateRemoveCategoryIcon(UcategoryDiv);		prfilter_TemplateEmptyMessages();		return true;	}	function prfilter_TemplateMoveItemToNotUse(optionItem){		var UcategoryDiv = optionItem.closest('.prfilter-template-category'),		UcategoryID = optionItem.attr('categoryID'),		NUcategoryDiv = $('.prfilter-templates-notuse').find('.prfilter-template-category[categoryID="'+UcategoryID+'"]');		//show NU category		NUcategoryDiv.show();		//clone item		newItem = optionItem.clone(true).fadeIn(500).prependTo(NUcategoryDiv.find('.prfilter-template-category-items-all'));		if($(NUcategoryDiv).find(newItem).length > 0){			//fix: Set all selects			var selects = optionItem.find("select");			$(selects).each(function(i) { 				var select = this;				newItem.find("select").eq(i).val($(select).val()); 			});			//remove NU item			optionItem.remove();			//hide NU category if item count null			if (NUcategoryDiv.find('.prfilter-template-category-item').length > 0) NUcategoryDiv.show();			//style move icon			newItem.find('.prfilter-templates-restore').attr('title',translate.addtotemplate).addClass('prfilter-icon-left').removeClass('prfilter-icon-right');			//style appear			newItem.removeClass('prfilter-template-category-item-hover');			prfilter_TemplateRemoveCategoryIcon(UcategoryDiv);				prfilter_TemplateEmptyMessages();		}		return true;	}	function prfilter_TemplateGroupUse(g){		var parent = $('.prfilter-templates-inuse');		if(g==true){			$('input[name="slidecategoryes"]:checkbox').attr('disabled',false);			$('.prfilter-template-category-additionally').find('select').attr('disabled',false);						parent.find('.prfilter-template-category').each(function(){				$(this).removeClass('prfilter-template-category-groupless');				$(this).find('.prfilter-template-category-title').show();				$(this).find('.prfilter-template-category-additionally').show();				$(this).find('.prfilter-template-category-items-all').removeClass('prfilter-template-category-items-all-groupless');				prfilter_TemplateRemoveCategoryIcon($(this));			})			//Move options to their own categories			/* parent.find('.prfilter-template-category-item').each(function(){				var categoryID = $(this).attr('categoryID');				var AppendI = $(this).clone(true).show().appendTo('.prfilter-templates-inuse .prfilter-template-category[categoryID="'+categoryID+'"] .prfilter-template-category-items-all');				var selects = $(this).find("select");				$(selects).each(function(i) { AppendI.find("select").eq(i).val($(this).val()); });				$(this).remove();			}); */		}else{			$('input[name="slidecategoryes"]:checkbox').attr('disabled',true).removeAttr('checked');			parent.find('.prfilter-template-category').each(function(){				prfilter_TemplateCancelEdit($(this));				$(this).addClass('prfilter-template-category-groupless');				$(this).find('.prfilter-template-category-title').hide();				$(this).find('.prfilter-template-category-additionally').hide();				$(this).find('.prfilter-template-category-items-all').addClass('prfilter-template-category-items-all-groupless');					prfilter_TemplateRemoveCategoryIcon($(this));				})		}		return true;	}	function prfilter_TemplateGroupNotUse(g){		var parent = $('.prfilter-templates-notuse');		if(g==true){			parent.find('.prfilter-template-category-title').show();			parent.find('.prfilter-template-category').removeClass('prfilter-template-category-groupless');			parent.find('.prfilter-template-category-items-all').removeClass('prfilter-template-category-items-all-groupless');		}else{			parent.find('.prfilter-template-category-title').hide();			parent.find('.prfilter-template-category').addClass('prfilter-template-category-groupless');			parent.find('.prfilter-template-category-items-all').addClass('prfilter-template-category-items-all-groupless');		}		return true;	}	function prfilter_TemplateCancelEdit(parentCategory){		var categoryNameFields = parentCategory.find('.prfilter-template-categoryname');			categoryNameFields.hide();		parentCategory.removeClass('prfilter-template-category-changename');		parentCategory.find('.prfilter-template-category-additionally').show();					parentCategory.find('.prfilter-template-category-edit').removeAttr('style');		parentCategory.find('.prfilter-template-category-title').find('span').show();		parentCategory.find('.prfilter-template-category-title').find('img').show();		prfilter_TemplateRemoveCategoryIcon(parentCategory);		var inputs = categoryNameFields.find('input[type="text"]');		$(inputs).each(function(i) {			$(this).val($(this).attr('xvalue'));		});			return true;	}	function prfilter_TemplateRemoveCategoryIcon(parentCategory){		checkboxInuseGroup = $('.prfilter-template').find('.prfilter-template-inuse-group');		if(parentCategory.find('.prfilter-template-category-item').length==0 && checkboxInuseGroup.is(':checked')){			parentCategory.find('.prfilter-template-category-remove').show();			}else{			parentCategory.find('.prfilter-template-category-remove').hide();			}		return true;	}	function prfilter_TemplateEmptyMessages(){		checkboxInuseGroup = $('.prfilter-template').find('.prfilter-template-inuse-group');		checkboxNotuseGroup = $('.prfilter-template').find('.prfilter-template-notuse-group');		//in use		if(($('.prfilter-templates-inuse').find('.prfilter-template-category-item:visible').length==0 && !checkboxInuseGroup.is(':checked')) || $('.prfilter-templates-inuse').find('.prfilter-template-category:visible').length==0 && checkboxInuseGroup.is(':checked')){					if($('.prfilter-templates-inuse').find('.prfilter-template-empty').length == 0){				$('.prfilter-templates-inuse').prepend('<div class="prfilter-template-empty">'+translate.empty+'</div>');			}			checkboxInuseGroup.attr('disabled',true);		}else{			$('.prfilter-templates-inuse').find('.prfilter-template-empty').remove();			checkboxInuseGroup.attr('disabled',false);		}				//not use		if($('.prfilter-templates-notuse').find('.prfilter-template-category:visible').length == 0){			if($('.prfilter-templates-notuse').find('.prfilter-template-empty').length == 0){				$('.prfilter-templates-notuse').prepend('<div class="prfilter-template-empty">'+translate.empty+'</div>');			}			checkboxNotuseGroup.attr('disabled',true);		}else{			$('.prfilter-templates-notuse').find('.prfilter-template-empty').remove();			checkboxNotuseGroup.attr('disabled',false);		}		return true;	}	function prfilter_TemplateSetAdditionallyVisible(toi){		if(toi=='type'){			$('.prfilter-template-category-item').find('select[additionally="type"]').each(function(){				var editoption = $(this).closest('.prfilter-template-editoption');				var item = $(this).closest('.prfilter-template-category-item');				if($(this).val()=='select'){					editoption.find('select[additionally="colomns"]').closest('tr').hide();					editoption.find('select[additionally="images"]').closest('tr').hide();				}else{					editoption.find('select[additionally="colomns"]').closest('tr').show();					editoption.find('select[additionally="images"]').closest('tr').show();				}				var linkrestore = item.find('.prfilter-templates-restore');				var parent_height = item.height();				if(typeof linkrestore.attr('style') !== 'undefined' && linkrestore.attr('style') !== false) linkrestore.css('height',parent_height+'px');			});		}else{			$('.prfilter-template-category-item').find('select[additionally="images"]').each(function(){				var editoption = $(this).closest('.prfilter-template-editoption');				var item = $(this).closest('.prfilter-template-category-item');				if($(this).val()=='text'){					editoption.find('tr[singleimages="yep"]').hide();				}else{					editoption.find('tr[singleimages="yep"]').show();				}				var linkrestore = item.find('.prfilter-templates-restore');				var parent_height = item.height();				if(typeof linkrestore.attr('style') !== 'undefined' && linkrestore.attr('style') !== false) linkrestore.css('height',parent_height+'px');			});		}		return true;	}		function prfilter_TemplateSortTemplate(){		if(!$('.prfilter-template-inuse-group').is(':checked')){			$('.prfilter-templates-inuse').sortable().sortable('destroy');			$('.prfilter-templates-inuse .prfilter-template-category-items-all').sortable({				axis:'y',				placeholder: "prfilter-template-highlight",				items: "> div.prfilter-template-category-item",				connectWith: ".prfilter-template-category-items-all"			})		}else{			$('.prfilter-templates-inuse').sortable({				axis:'y',				placeholder: "prfilter-template-highlight-category",				items: "> div.prfilter-template-category"			})						$('.prfilter-templates-inuse .prfilter-template-category-items-all').sortable({				axis:'y',				placeholder: "prfilter-template-highlight",				//connectWith: ".prfilter-template-category"				connectWith: ".prfilter-template-category-items-all",				stop:function(){						if($('.prfilter-templates-inuse .prfilter-template-category').length > 0){					$('.prfilter-templates-inuse').find('.prfilter-template-category').each(function(){						prfilter_TemplateRemoveCategoryIcon($(this));					});					}									}			})		}	}	function prfilter_TemplateCountCategories(){		$('#appendedcategories-block div').show();		var hasClass = $('.prfilter-template-showall-categoryes a').hasClass('shown');		$('.prfilter-template-showall-categoryes').remove();				var countCategoryes = $('#appendedcategories-block div').length;			$('.prfilter-template-categoryes-title span').html(countCategoryes);				if(countCategoryes > 0){ $('.remove-all-categoryes-handler').show(); }else{ $('.remove-all-categoryes-handler').hide(); }		var countAllCategoryes = $('.prfilter-template-categoryes-title').attr('countAllCategoryes');		if(countAllCategoryes == countCategoryes){			$('.add-appended-parent-handler, .add-all-categoryes-handler').hide();		}else{			$('.add-appended-parent-handler, .add-all-categoryes-handler').show();		}						if(countCategoryes > 5 ){			if(hasClass){				$('#appendedcategories-block').append('<div class="prfilter-template-showall-categoryes"><a href="javascript:void(0);" class="shown">'+translate.hideallcategoryies+'</a></div>');			}else{				$('#appendedcategories-block div:gt(4)').hide();				$('#appendedcategories-block').append('<div class="prfilter-template-showall-categoryes"><a href="javascript:void(0);">'+translate.showallcategoryies+'</a></div>');			}		}	}	function prfilter_TemplateAddCategoryToList(categoryID, name){		if(getLayer('appended-category-'+categoryID)){			var catBlock = getLayer('appended-category-'+categoryID);			catBlock.parentNode.removeChild(catBlock);			prfilter_TemplateCountCategories();			return false;		}		var objCatBlock = document.createElement('div');		objCatBlock.id = 'appended-category-'+categoryID;		var objSpan = createTag('span', objCatBlock);		objSpan.innerHTML = name;		var objInput = createTag('input', objCatBlock);		objInput.name = 'categoryes[]';		objInput.value = categoryID;		objInput.style.display = "none";		var objA = createTag('a', objCatBlock);		objA.href = '#remove_appendedcategory';		objA.className = "remove_appendedcategory_handler";		objA.setAttribute('categoryID', categoryID);		objA.onclick = function(){				var catBlock = getLayer("appended-category-"+this.getAttribute('categoryID'));			catBlock.parentNode.removeChild(catBlock);			prfilter_TemplateCountCategories();		};		var objRemoveImg = createTag('img', objA);		objRemoveImg.src = 'images/remove.gif';		objRemoveImg.alt = translate.DELETE_BUTTON;		objRemoveImg.border = 0;		objRemoveImg.hspace = 6;		getLayer("appendedcategories-block").appendChild(objCatBlock);		prfilter_TemplateCountCategories();		return true;	}	var categoryTreeManager = {		'appended_categories': {},			'isAppendedCategory': function(node, wnd){			var catID = node.getSetting('categoryID');			if(this.appended_categories[catID]){				var objEnd = getLayer(node.ID+'_begin', wnd);				objEnd.innerHTML = '<img src="images_common/checked.gif" alt="" />&nbsp;';			}		},		'addAllCategoryes': function(){				sswgt_CartManager.div();			sswgt_CartManager.base();			var page = getPageSize();			var objLoading = document.createElement('div');			sswgt_CartManager.objBase.appendChild(objLoading);			setStyle(objLoading, 'backgroundColor:#ffffff; zIndex:121; position:absolute; padding:20px; left:'+parseInt(page[2]/2-50+20)+'px; top:'+parseInt(page[3]/2-50)+'px;visibility: visible;');			var objImgLoading = document.createElement('img');			objImgLoading.src = ((window.CONF_ON_WEBASYST)?(conf_full_shop_url.replace(/shop\//,'')+'shop/'):(conf_full_shop_url+'published/SC/html/scripts/'))+'images_common/loading.gif';			objLoading.appendChild(objImgLoading);					if(!requestSent) {			requestSent = true;			$.ajax({     				url: set_query('?ukey=prfilter_templates'),				dataType : "json",				data: "action=load_categoryes",				type: "POST",				success: function(data){ 							sswgt_CartManager.hide(true);						$('#appendedcategories-block').html('');					$.each( data.returnArray, function( key, value ) {						var toHTML = '<div id="appended-category-'+value.categoryID+'">'+value.path+'<input name="categoryes[]" value="'+value.categoryID+'" type="hidden" /><a href="javascript:void(0);" class="remove_appendedcategory_handler" categoryID="'+value.categoryID+'"><img src="images/remove.gif" border="0" hspace="6" alt="'+translate.DELETE_BUTTON+'" /></a></div>';						$('#appendedcategories-block').prepend(toHTML);						prfilter_TemplateCountCategories();					});				},				error: function() {					sswgt_CartManager.hide(true);					objLoading.parentNode.removeChild(objLoading1);					return false;				},				complete: function() {					requestSent = false;				}			});			}					},		'show_tree': function(action){				if(action == 'add_appendedcategory'){						this.appended_categories = {};				var objInput = getElementsByClass('', getLayer('appendedcategories-block'),'input');				for(var k=objInput.length-1; k>=0; k--){					this.appended_categories[objInput[k].value] = 1;				}					}			var url = set_query('?ukey=category_tree&js_action='+action+'&productID=');				sswgt_CartManager.shop_url = conf_full_shop_url;			sswgt_CartManager.show(url, 550, 500); 			},		'hide_tree': function(){			sswgt_CartManager.hide();		},		'actions': {			'add_appendedcategory': {				'onclick': function(node, wnd){								var breadCrumbs = node.getSetting('name');					var p = node.ParentNode;					while(p){						breadCrumbs = p.getSetting('name')+"&nbsp;&gt;&nbsp;"+breadCrumbs;						p = p.ParentNode;					}					var res = prfilter_TemplateAddCategoryToList(node.getSetting('categoryID'), breadCrumbs);					var objEnd = getLayer(node.ID+'_begin', wnd);					objEnd.innerHTML = res?'<img src="images_common/checked.gif" alt="" />&nbsp;':'';				}			}		},			'eval': function(action, handler, node, wnd){			this.actions[action][handler](node, wnd);		}	};	function prfilter_setCookie(name, value, options) {	  options = options || {};	  var expires = options.expires;	  if (typeof expires == "number" && expires) {		var d = new Date();		d.setTime(d.getTime() + expires*1000);		expires = options.expires = d;	  }	  if (expires && expires.toUTCString) { 		options.expires = expires.toUTCString();	  }	  value = encodeURIComponent(value);	  var updatedCookie = name + "=" + value;	  for(var propName in options) {		updatedCookie += "; " + propName;		var propValue = options[propName];    		if (propValue !== true) { 		  updatedCookie += "=" + propValue;		 }	  }	  document.cookie = updatedCookie;	}		function prfilter_getCookie(name) {	  var matches = document.cookie.match(new RegExp(		"(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"	  ));	  return matches ? decodeURIComponent(matches[1]) : undefined;	}